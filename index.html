<!DOCTYPE html>

<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#667eea">
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„Ø£Ø®ÙŠØ±Ø© Pro Max</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root {
  --primary:#667eea;--primary-dark:#5a6fd6;--accent:#764ba2;
  --bg-body:#f0f2f5;--bg-card:rgba(255,255,255,.75);--bg-card-solid:#fff;
  --text-main:#2d3748;--text-sub:#718096;--border:rgba(226,232,240,.6);
  --success:#48bb78;--danger:#f56565;--warning:#ed8936;--info:#4299e1;
  --radius:18px;--glass-blur:12px;--shadow:0 8px 32px rgba(0,0,0,.08)
}
[data-theme="dark"] {
  --primary:#7f9cf5;--primary-dark:#667eea;--accent:#5a67d8;
  --bg-body:#0f172a;--bg-card:rgba(30,41,59,.8);--bg-card-solid:#1e293b;
  --text-main:#f1f5f9;--text-sub:#94a3b8;--border:rgba(71,85,105,.5);
  --shadow:0 8px 32px rgba(0,0,0,.3)
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;font-family:'Tajawal','Segoe UI',Tahoma,sans-serif}
html{scroll-behavior:smooth}
body{background:var(--bg-body);color:var(--text-main);padding-bottom:80px;transition:background .4s,color .4s;overflow-x:hidden}
body::before{content:'';position:fixed;top:-50%;left:-50%;width:200%;height:200%;
  background:radial-gradient(circle at 20% 20%,rgba(102,126,234,.08) 0%,transparent 50%),
             radial-gradient(circle at 80% 80%,rgba(118,75,162,.06) 0%,transparent 50%);
  z-index:-1;animation:bgFloat 20s ease-in-out infinite alternate}
@keyframes bgFloat{0%{transform:translate(0,0)}100%{transform:translate(-5%,5%)}}

/* â”€â”€ Header â”€â”€ */
.header{background:linear-gradient(135deg,#667eea 0%,#764ba2 50%,#f093fb 100%);
color:#fff;padding:28px 15px;padding-top:max(28px,env(safe-area-inset-top));
text-align:center;border-bottom-left-radius:30px;border-bottom-right-radius:30px;
box-shadow:0 10px 40px rgba(102,126,234,.3);position:relative;margin-bottom:20px;overflow:hidden}
.header::after{content:â€™â€™;position:absolute;top:-50%;left:-50%;width:200%;height:200%;
background:radial-gradient(circle,rgba(255,255,255,.1) 0%,transparent 60%);
animation:headerShine 6s ease-in-out infinite}
@keyframes headerShine{0%,100%{transform:translate(-30%,-30%)}50%{transform:translate(30%,30%)}}
.header h1{font-size:clamp(1.1rem,4vw,1.5rem);font-weight:800;margin-bottom:6px;
text-shadow:0 2px 10px rgba(0,0,0,.2);position:relative}
.header p{opacity:.9;font-size:clamp(.75rem,3vw,.85rem);position:relative}
.theme-toggle{position:absolute;top:max(15px,env(safe-area-inset-top));left:15px;
background:rgba(255,255,255,.2);border:none;width:44px;height:44px;border-radius:50%;
display:flex;align-items:center;justify-content:center;font-size:1.3rem;cursor:pointer;
backdrop-filter:blur(10px);transition:transform .3s,background .3s;z-index:10;color:#fff}
.theme-toggle:hover{transform:scale(1.1);background:rgba(255,255,255,.3)}

/* â”€â”€ Tabs â”€â”€ */
.tabs-wrapper{position:sticky;top:0;z-index:100;backdrop-filter:blur(15px);
background:rgba(240,242,245,.85);padding:10px 10px;transition:background .4s}
[data-theme=â€œdarkâ€] .tabs-wrapper{background:rgba(15,23,42,.9)}
.tabs{display:flex;overflow-x:auto;gap:6px;padding:6px;background:var(â€“bg-card);
border-radius:16px;box-shadow:var(â€“shadow);backdrop-filter:blur(var(â€“glass-blur));
scrollbar-width:none;-webkit-overflow-scrolling:touch;white-space:nowrap}
.tabs::-webkit-scrollbar{display:none}
.tab{flex:0 0 auto;padding:10px 16px;border:none;background:transparent;
color:var(â€“text-sub);font-weight:700;border-radius:12px;font-size:clamp(.78rem,3vw,.9rem);
cursor:pointer;transition:all .3s cubic-bezier(.4,0,.2,1);position:relative;overflow:hidden}
.tab::before{content:â€™â€™;position:absolute;inset:0;
background:linear-gradient(135deg,var(â€“primary),var(â€“accent));
opacity:0;transition:opacity .3s;border-radius:12px}
.tab.active{color:#fff;box-shadow:0 4px 15px rgba(102,126,234,.35);transform:translateY(-1px)}
.tab.active::before{opacity:1}
.tab span{position:relative;z-index:1}

/* â”€â”€ Container & Layout â”€â”€ */
.container{max-width:800px;margin:0 auto;padding:0 12px}
.tab-content{display:none;animation:slideUp .4s cubic-bezier(.4,0,.2,1)}
.tab-content.active{display:block}
@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

/* â”€â”€ Cards â”€â”€ */
.card{background:var(â€“bg-card);border-radius:var(â€“radius);padding:18px;margin-bottom:14px;
box-shadow:var(â€“shadow);border:1px solid var(â€“border);backdrop-filter:blur(var(â€“glass-blur));
transition:transform .2s,box-shadow .2s}
.card:hover{transform:translateY(-2px);box-shadow:0 12px 40px rgba(0,0,0,.12)}
.card h2{font-size:1.05rem;color:var(â€“primary);margin-bottom:14px;
display:flex;align-items:center;gap:8px;font-weight:800}

/* â”€â”€ Form Elements â”€â”€ */
.input-group{margin-bottom:16px}
label{display:block;margin-bottom:7px;color:var(â€“text-sub);font-size:.88rem;font-weight:700}
input[type=â€œtextâ€],input[type=â€œnumberâ€],select{
width:100%;padding:13px 14px;border:2px solid var(â€“border);border-radius:14px;
background:var(â€“bg-body);color:var(â€“text-main);font-size:16px;
font-family:â€˜Tajawalâ€™,sans-serif;transition:all .3s;appearance:none;-webkit-appearance:none}
input:focus,select:focus{outline:none;border-color:var(â€“primary);
box-shadow:0 0 0 4px rgba(102,126,234,.12)}
.preview-box{font-size:.82rem;color:var(â€“primary);margin-top:8px;padding:9px 13px;
background:linear-gradient(135deg,rgba(102,126,234,.08),rgba(118,75,162,.05));
border-radius:10px;display:flex;justify-content:space-between;align-items:center;font-weight:600}

/* â”€â”€ Grid Select â”€â”€ */
.grid-select{display:grid;grid-template-columns:repeat(auto-fit,minmax(58px,1fr));gap:7px}
.select-item{background:var(â€“bg-body);border:2px solid var(â€“border);border-radius:12px;
padding:9px 4px;text-align:center;cursor:pointer;transition:all .25s cubic-bezier(.4,0,.2,1);
display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:62px}
.select-item:active{transform:scale(.96)}
.select-item.selected{border-color:var(â€“primary);
background:linear-gradient(135deg,rgba(102,126,234,.15),rgba(118,75,162,.1));
color:var(â€“primary);transform:scale(1.04);box-shadow:0 4px 15px rgba(102,126,234,.2)}
.select-item span{font-size:1.1rem;display:block;margin-bottom:3px}
.select-item small{font-size:.68rem;font-weight:700;line-height:1.3}

/* â”€â”€ Buttons â”€â”€ */
.action-buttons{display:flex;flex-direction:column;gap:10px;margin-top:20px}
button.btn-lg{width:100%;padding:15px;border:none;border-radius:16px;font-size:1rem;
font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;
transition:all .3s cubic-bezier(.4,0,.2,1);position:relative;overflow:hidden;
font-family:â€˜Tajawalâ€™,sans-serif;-webkit-appearance:none}
button.btn-lg:active{transform:scale(.97)}
.btn-primary{background:linear-gradient(135deg,var(â€“primary),var(â€“accent));color:#fff;
box-shadow:0 6px 20px rgba(102,126,234,.3)}
.btn-primary:hover{box-shadow:0 8px 30px rgba(102,126,234,.45);transform:translateY(-2px)}
.btn-secondary{background:var(â€“bg-card);color:var(â€“text-main);
border:2px solid var(â€“border)!important;box-shadow:var(â€“shadow)}
.btn-success{background:linear-gradient(135deg,#48bb78,#38a169);color:#fff;
box-shadow:0 6px 20px rgba(72,187,120,.3)}
.btn-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}

/* â”€â”€ Stats Grid â”€â”€ */
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
.stat-box{background:var(â€“bg-body);padding:14px 10px;border-radius:14px;
text-align:center;border:1px solid var(â€“border);transition:transform .2s}
.stat-box:hover{transform:scale(1.02)}
.stat-val{font-size:1.25rem;font-weight:800;color:var(â€“text-main)}
.stat-lbl{font-size:.75rem;color:var(â€“text-sub);margin-top:4px;font-weight:600}

/* â”€â”€ Type Badge â”€â”€ */
.type-badge{display:inline-flex;align-items:center;gap:6px;padding:9px 18px;
border-radius:25px;font-size:.85rem;font-weight:700;margin-bottom:12px;
animation:badgePulse 2s ease-in-out infinite}
@keyframes badgePulse{0%,100%{box-shadow:0 0 0 0 rgba(102,126,234,.2)}50%{box-shadow:0 0 0 8px rgba(102,126,234,0)}}
.type-badge.advantage{background:rgba(72,187,120,.15);color:var(â€“success);border:2px solid var(â€“success)}
.type-badge.disadvantage{background:rgba(245,101,101,.15);color:var(â€“danger);border:2px solid var(â€“danger)}
.type-badge.neutral{background:rgba(237,137,54,.15);color:var(â€“warning);border:2px solid var(â€“warning)}

/* â”€â”€ Battle Log â”€â”€ */
.battle-log{max-height:280px;overflow-y:auto;-webkit-overflow-scrolling:touch;
margin-top:16px;padding:8px;background:var(â€“bg-body);border-radius:14px}
.log-entry{padding:9px 11px;margin-bottom:7px;border-radius:10px;
border-right:4px solid var(â€“primary);background:var(â€“bg-card);
font-size:.82rem;display:flex;justify-content:space-between;align-items:center}
.log-entry.critical{border-right-color:var(â€“warning);background:rgba(237,137,54,.08)}

/* â”€â”€ VS Badge â”€â”€ */
.vs-badge{background:linear-gradient(135deg,var(â€“primary),var(â€“accent));color:#fff;
width:46px;height:46px;border-radius:50%;display:flex;align-items:center;
justify-content:center;font-weight:800;margin:-10px auto 10px;
border:4px solid var(â€“bg-card-solid);position:relative;z-index:2;
box-shadow:0 4px 15px rgba(102,126,234,.3);font-size:.88rem}

/* â”€â”€ Chart â”€â”€ */
.chart-wrapper{height:230px;position:relative;margin:12px 0}

/* â”€â”€ Saved Items â”€â”€ */
.saved-item{padding:13px;margin-bottom:9px;background:var(â€“bg-card);
border:2px solid var(â€“border);border-radius:14px;cursor:pointer;
display:flex;justify-content:space-between;align-items:center;
transition:all .25s;backdrop-filter:blur(var(â€“glass-blur))}
.saved-item:hover{border-color:var(â€“primary);transform:translateX(-3px)}
.delete-btn{background:linear-gradient(135deg,#f56565,#e53e3e);color:#fff;border:none;
padding:8px 12px;border-radius:10px;font-size:.78rem;cursor:pointer;font-weight:700;
font-family:â€˜Tajawalâ€™,sans-serif;white-space:nowrap;flex-shrink:0}

/* â”€â”€ Info Tooltip â”€â”€ */
.info-tooltip{display:inline-flex;align-items:center;justify-content:center;
width:19px;height:19px;background:linear-gradient(135deg,var(â€“primary),var(â€“accent));
color:#fff;border-radius:50%;font-size:10px;margin-left:4px;cursor:help;flex-shrink:0}

/* â”€â”€ Warn Note â”€â”€ */
.warn-note{font-size:.72rem;color:var(â€“text-sub);margin-top:8px;padding:8px 11px;
background:rgba(237,137,54,.08);border-radius:8px;border-right:3px solid var(â€“warning);line-height:1.5}

/* â”€â”€ Footer â”€â”€ */
.footer{background:linear-gradient(135deg,#1a202c 0%,#0f172a 100%);color:#fff;
padding:28px 15px;text-align:center;margin-top:30px;position:relative;overflow:hidden}
.footer::before{content:â€™â€™;position:absolute;top:0;left:0;right:0;height:4px;
background:linear-gradient(90deg,#ffd700,#ff6b6b,#667eea,#48bb78,#ffd700);
background-size:200% 100%;animation:footerGlow 3s linear infinite}
@keyframes footerGlow{0%{background-position:0% 0%}100%{background-position:200% 0%}}
.footer-avatar{width:72px;height:72px;border-radius:50%;border:3px solid #ffd700;
margin-bottom:13px;box-shadow:0 0 20px rgba(255,215,0,.3);display:block;margin-left:auto;margin-right:auto}
.footer h3{color:#ffd700;font-size:1.2rem;margin-bottom:7px;font-weight:800}
.footer p{color:#94a3b8;font-size:.83rem;margin:3px 0}

/* â”€â”€ Mobile Specific â”€â”€ */
@media(max-width:480px){
.header{padding:22px 12px;padding-top:max(22px,env(safe-area-inset-top));margin-bottom:14px}
.card{padding:14px;border-radius:14px}
.stats-grid{gap:8px}
.stat-val{font-size:1.1rem}
.grid-select{gap:6px}
.select-item{min-height:56px;padding:7px 3px}
.select-item span{font-size:1rem}
input[type=â€œtextâ€],input[type=â€œnumberâ€],select{padding:12px 13px}
.btn-row{gap:8px}
button.btn-lg{padding:13px;font-size:.95rem}
}
</style>

</head>
<body>

<div class="header">
  <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
  <h1>âš”ï¸ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„Ø£Ø®ÙŠØ±Ø© Pro Max</h1>
  <p>Ù…Ø­Ø§ÙƒÙŠ Ù‚ØªØ§Ù„ Ù…ØªÙ‚Ø¯Ù… + Ø£Ø¯ÙˆØ§Øª Ø´Ø§Ù…Ù„Ø© v5.2 | Built by DistopÇa</p>
</div>

<div class="tabs-wrapper">
  <div class="tabs">
    <button class="tab active" onclick="switchTab('calculator')"><span>ğŸ¯ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</span></button>
    <button class="tab" onclick="switchTab('compare')"><span>âš”ï¸ Ù…Ù‚Ø§Ø±Ù†Ø©</span></button>
    <button class="tab" onclick="switchTab('heroes')"><span>ğŸ¦¸ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</span></button>
    <button class="tab" onclick="switchTab('tierlist')"><span>ğŸ† Tier List</span></button>
    <button class="tab" onclick="switchTab('teambuilder')"><span>ğŸ‘¥ Ø§Ù„ÙØ±ÙŠÙ‚</span></button>
    <button class="tab" onclick="switchTab('tools')"><span>ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª</span></button>
    <button class="tab" onclick="switchTab('saved')"><span>ğŸ’¾ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</span></button>
    <button class="tab" onclick="switchTab('charts')"><span>ğŸ“Š Ø§Ù„Ø±Ø³ÙˆÙ…</span></button>
  </div>
</div>

<div class="container">

  <!-- â•â•â•â•â•â•â•â•â•â• CALCULATOR TAB â•â•â•â•â•â•â•â•â•â• -->

  <div id="calculator" class="tab-content active">
    <div class="card">
      <h2>ğŸ—¡ï¸ Ø§Ù„Ù…Ù‡Ø§Ø¬Ù…</h2>
      <div class="input-group">
        <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label>
        <select id="attackerType" onchange="updatePreview()">
          <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø© (Tank)</option>
          <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø© (Aircraft)</option>
          <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ® (Missile)</option>
        </select>
      </div>
      <div class="input-group">
        <label>Ù‚ÙˆØ© Ø§Ù„Ù‡Ø¬ÙˆÙ…</label>
        <input type="text" id="attack" value="65.2K" inputmode="decimal" oninput="updatePreview()">
        <div class="preview-box"><span>Ø§Ù„Ù‚ÙŠÙ…Ø©:</span><strong id="attackValue">65,200</strong></div>
      </div>
      <div class="input-group">
        <label><span class="info-tooltip">â„¹</span>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø¬ÙˆÙ… <span style="font-size:.7rem;color:var(--warning);font-weight:600;">âš ï¸ ØªÙ‚Ø±ÙŠØ¨ÙŠ</span></label>
        <div class="grid-select">
          <div class="select-item selected" onclick="selectStars(0,this)"><span>â­</span><small>+30%</small></div>
          <div class="select-item" onclick="selectStars(1,this)"><span>â­â­</span><small>+70%</small></div>
          <div class="select-item" onclick="selectStars(2,this)"><span>â­â­â­</span><small>+120%</small></div>
          <div class="select-item" onclick="selectStars(3,this)"><span>â­â­â­â­</span><small>+185%</small></div>
          <div class="select-item" onclick="selectStars(4,this)"><span>â­â­â­â­â­</span><small>+270%</small></div>
        </div>
      </div>
      <div class="input-group">
        <label><span class="info-tooltip">â„¹</span>Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ø§Ø±Ø© <span style="font-size:.7rem;color:var(--warning);font-weight:600;">âš ï¸ ØªÙ‚Ø±ÙŠØ¨ÙŠ</span></label>
        <div class="grid-select" style="grid-template-columns:repeat(3,1fr);">
          <div class="select-item selected" onclick="selectSkill(0,this)"><span>âš”ï¸</span><small>Ø¹Ø§Ø¯ÙŠØ©<br>100%</small></div>
          <div class="select-item" onclick="selectSkill(1,this)"><span>ğŸ”¥</span><small>Ø®Ø§ØµØ©<br>345%</small></div>
          <div class="select-item" onclick="selectSkill(2,this)"><span>ğŸ’¥</span><small>Ù†Ù‡Ø§Ø¦ÙŠØ©<br>405%</small></div>
        </div>
        <div class="warn-note">âš ï¸ Ù†Ø³Ø¨ Ø§Ù„Ù†Ø¬ÙˆÙ… ÙˆØ§Ù„Ù…Ù‡Ø§Ø±Ø§Øª ØªÙ‚Ø±ÙŠØ¨ÙŠØ© â€” ÙƒÙ„ Ø¨Ø·Ù„ Ù„Ù‡ Ù†Ø³Ø¨ Ù…Ø®ØªÙ„ÙØ© Ø­Ø³Ø¨ Ù…Ù‡Ø§Ø±Ø§ØªÙ‡ ÙˆÙ…Ø³ØªÙˆØ§Ù‡</div>
      </div>
      <div class="stats-grid">
        <div class="input-group" style="margin:0">
          <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬ %</label>
          <input type="number" id="critChance" value="20" inputmode="numeric" oninput="updatePreview()">
          <div class="preview-box" style="margin-top:7px"><span>1 Ù…Ù† ÙƒÙ„</span><strong id="critFreq">5</strong></div>
        </div>
        <div class="input-group" style="margin:0">
          <label>Ø¶Ø±Ø± Ø§Ù„Ø­Ø±Ø¬ %</label>
          <input type="number" id="critDamage" value="150" inputmode="numeric" oninput="updatePreview()">
          <div class="preview-box" style="margin-top:7px"><span>Ù…Ø¶Ø§Ø¹Ù</span><strong id="critMulti">Ã—1.5</strong></div>
        </div>
      </div>
    </div>

```
<div class="card">
  <h2>ğŸ›¡ï¸ Ø§Ù„Ù…Ø¯Ø§ÙØ¹</h2>
  <div class="input-group">
    <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label>
    <select id="defenderType" onchange="updatePreview()">
      <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø© (Tank)</option>
      <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø© (Aircraft)</option>
      <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ® (Missile)</option>
    </select>
  </div>
  <div class="input-group">
    <label>Ù†Ù‚Ø§Ø· Ø§Ù„ØµØ­Ø© (HP)</label>
    <input type="text" id="health" value="1.4M" inputmode="decimal" oninput="updatePreview()">
    <div class="preview-box"><span>Ø§Ù„Ù‚ÙŠÙ…Ø©:</span><strong id="healthValue">1,400,000</strong></div>
  </div>
  <div class="stats-grid">
    <div class="input-group" style="margin:0">
      <label>Ø§Ù„Ø¯ÙØ§Ø¹</label>
      <input type="text" id="defense" value="8.4K" inputmode="decimal" oninput="updatePreview()">
    </div>
    <div class="input-group" style="margin:0">
      <label>Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© %</label>
      <input type="number" id="resistance" value="10" inputmode="numeric">
    </div>
  </div>
  <div class="input-group" style="margin-top:14px">
    <label>Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    <input type="text" id="calcName" placeholder="Ù…Ø«Ø§Ù„: Ø¯Ø¨Ø§Ø¨ØªÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
  </div>
</div>

<div class="card">
  <h2>ğŸ‘¥ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ±ÙŠÙ‚</h2>
  <div class="input-group">
    <label><span class="info-tooltip">â„¹</span>Ø¨ÙˆÙ†Øµ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© (Lineup Bonus)</label>
    <div class="grid-select" style="grid-template-columns:repeat(4,1fr);">
      <div class="select-item" onclick="selectLineup(0,this)"><span>ğŸ‘¤</span><small>Ø¨Ø¯ÙˆÙ†<br>0%</small></div>
      <div class="select-item selected" onclick="selectLineup(1,this)"><span>ğŸ‘¥</span><small>3 Ù†ÙØ³<br>+5%</small></div>
      <div class="select-item" onclick="selectLineup(2,this)"><span>ğŸ‘¥ğŸ‘¤</span><small>3+2<br>+10%</small></div>
      <div class="select-item" onclick="selectLineup(3,this)"><span>ğŸ‘¥ğŸ‘¥</span><small>4 Ù†ÙØ³<br>+15%</small></div>
    </div>
    <div class="grid-select" style="grid-template-columns:1fr;margin-top:6px;">
      <div class="select-item" onclick="selectLineup(4,this)"><span>ğŸ‘¥ğŸ‘¥ğŸ‘¤</span><small>5 Ù†ÙØ³ Ø§Ù„Ù†ÙˆØ¹ â€” +20% Ù‡Ø¬ÙˆÙ…/HP/Ø¯ÙØ§Ø¹</small></div>
    </div>
  </div>
  <div class="stats-grid">
    <div class="input-group" style="margin:0">
      <label>ğŸ¯ Ø§Ù„Ø±ÙˆØ­ Ø§Ù„Ù…Ø¹Ù†ÙˆÙŠØ© %</label>
      <input type="number" id="morale" value="100" inputmode="numeric" min="50" max="200" oninput="updatePreview()">
      <div class="preview-box" style="margin-top:7px"><span>Ù…Ø¶Ø§Ø¹Ù</span><strong id="moraleMulti">Ã—1.00</strong></div>
    </div>
    <div class="input-group" style="margin:0">
      <label>ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø©</label>
      <div style="font-size:.75rem;color:var(--text-sub);padding:10px;background:var(--bg-body);border-radius:10px;line-height:1.7;height:100%;">
        100% = Ù„Ø§ ØªØ£Ø«ÙŠØ±<br>&gt;100% = Ø¶Ø±Ø± Ø¥Ø¶Ø§ÙÙŠ<br>&lt;100% = Ø¶Ø±Ø± Ø£Ù‚Ù„
      </div>
    </div>
  </div>

  <div id="typeAdvantagePreview" style="text-align:center;margin:14px 0;"></div>

  <div class="action-buttons">
    <button class="btn-lg btn-primary" onclick="simulateBattle()"><span>ğŸ¯</span> Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©</button>
    <div class="btn-row">
      <button class="btn-lg btn-secondary" onclick="saveCalculation()">ğŸ’¾ Ø­ÙØ¸</button>
      <button class="btn-lg btn-success" onclick="shareAsImage()">ğŸ“¸ ØµÙˆØ±Ø©</button>
    </div>
  </div>
  <div id="results" style="display:none;margin-top:20px;"></div>
</div>
```

  </div><!-- /calculator -->

  <!-- â•â•â•â•â•â•â•â•â•â• COMPARE TAB â•â•â•â•â•â•â•â•â•â• -->

  <div id="compare" class="tab-content">
    <div class="card">
      <h2>Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</h2>
      <div class="input-group"><label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label><select id="comp1Type"><option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©</option><option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø©</option><option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ®</option></select></div>
      <div class="input-group"><label>Ø§Ù„Ù‡Ø¬ÙˆÙ…</label><input type="text" id="comp1Attack" value="65.2K"></div>
      <div class="input-group"><label>Ø§Ù„Ù†Ø¬ÙˆÙ…</label><select id="comp1Stars"><option value="0">â­ +30%</option><option value="1">â­â­ +70%</option><option value="2">â­â­â­ +120%</option><option value="3">â­â­â­â­ +185%</option><option value="4">â­â­â­â­â­ +270%</option></select></div>
    </div>
    <div class="vs-badge">VS</div>
    <div class="card">
      <h2>Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</h2>
      <div class="input-group"><label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label><select id="comp2Type"><option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©</option><option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø©</option><option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ®</option></select></div>
      <div class="input-group"><label>Ø§Ù„Ù‡Ø¬ÙˆÙ…</label><input type="text" id="comp2Attack" value="70K"></div>
      <div class="input-group"><label>Ø§Ù„Ù†Ø¬ÙˆÙ…</label><select id="comp2Stars"><option value="0">â­ +30%</option><option value="1">â­â­ +70%</option><option value="2">â­â­â­ +120%</option><option value="3">â­â­â­â­ +185%</option><option value="4">â­â­â­â­â­ +270%</option></select></div>
    </div>
    <button class="btn-lg btn-primary" onclick="compareUnits()">ğŸ” Ù‚Ø§Ø±Ù† Ø§Ù„Ø¢Ù†</button>
    <div id="compareResults"></div>
  </div><!-- /compare -->

  <!-- â•â•â•â•â•â•â•â•â•â• HEROES TAB â•â•â•â•â•â•â•â•â•â• -->

  <div id="heroes" class="tab-content">
    <div class="card">
      <h2>ğŸ¦¸ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</h2>
      <div class="input-group">
        <input type="text" id="heroSearch" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¨Ø·Ù„..." oninput="filterHeroes()">
      </div>
      <div class="stats-grid" style="margin-bottom:12px;">
        <select id="heroFilterType" onchange="filterHeroes()" style="width:100%;padding:11px;border-radius:10px;border:1px solid var(--border);background:var(--bg-body);color:var(--text-main);font-family:Tajawal;font-size:14px;">
          <option value="all">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option><option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©</option><option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø©</option><option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ®</option>
        </select>
        <select id="heroFilterRarity" onchange="filterHeroes()" style="width:100%;padding:11px;border-radius:10px;border:1px solid var(--border);background:var(--bg-body);color:var(--text-main);font-family:Tajawal;font-size:14px;">
          <option value="all">ÙƒÙ„ Ø§Ù„Ù†Ø¯Ø±Ø§Øª</option><option value="UR">ğŸŸ  UR</option><option value="SSR">ğŸŸ£ SSR</option><option value="SR">ğŸ”µ SR</option>
        </select>
      </div>
      <div id="heroList"></div>
    </div>
  </div><!-- /heroes -->

  <!-- â•â•â•â•â•â•â•â•â•â• TIER LIST TAB â•â•â•â•â•â•â•â•â•â• -->

  <div id="tierlist" class="tab-content">
    <div class="card">
      <h2>ğŸ† Tier List â€” ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</h2>
      <p style="font-size:.82rem;color:var(--text-sub);margin-bottom:14px;">Ù…Ø¨Ù†ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙŠØªØ§ Ø§Ù„Ø­Ø§Ù„ÙŠØ© â€” Ù…ØµØ¯Ø±: lastwarhandbook.com</p>
      <div id="tierListContent"></div>
    </div>
  </div><!-- /tierlist -->

  <!-- â•â•â•â•â•â•â•â•â•â• TEAM BUILDER TAB â•â•â•â•â•â•â•â•â•â• -->

  <div id="teambuilder" class="tab-content">
    <div class="card">
      <h2>ğŸ‘¥ Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙØ±ÙŠÙ‚</h2>
      <p style="font-size:.82rem;color:var(--text-sub);margin-bottom:12px;">Ø§Ø®ØªØ± 5 Ø£Ø¨Ø·Ø§Ù„ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨ÙˆÙ†Øµ ÙˆØ§Ù„ØªÙˆØ§ÙÙ‚</p>
      <div class="stats-grid" style="margin-bottom:12px;">
        <select id="tbFilter" onchange="renderTeamBuilderList()" style="width:100%;padding:11px;border-radius:10px;border:1px solid var(--border);background:var(--bg-body);color:var(--text-main);font-family:Tajawal;font-size:14px;">
          <option value="all">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option><option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©</option><option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø©</option><option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ®</option>
        </select>
        <button class="btn-lg btn-primary" onclick="clearTeam()" style="margin:0;">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙØ±ÙŠÙ‚</button>
      </div>
      <div style="margin-bottom:14px;">
        <h3 style="margin-bottom:8px;font-size:.95rem;">ÙØ±ÙŠÙ‚Ùƒ (<span id="teamCount">0</span>/5)</h3>
        <div id="teamSlots" style="display:grid;grid-template-columns:repeat(5,1fr);gap:7px;"></div>
      </div>
      <div id="teamAnalysis"></div>
      <div style="margin-top:14px;">
        <h3 style="margin-bottom:8px;font-size:.95rem;">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</h3>
        <div id="tbHeroList"></div>
      </div>
    </div>
    <div class="card">
      <h2>â­ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§ (Meta)</h2>
      <div id="metaTeams"></div>
    </div>
  </div><!-- /teambuilder -->

  <!-- â•â•â•â•â•â•â•â•â•â• TOOLS TAB â•â•â•â•â•â•â•â•â•â• -->

  <div id="tools" class="tab-content">
    <div class="card">
      <h2>ğŸ“Š Ø­Ø§Ø³Ø¨Ø© EXP Ø§Ù„Ø¨Ø·Ù„</h2>
      <p style="font-size:.82rem;color:var(--text-sub);margin-bottom:12px;">Ø§Ø­Ø³Ø¨ ÙƒÙ…ÙŠØ© Ø§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„ØªØ±Ù‚ÙŠØ© Ø¨Ø·Ù„Ùƒ (Ø­ØªÙ‰ Ù…Ø³ØªÙˆÙ‰ 175)</p>
      <div class="stats-grid">
        <div class="input-group" style="margin:0"><label>Ù…Ù† Ù…Ø³ØªÙˆÙ‰</label><input type="number" id="expFrom" value="1" min="1" max="174" inputmode="numeric"></div>
        <div class="input-group" style="margin:0"><label>Ø¥Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰</label><input type="number" id="expTo" value="60" min="2" max="175" inputmode="numeric"></div>
      </div>
      <button class="btn-lg btn-primary" onclick="calculateEXP()" style="margin-top:12px;">ğŸ“Š Ø§Ø­Ø³Ø¨ EXP</button>
      <div id="expResults"></div>
    </div>

```
<div class="card">
  <h2>ğŸ–ï¸ Ø­Ø§Ø³Ø¨Ø© Ù…ÙŠØ¯Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h2>
  <p style="font-size:.82rem;color:var(--text-sub);margin-bottom:12px;">Ø§Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙŠØ¯Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</p>
  <div class="input-group">
    <label>Ù†Ø¯Ø±Ø© Ø§Ù„Ø¨Ø·Ù„</label>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;">
      <button class="select-item selected" onclick="selectMedalRarity('UR',this)" style="border-radius:10px;border:2px solid var(--border);background:var(--bg-card);color:var(--text-main);cursor:pointer;font-family:Tajawal;font-size:.9rem;">ğŸŸ  UR</button>
      <button class="select-item" onclick="selectMedalRarity('SSR',this)" style="border-radius:10px;border:2px solid var(--border);background:var(--bg-card);color:var(--text-main);cursor:pointer;font-family:Tajawal;font-size:.9rem;">ğŸŸ£ SSR</button>
      <button class="select-item" onclick="selectMedalRarity('SR',this)" style="border-radius:10px;border:2px solid var(--border);background:var(--bg-card);color:var(--text-main);cursor:pointer;font-family:Tajawal;font-size:.9rem;">ğŸ”µ SR</button>
    </div>
  </div>
  <div class="stats-grid">
    <div class="input-group" style="margin:0"><label>Ù…Ù† Ù…Ø³ØªÙˆÙ‰ Ù…Ù‡Ø§Ø±Ø©</label><input type="number" id="medalFrom" value="1" min="1" max="39" inputmode="numeric"></div>
    <div class="input-group" style="margin:0"><label>Ø¥Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ù…Ù‡Ø§Ø±Ø©</label><input type="number" id="medalTo" value="30" min="2" max="40" inputmode="numeric"></div>
  </div>
  <div class="input-group" style="margin-top:12px"><label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</label><input type="number" id="medalSkillCount" value="1" min="1" max="4" inputmode="numeric"></div>
  <button class="btn-lg btn-primary" onclick="calculateMedals()" style="margin-top:8px;">ğŸ–ï¸ Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…ÙŠØ¯Ø§Ù„ÙŠØ§Øª</button>
  <div id="medalResults"></div>
</div>

<div class="card">
  <h2>ğŸ’ Ø­Ø§Ø³Ø¨Ø© Ø´Ø¸Ø§ÙŠØ§ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</h2>
  <p style="font-size:.82rem;color:var(--text-sub);margin-bottom:12px;">Ø§Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø¸Ø§ÙŠØ§ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù†Ø¬ÙˆÙ…</p>
  <div class="stats-grid">
    <div class="input-group" style="margin:0"><label>Ù…Ù† Ù†Ø¬Ù…Ø©</label>
      <select id="shardFrom" style="width:100%;padding:11px;border-radius:10px;border:1px solid var(--border);background:var(--bg-body);color:var(--text-main);font-family:Tajawal;font-size:14px;">
        <option value="0">0 (Ø¨Ø¯ÙˆÙ†)</option><option value="1">â­ 1</option><option value="2">â­â­ 2</option><option value="3">â­â­â­ 3</option><option value="4">â­â­â­â­ 4</option>
      </select>
    </div>
    <div class="input-group" style="margin:0"><label>Ø¥Ù„Ù‰ Ù†Ø¬Ù…Ø©</label>
      <select id="shardTo" style="width:100%;padding:11px;border-radius:10px;border:1px solid var(--border);background:var(--bg-body);color:var(--text-main);font-family:Tajawal;font-size:14px;">
        <option value="1">â­ 1</option><option value="2">â­â­ 2</option><option value="3">â­â­â­ 3</option><option value="4">â­â­â­â­ 4</option><option value="5" selected>â­â­â­â­â­ 5</option>
      </select>
    </div>
  </div>
  <button class="btn-lg btn-primary" onclick="calculateShards()" style="margin-top:12px;">ğŸ’ Ø§Ø­Ø³Ø¨ Ø§Ù„Ø´Ø¸Ø§ÙŠØ§</button>
  <div id="shardResults"></div>
</div>

<div class="card">
  <h2>ğŸ¥ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø´ÙØ§Ø¡</h2>
  <p style="font-size:.82rem;color:var(--text-sub);margin-bottom:12px;">Ø§Ø­Ø³Ø¨ Ø³Ø¹Ø© Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ù„Ø§Ø²Ù… Ù„Ù„Ø´ÙØ§Ø¡</p>
  <div class="stats-grid">
    <div class="input-group" style="margin:0"><label>Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ù†ÙˆØ¯ Ø§Ù„Ù…ØµØ§Ø¨ÙŠÙ†</label><input type="text" id="healWounded" value="50000" inputmode="numeric"></div>
    <div class="input-group" style="margin:0"><label>Ø³Ø¹Ø© Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰</label><input type="text" id="healCapacity" value="20000" inputmode="numeric"></div>
  </div>
  <div class="stats-grid" style="margin-top:10px;">
    <div class="input-group" style="margin:0"><label>ÙˆÙ‚Øª Ø§Ù„Ø´ÙØ§Ø¡/Ø¬Ù†Ø¯ÙŠ (Ø«Ø§Ù†ÙŠØ©)</label><input type="number" id="healTime" value="5" min="1" inputmode="numeric"></div>
    <div class="input-group" style="margin:0"><label>Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø­Ù„Ù (ØªÙ‚Ù„ÙŠÙ„ %)</label><input type="number" id="healAllianceHelp" value="20" min="0" max="50" inputmode="numeric"></div>
  </div>
  <button class="btn-lg btn-primary" onclick="calculateHealing()" style="margin-top:12px;">ğŸ¥ Ø§Ø­Ø³Ø¨ Ø§Ù„Ø´ÙØ§Ø¡</button>
  <div id="healResults"></div>
</div>

<div class="card">
  <h2>ğŸ“‹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©</h2>
  <div style="font-size:.82rem;line-height:1.8;">
    <div style="font-weight:700;color:var(--primary);margin-bottom:8px;">ğŸ›¡ï¸ Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø¯ÙØ§Ø¹ (Ù…ÙØ«Ø¨ØªØ©)</div>
    <div style="padding:10px;background:var(--bg-body);border-radius:10px;font-family:monospace;text-align:center;margin-bottom:12px;direction:ltr;font-size:.8rem;">Damage = ATK Ã— 4000 / (DEF + 4000)</div>
    <div style="font-weight:700;color:var(--primary);margin-bottom:8px;">â¤ï¸ Ø§Ù„ØµØ­Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©</div>
    <div style="padding:10px;background:var(--bg-body);border-radius:10px;font-family:monospace;text-align:center;margin-bottom:12px;direction:ltr;font-size:.8rem;">EHP = HP Ã— (DEF + 4000) / 4000</div>
    <div style="font-weight:700;color:var(--primary);margin-bottom:8px;">âš”ï¸ Ø£ÙØ¶Ù„ÙŠØ© Ø§Ù„Ù†ÙˆØ¹</div>
    <div style="padding:10px;background:var(--bg-body);border-radius:10px;margin-bottom:12px;">
      ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø© â†’ ğŸš€ ØµØ§Ø±ÙˆØ® â†’ âœˆï¸ Ø·Ø§Ø¦Ø±Ø© â†’ ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©<br>
      <span style="color:var(--success);">+20% Ø¶Ø±Ø±</span> Ø¶Ø¯ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¶Ø¹Ù | <span style="color:var(--danger);">-20%</span> Ø¶Ø¯ Ø§Ù„Ø£Ù‚ÙˆÙ‰
    </div>
    <div style="font-weight:700;color:var(--primary);margin-bottom:8px;">ğŸ‘¥ Ø¨ÙˆÙ†Øµ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©</div>
    <div style="padding:10px;background:var(--bg-body);border-radius:10px;">3 Ù†ÙØ³ Ø§Ù„Ù†ÙˆØ¹ = +5% | 3+2 = +10% | 4 = +15% | 5 = +20%</div>
  </div>
</div>
```

  </div><!-- /tools -->

  <!-- â•â•â•â•â•â•â•â•â•â• SAVED TAB â•â•â•â•â•â•â•â•â•â• -->

  <div id="saved" class="tab-content">
    <div class="card">
      <h2>ğŸ’¾ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h2>
      <div id="savedList"></div>
    </div>
  </div><!-- /saved -->

  <!-- â•â•â•â•â•â•â•â•â•â• CHARTS TAB â•â•â•â•â•â•â•â•â•â• -->

  <div id="charts" class="tab-content">
    <div class="card">
      <h2>ğŸ“Š Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h2>
      <div class="chart-wrapper"><canvas id="skillChart"></canvas></div>
    </div>
    <div class="card">
      <h2>ğŸ“ˆ Ù…Ù†Ø­Ù†Ù‰ Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª</h2>
      <div class="chart-wrapper"><canvas id="upgradeChart"></canvas></div>
    </div>
  </div><!-- /charts -->

</div><!-- /container -->

<!-- Footer outside container -->

<div class="footer">
  <img src="https://i.pinimg.com/736x/d0/f6/36/d0f636b1d0308c95b4ffcc75c3df88bc.jpg" alt="Jiraiya" class="footer-avatar">
  <h3>DistopÇa - 1930</h3>
  <p>ğŸ® Master Tactician</p>
  <p>âš”ï¸ Last War: Survival Game</p>
  <p style="margin-top:10px;opacity:.7;">"Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ØªØ£ØªÙŠ Ù…Ù† Ø§Ù„ØªØ®Ø·ÙŠØ· ÙˆØ§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©"</p>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„Ø£Ø®ÙŠØ±Ø© Pro Max - v5.2
   Built by DistopÇa
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const STAR_BONUS=[.30,.70,1.20,1.85,2.70];
const SKILL_MULTIPLIER=[1.0,3.45,4.05];
const SKILL_NAMES=['Ø¹Ø§Ø¯ÙŠØ© âš”ï¸','Ø®Ø§ØµØ© ğŸ”¥','Ù†Ù‡Ø§Ø¦ÙŠØ© ğŸ’¥'];
const TYPE_NAMES={tank:'ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©',plane:'âœˆï¸ Ø·Ø§Ø¦Ø±Ø©',missile:'ğŸš€ ØµØ§Ø±ÙˆØ®'};
const TYPE_ADVANTAGE={tank:'missile',missile:'plane',plane:'tank'};
const LINEUP_BONUS=[0,.05,.10,.15,.20];
const DEF_CONSTANT=4000;
const SHARD_COSTS=[25,50,100,300,500];

const HERO_EXP=[
  0,100,200,300,400,500,600,700,800,900,
  1000,1100,1200,1300,1400,1500,1600,1700,1800,1900,
  2000,2200,2300,2700,3200,3900,4600,5500,6600,8000,
  9500,12000,14000,17000,20000,24000,29000,35000,41000,49000,
  59000,71000,85000,110000,130000,150000,180000,220000,260000,310000,
  370000,440000,530000,630000,760000,910000,1100000,1400000,1600000,1900000,
  2100000,2300000,2500000,2800000,3100000,3400000,3700000,4100000,4500000,4900000,
  5400000,5900000,6500000,7200000,7900000,8700000,9500000,11000000,12000000,13000000,
  13000000,14000000,14000000,15000000,16000000,17000000,17000000,
  18000000,19000000,20000000,21000000,22000000,24000000,26000000,28000000,30000000,32000000,35000000,38000000,41000000,
  44000000,47000000,50000000,54000000,58000000,62000000,66000000,70000000,75000000,80000000,
  85000000,90000000,95000000,100000000,105000000,110000000,116000000,122000000,128000000,135000000,
  142000000,149000000,157000000,165000000,173000000,181000000,190000000,199000000,208000000,218000000,
  228000000,239000000,250000000,261000000,273000000,285000000,298000000,311000000,325000000,339000000,
  354000000,369000000,385000000,401000000,418000000,435000000,453000000,472000000,491000000,511000000,
  532000000,554000000,576000000,599000000,623000000,648000000,674000000,700000000,728000000,756000000,
  786000000,816000000,848000000,881000000,916000000,952000000,989000000,1028000000,1068000000,1110000000,
  1154000000,1200000000,1247000000,1296000000,1348000000
];

const HQ_CAPS={5:1,10:2,15:3,20:4,25:5,30:6,35:7,40:8,45:9,50:10,55:11,60:12,65:13,70:14,75:15,80:16,85:17,90:18,95:19,100:20,105:21,110:22,115:23,120:24,125:25,130:26,135:27,140:28,145:29,150:30,155:31,160:32,165:33,170:34,175:35};

const MEDAL_COSTS_UR=[0,200,400,600,800,1000,1400,1800,2200,2600,3200,3800,4400,5000,5800,6600,7600,8600,9800,11000,12400,13800,15400,17200,19000,21000,23200,25600,28200,26000,28000,30000,32000,34000,36000,38000,40000,42000,44000];
const MEDAL_RATIO={UR:1.0,SSR:0.9,SR:0.74};

const TIER_LIST={'SS':['Fiona'],'S':['Kimberly','DVA','Tesla','Williams','Marshall','Stetmann'],'A':['Murphy','Carlie','Schuyler','Lucius','Morrison','McGregor'],'B':['Adam','Swift','Mason','Violet','Scarlett'],'C':['Jackson','Emma','Lily','Noah','Sophia','Ethan','Ava','Lucas','Isabella'],'D':[]};
const TIER_COLORS={'SS':'#ff4444','S':'#ff8800','A':'#44bb44','B':'#4488ff','C':'#aa77cc','D':'#888888'};

const META_TEAMS=[
  {name:'ğŸŸ« ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¨Ø§Ø¨Ø§Øª Ø§Ù„Ù…ÙŠØªØ§',heroes:['Williams','Murphy','Kimberly','Tesla','Stetmann'],desc:'Ø£Ù‚ÙˆÙ‰ ØªØ´ÙƒÙŠÙ„Ø© Ø¯ÙØ§Ø¹ÙŠØ© â€” Williams Ù„Ù„Ø­Ù…Ø§ÙŠØ© + Kimberly/Tesla Ù„Ù„Ø¶Ø±Ø±'},
  {name:'âœˆï¸ ÙØ±ÙŠÙ‚ Ø§Ù„Ø·Ø§Ø¦Ø±Ø§Øª Ø§Ù„Ù…ÙŠØªØ§',heroes:['Carlie','Lucius','Schuyler','DVA','Morrison'],desc:'Ø£Ù‚ÙˆÙ‰ Ø¶Ø±Ø± Ø§Ù†ÙØ¬Ø§Ø±ÙŠ â€” DVA/Schuyler Ù„Ù„Ù€ burst + Carlie/Lucius Ù„Ù„Ø­Ù…Ø§ÙŠØ©'},
  {name:'ğŸš€ ÙØ±ÙŠÙ‚ Ø§Ù„ØµÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠØªØ§',heroes:['Fiona','Tesla','Adam','McGregor','Swift'],desc:'Ø£Ù‚ÙˆÙ‰ Ø¶Ø±Ø± Ù…Ø³Ø§Ø­ÙŠ â€” Fiona SS-tier nuker + Tesla Ù„Ù„Ø·Ø§Ù‚Ø©'},
];

const IMG_BASE='https://www.lastwargame.online/wp-content/uploads/2026/01/';
const HEROES=[
  {name:'Fiona',nameAr:'ÙÙŠÙˆÙ†Ø§',title:'Lion Cub',type:'missile',role:'attack',rarity:'UR',dmg:'physical',desc:'AoE Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù â€” SS-tier nuker',img:IMG_BASE+'fiona_icon.webp'},
  {name:'Kimberly',nameAr:'ÙƒÙŠÙ…Ø¨Ø±Ù„ÙŠ',title:'Rocket Shadow',type:'tank',role:'attack',rarity:'UR',dmg:'energy',desc:'AoE Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¶Ø±Ø± â€” S-tier',img:IMG_BASE+'kimberly_icon.webp'},
  {name:'DVA',nameAr:'Ø¯ÙŠÙØ§',title:'Sky Reaver',type:'plane',role:'attack',rarity:'UR',dmg:'energy',desc:'Ø¶Ø±Ø± Ø§Ù†ÙØ¬Ø§Ø±ÙŠ + Ø³Ø±Ø¹Ø© Ù‡Ø¬ÙˆÙ… â€” S-tier',img:IMG_BASE+'dva_icon.webp'},
  {name:'Tesla',nameAr:'ØªÙŠØ³Ù„Ø§',title:'Magnetic Expert',type:'missile',role:'attack',rarity:'UR',dmg:'energy',desc:'Ø¶Ø±Ø± Ø·Ø§Ù‚Ø© + Ø­Ø±Ø¬Ø§Øª Ø¹Ø§Ù„ÙŠØ© â€” S-tier',img:IMG_BASE+'tesla_icon.webp'},
  {name:'Williams',nameAr:'ÙˆÙŠÙ„ÙŠØ§Ù…Ø²',title:'Storm Hunter',type:'tank',role:'defense',rarity:'UR',dmg:'physical',desc:'ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø± Ø§Ù„ÙØ±ÙŠÙ‚ â€” S-tier',img:IMG_BASE+'williams_icon.webp'},
  {name:'Marshall',nameAr:'Ù…Ø§Ø±Ø´Ø§Ù„',title:'Blade of Legion',type:'tank',role:'support',rarity:'UR',dmg:'energy',desc:'Ø¯Ø¹Ù… Ø´Ø§Ù…Ù„ + ØªØ¹Ø²ÙŠØ² Ù‡Ø¬ÙˆÙ… â€” S-tier',img:IMG_BASE+'marshall_icon.webp'},
  {name:'Stetmann',nameAr:'Ø³ØªÙŠØªÙ…Ø§Ù†',title:'EM Hunter',type:'tank',role:'attack',rarity:'UR',dmg:'energy',desc:'Ø¶Ø±Ø± ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ Ù…Ø³ØªÙ…Ø± â€” S-tier',img:IMG_BASE+'stetmann_icon.webp'},
  {name:'Murphy',nameAr:'Ù…ÙŠØ±ÙÙŠ',title:'Unyielding Warrior',type:'tank',role:'defense',rarity:'UR',dmg:'physical',desc:'Ø¯Ø¨Ø§Ø¨Ø© Ø¯ÙØ§Ø¹ÙŠØ© Ù‚ÙˆÙŠØ© â€” A-tier',img:IMG_BASE+'merfi.webp'},
  {name:'Carlie',nameAr:'ÙƒØ§Ø±Ù„ÙŠ',title:'Scamp',type:'plane',role:'defense',rarity:'UR',dmg:'physical',desc:'ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø± Ø§Ù„Ø·Ø§Ù‚Ø© â€” A-tier',img:IMG_BASE+'carlie_icon.webp'},
  {name:'Schuyler',nameAr:'Ø´ÙˆÙŠÙ„Ø±',title:'Magblade',type:'plane',role:'attack',rarity:'UR',dmg:'energy',desc:'ØµØ¹Ù‚ + Ø´Ù„Ù„ + AoE â€” A-tier',img:IMG_BASE+'schuyler_icon.webp'},
  {name:'Lucius',nameAr:'Ù„ÙˆØ³ÙŠÙˆØ³',title:'Sky Knight',type:'plane',role:'defense',rarity:'UR',dmg:'physical',desc:'ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø± Ø§Ù„ØµÙ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ â€” A-tier',img:IMG_BASE+'lucius_icon.webp'},
  {name:'Morrison',nameAr:'Ù…ÙˆØ±ÙŠØ³ÙˆÙ†',title:'The Reaper',type:'plane',role:'attack',rarity:'UR',dmg:'physical',desc:'Ø¶Ø±Ø± Ø§Ù†ÙØ¬Ø§Ø±ÙŠ + ØªÙ‚Ù„ÙŠÙ„ Ø¯ÙØ§Ø¹ â€” A-tier',img:IMG_BASE+'morrison_icon.webp'},
  {name:'McGregor',nameAr:'Ù…Ø§ÙƒØºØ±ÙŠØºÙˆØ±',title:'Ironclad General',type:'missile',role:'defense',rarity:'UR',dmg:'physical',desc:'Ø§Ø³ØªÙØ²Ø§Ø² + Ø­Ù…Ø§ÙŠØ© â€” A-tier',img:IMG_BASE+'mcgregor_icon.webp'},
  {name:'Swift',nameAr:'Ø³ÙˆÙŠÙØª',title:'Thunder',type:'missile',role:'attack',rarity:'UR',dmg:'physical',desc:'Ø¥Ø¹Ø¯Ø§Ù… Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ Ø¶Ø¹Ø§Ù HP â€” B-tier',img:IMG_BASE+'swift_icon.webp'},
  {name:'Adam',nameAr:'Ø¢Ø¯Ù…',title:'Titan',type:'missile',role:'defense',rarity:'UR',dmg:'physical',desc:'Ù‡Ø¬ÙˆÙ… Ù…Ø¶Ø§Ø¯ + ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø± â€” B-tier',img:IMG_BASE+'adam_icon.webp'},
  {name:'Mason',nameAr:'Ù…ÙŠØ³ÙˆÙ†',title:'Zombie Bane',type:'tank',role:'attack',rarity:'UR',dmg:'physical',desc:'AoE + ØªØ¹Ø²ÙŠØ² Ø¶Ø¯ Ø§Ù„ÙˆØ­ÙˆØ´ â€” B-tier',img:''},
  {name:'Violet',nameAr:'ÙÙŠÙˆÙ„ÙŠØª',title:'Frost Guard',type:'tank',role:'defense',rarity:'UR',dmg:'physical',desc:'Ø¯Ø±Ø¹ Ø¬Ù„ÙŠØ¯ + Ø¥Ø¶Ø¹Ø§Ù â€” B-tier',img:''},
  {name:'Scarlett',nameAr:'Ø³ÙƒØ§Ø±Ù„ÙŠØª',title:'Iron Rose',type:'tank',role:'defense',rarity:'UR',dmg:'physical',desc:'ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø± + Ø²ÙŠØ§Ø¯Ø© Ø¯ÙØ§Ø¹ â€” B-tier',img:''},
  {name:'Helena',nameAr:'Ù‡ÙŠÙ„ÙŠÙ†Ø§',title:'Healer',type:'tank',role:'support',rarity:'SSR',dmg:'energy',desc:'Ø¯Ø¹Ù… + Ø´ÙØ§Ø¡',img:''},
  {name:'Marcus',nameAr:'Ù…Ø§Ø±ÙƒÙˆØ³',title:'Warlord',type:'missile',role:'attack',rarity:'SSR',dmg:'physical',desc:'Ø¶Ø±Ø± Ù…Ø³Ø§Ø­ÙŠ Ù‚ÙˆÙŠ',img:''},
  {name:'Monica',nameAr:'Ù…ÙˆÙ†ÙŠÙƒØ§',title:'Supplier',type:'tank',role:'support',rarity:'SSR',dmg:'energy',desc:'ØªØ¹Ø²ÙŠØ² Ù…ÙˆØ§Ø±Ø¯ + Ø¶Ø±Ø± Ø²ÙˆÙ…Ø¨ÙŠ',img:''},
  {name:'Ambolt',nameAr:'Ø£Ù…Ø¨ÙˆÙ„Øª',title:'Medic',type:'plane',role:'support',rarity:'SSR',dmg:'energy',desc:'Ø´ÙØ§Ø¡ Ø£Ø³Ø§Ø³ÙŠ',img:''},
  {name:'Cage',nameAr:'ÙƒÙŠØ¬',title:'Shield',type:'plane',role:'defense',rarity:'SSR',dmg:'physical',desc:'ØªØ¹Ø²ÙŠØ² Ø¯ÙØ§Ø¹ Ø§Ù„Ø£Ù…Ø§Ù…',img:''},
  {name:'Drake',nameAr:'Ø¯Ø±ÙŠÙƒ',title:'Fortress',type:'tank',role:'defense',rarity:'SSR',dmg:'physical',desc:'Ø¯Ø¨Ø§Ø¨Ø© Ù…ØªÙˆØ³Ø·Ø©',img:''},
  {name:'Kane',nameAr:'ÙƒÙŠÙ†',title:'Sniper',type:'missile',role:'attack',rarity:'SSR',dmg:'physical',desc:'Ø¶Ø±Ø± Ù‡Ø¯Ù ÙˆØ§Ø­Ø¯',img:''},
  {name:'Maxwell',nameAr:'Ù…Ø§ÙƒØ³ÙˆÙŠÙ„',title:'Shock',type:'plane',role:'attack',rarity:'SSR',dmg:'physical',desc:'Ø¶Ø±Ø± ÙÙŠØ²ÙŠØ§Ø¦ÙŠ + ØµØ¹Ù‚',img:''},
  {name:'Richard',nameAr:'Ø±ÙŠØªØ´Ø§Ø±Ø¯',title:'Vanguard',type:'tank',role:'attack',rarity:'SSR',dmg:'physical',desc:'Ø¶Ø±Ø± Ù…ØªØ¹Ø¯Ø¯ Ø£Ù‡Ø¯Ø§Ù',img:''},
  {name:'Sarah',nameAr:'Ø³Ø§Ø±Ø©',title:'Hunter',type:'plane',role:'support',rarity:'SSR',dmg:'energy',desc:'ØªØ¹Ø²ÙŠØ² Ø¶Ø±Ø± ÙˆØ­ÙˆØ´',img:''},
  {name:'Venom',nameAr:'ÙÙŠÙ†ÙˆÙ…',title:'Toxin',type:'missile',role:'attack',rarity:'SSR',dmg:'energy',desc:'Ø¶Ø±Ø± Ø³Ù… Ù…Ø³ØªÙ…Ø±',img:''},
  {name:'Farhad',nameAr:'ÙØ±Ù‡Ø§Ø¯',title:'Recruit',type:'tank',role:'attack',rarity:'SR',dmg:'physical',desc:'Ù…Ù‡Ø§Ø¬Ù… Ø£Ø³Ø§Ø³ÙŠ',img:''},
  {name:'Elsa',nameAr:'Ø¥Ù„Ø³Ø§',title:'Frost',type:'tank',role:'defense',rarity:'SR',dmg:'energy',desc:'Ø¥Ø¨Ø·Ø§Ø¡ + ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø±',img:''},
  {name:'Blaz',nameAr:'Ø¨Ù„Ø§Ø²',title:'Flame',type:'missile',role:'attack',rarity:'SR',dmg:'physical',desc:'ÙØ¹Ø§Ù„ Ø¶Ø¯ Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ ÙÙ‚Ø·',img:''},
  {name:'Gump',nameAr:'ØºØ§Ù…Ø¨',title:'Blaze',type:'tank',role:'attack',rarity:'SR',dmg:'physical',desc:'Ù‡Ø¬ÙˆÙ… Ù†Ø§Ø±ÙŠ',img:''},
  {name:'Loki',nameAr:'Ù„ÙˆÙƒÙŠ',title:'Guard',type:'tank',role:'defense',rarity:'SR',dmg:'physical',desc:'Ø¯ÙØ§Ø¹ Ø£Ø³Ø§Ø³ÙŠ',img:''},
  {name:'Jackson',nameAr:'Ø¬Ø§ÙƒØ³ÙˆÙ†',title:'Cadet',type:'tank',role:'defense',rarity:'SR',dmg:'physical',desc:'Ø¯Ø¨Ø§Ø¨Ø© Ù…Ø¨ØªØ¯Ø¦Ø© Ø¬ÙŠØ¯Ø©',img:''},
  {name:'Noah',nameAr:'Ù†ÙˆØ­',title:'Salvager',type:'tank',role:'defense',rarity:'SR',dmg:'physical',desc:'Ø¯Ø¨Ø§Ø¨Ø© ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ø±ØªØ¬Ù„Ø©',img:''},
  {name:'Lucas',nameAr:'Ù„ÙˆÙƒØ§Ø³',title:'Reserve',type:'tank',role:'defense',rarity:'SR',dmg:'physical',desc:'Ù…Ø´ØºÙ„ Ø¯Ø¨Ø§Ø¨Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠ',img:''},
  {name:'Emma',nameAr:'Ø¥ÙŠÙ…Ø§',title:'Researcher',type:'missile',role:'attack',rarity:'SR',dmg:'energy',desc:'ØµØ§Ø±ÙˆØ® Ø¨Ø­Ø« Ø£Ø³Ø§Ø³ÙŠ',img:''},
  {name:'Ethan',nameAr:'Ø¥ÙŠØ«Ø§Ù†',title:'Militia',type:'missile',role:'attack',rarity:'SR',dmg:'physical',desc:'ØªØ¯Ø±ÙŠØ¨ ØµØ§Ø±ÙˆØ®ÙŠ Ø£Ø³Ø§Ø³ÙŠ',img:''},
  {name:'Isabella',nameAr:'Ø¥ÙŠØ²Ø§Ø¨ÙŠÙ„Ø§',title:'Trainee',type:'missile',role:'attack',rarity:'SR',dmg:'physical',desc:'Ù…ØªØ¯Ø±Ø¨Ø© Ù…Ø¯ÙØ¹ÙŠØ©',img:''},
  {name:'Lily',nameAr:'Ù„ÙŠÙ„ÙŠ',title:'Pilot',type:'plane',role:'attack',rarity:'SR',dmg:'physical',desc:'Ø·ÙŠØ§Ø±Ø© Ù…ØªØ¯Ø±Ø¨Ø©',img:''},
  {name:'Sophia',nameAr:'ØµÙˆÙÙŠØ§',title:'Medivac',type:'plane',role:'support',rarity:'SR',dmg:'energy',desc:'Ø¯Ø¹Ù… Ø·Ø¨ÙŠ Ø¬ÙˆÙŠ',img:''},
  {name:'Ava',nameAr:'Ø¢ÙØ§',title:'Scout',type:'plane',role:'attack',rarity:'SR',dmg:'physical',desc:'Ø·Ø§Ø¦Ø±Ø© Ø§Ø³ØªØ·Ù„Ø§Ø¹',img:''},
];

const ROLE_NAMES={attack:'âš”ï¸ Ù…Ù‡Ø§Ø¬Ù…',defense:'ğŸ›¡ï¸ Ù…Ø¯Ø§ÙØ¹',support:'ğŸ’Š Ø¯Ø¹Ù…'};
const RARITY_COLORS={UR:'#f6ad55',SSR:'#b794f4',SR:'#63b3ed'};
const DMG_ICONS={physical:'ğŸ’¥',energy:'âš¡'};
const SKILL_TYPES={auto:{icon:'ğŸ¯',name:'Ù‡Ø¬Ù…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©',color:'#e53e3e'},tactics:{icon:'ğŸ’¡',name:'ØªÙƒØªÙŠÙƒÙŠØ©',color:'#3182ce'},passive:{icon:'ğŸ”®',name:'Ø³Ù„Ø¨ÙŠØ©',color:'#38a169'},expertise:{icon:'ğŸ‘‘',name:'Ø®Ø¨Ø±Ø©',color:'#d69e2e'}};
const HERO_SKILLS={
  'Fiona':{auto:{name:'Double Trajectory',nameAr:'Ù…Ø³Ø§Ø± Ù…Ø²Ø¯ÙˆØ¬',desc:'Ø¥Ø·Ù„Ø§Ù‚ ØµØ§Ø±ÙˆØ® Ù…Ø¶Ø§Ø¯ Ù„Ù„Ø·Ø§Ø¦Ø±Ø§Øª â€” Ø¶Ø±Ø± ÙÙŠØ²ÙŠØ§Ø¦ÙŠ'},tactics:{name:'Atomic Blast',nameAr:'Ø§Ù†ÙØ¬Ø§Ø± Ø°Ø±ÙŠ',desc:'ØµØ§Ø±ÙˆØ® ÙŠØ¶Ø±Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡'},passive:{name:'Ballistic Boost',nameAr:'ØªØ¹Ø²ÙŠØ² Ø¨Ø§Ù„ÙŠØ³ØªÙŠ',desc:'ÙŠØ²ÙŠØ¯ Ø§Ù„Ø¶Ø±Ø± Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠ'},expertise:{name:'Super Sensing',nameAr:'Ø­Ø§Ø³Ø© Ø®Ø§Ø±Ù‚Ø©',desc:'HP/Ù‡Ø¬ÙˆÙ…/Ø¯ÙØ§Ø¹ +20%ØŒ ØªØ¨Ø±ÙŠØ¯ +10%'}},
  'Kimberly':{auto:{name:'Energy Assault',nameAr:'Ù‡Ø¬ÙˆÙ… Ø·Ø§Ù‚Ø©',desc:'ØµØ§Ø±ÙˆØ® Ø¹Ù„Ù‰ Ø¹Ø¯Ùˆ Ø¹Ø´ÙˆØ§Ø¦ÙŠ â€” Ø·Ø§Ù‚Ø©'},tactics:{name:'Barrage Strike',nameAr:'Ø¶Ø±Ø¨Ø© ÙˆØ§Ø¨Ù„ÙŠØ©',desc:'8 ØµÙˆØ§Ø±ÙŠØ® Ø¹Ù„Ù‰ Ø£Ø¹Ø¯Ø§Ø¡ Ø¹Ø´ÙˆØ§Ø¦ÙŠÙŠÙ†'},passive:{name:'Energy Boost',nameAr:'ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø·Ø§Ù‚Ø©',desc:'ÙŠØ²ÙŠØ¯ Ø¶Ø±Ø± Ø§Ù„Ø·Ø§Ù‚Ø©'},expertise:{name:'Super Sensing',nameAr:'Ø­Ø§Ø³Ø© Ø®Ø§Ø±Ù‚Ø©',desc:'HP/Ù‡Ø¬ÙˆÙ…/Ø¯ÙØ§Ø¹ +20%ØŒ ØªØ¨Ø±ÙŠØ¯ +10%'}},
  'DVA':{auto:{name:'Vortex Missile',nameAr:'ØµØ§Ø±ÙˆØ® Ø¯ÙˆØ§Ù…ÙŠ',desc:'ØµØ§Ø±ÙˆØ® Ø·Ø§Ù‚Ø© (ØªØ¨Ø±ÙŠØ¯: 1.35Ø«)'},tactics:{name:'Steel Barrage',nameAr:'ÙˆØ§Ø¨Ù„ ÙÙˆÙ„Ø§Ø°ÙŠ',desc:'Ù‡Ø¬ÙˆÙ… Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡'},passive:{name:'Precision Upgrade',nameAr:'ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¯Ù‚Ø©',desc:'ÙŠØ²ÙŠØ¯ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø±Ø¬Ø§Øª'},expertise:{name:'Super Sensing',nameAr:'Ø­Ø§Ø³Ø© Ø®Ø§Ø±Ù‚Ø©',desc:'HP/Ù‡Ø¬ÙˆÙ…/Ø¯ÙØ§Ø¹ +20%ØŒ ØªØ¨Ø±ÙŠØ¯ +10%'}},
  'Tesla':{auto:{name:'Lightning Chain',nameAr:'Ø³Ù„Ø³Ù„Ø© Ø¨Ø±Ù‚',desc:'Ø£Ù‚ÙˆØ§Ø³ Ø·Ø§Ù‚Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©'},tactics:{name:'Electric Grid Lockdown',nameAr:'Ø¥ØºÙ„Ø§Ù‚ Ø´Ø¨ÙƒØ© ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©',desc:'Ù‡Ø¬ÙˆÙ… Ø¹Ù„Ù‰ 3 ÙˆØ­Ø¯Ø§Øª Ø®Ù„ÙÙŠØ©'},passive:{name:'Electric Power Boost',nameAr:'ØªØ¹Ø²ÙŠØ² Ø§Ù„Ù‚ÙˆØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©',desc:'ÙŠØ²ÙŠØ¯ Ø¶Ø±Ø± Ø§Ù„Ø·Ø§Ù‚Ø©'},expertise:{name:'Super Sensing',nameAr:'Ø­Ø§Ø³Ø© Ø®Ø§Ø±Ù‚Ø©',desc:'HP/Ù‡Ø¬ÙˆÙ…/Ø¯ÙØ§Ø¹ +20%ØŒ ØªØ¨Ø±ÙŠØ¯ +10%'}},
  'Williams':{auto:{name:'Stun Bomb',nameAr:'Ù‚Ù†Ø¨Ù„Ø© ØµØ§Ø¹Ù‚Ø©',desc:'Ù‚Ù†Ø¨Ù„Ø© ØµØ§Ø¹Ù‚Ø© Ø§Ù†ÙØ¬Ø§Ø±ÙŠØ©'},tactics:{name:'Iron Will',nameAr:'Ø¥Ø±Ø§Ø¯Ø© Ø­Ø¯ÙŠØ¯ÙŠØ©',desc:'ØªØ¹Ø²ÙŠØ² Ø¯ÙØ§Ø¹ Ø£ÙˆÙ„ ÙˆØ­Ø¯ØªÙŠÙ† 10 Ø«ÙˆØ§Ù†ÙŠ'},passive:{name:'All-Around Armor',nameAr:'Ø¯Ø±Ø¹ Ø´Ø§Ù…Ù„',desc:'ØªÙ‚Ù„ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¶Ø±Ø§Ø± Ø§Ù„ÙˆØ§Ø±Ø¯Ø©'},expertise:{name:'Super Sensing',nameAr:'Ø­Ø§Ø³Ø© Ø®Ø§Ø±Ù‚Ø©',desc:'HP/Ù‡Ø¬ÙˆÙ…/Ø¯ÙØ§Ø¹ +20%ØŒ ØªØ¨Ø±ÙŠØ¯ +10%'}},
  'Marshall':{auto:{name:'Triad Harmony',nameAr:'Ø§Ù†Ø³Ø¬Ø§Ù… Ø«Ù„Ø§Ø«ÙŠ',desc:'Ø±Ø´Ø§Ø´ Ù…Ø«Ø¨Øª â€” Ø¶Ø±Ø± Ø®Ø§Ø±Ù‚'},tactics:{name:'Command Strategy',nameAr:'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù‚ÙŠØ§Ø¯Ø©',desc:'ÙŠØ²ÙŠØ¯ Ù‡Ø¬ÙˆÙ… Ø§Ù„ÙØ±ÙŠÙ‚ 6 Ø«ÙˆØ§Ù†ÙŠ'},passive:{name:'Rapid Start',nameAr:'Ø¨Ø¯Ø§ÙŠØ© Ø³Ø±ÙŠØ¹Ø©',desc:'ÙŠØ²ÙŠØ¯ Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ¨Ø±ÙŠØ¯ + ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø±'},expertise:{name:'Super Sensing',nameAr:'Ø­Ø§Ø³Ø© Ø®Ø§Ø±Ù‚Ø©',desc:'HP/Ù‡Ø¬ÙˆÙ…/Ø¯ÙØ§Ø¹ +20%ØŒ ØªØ¨Ø±ÙŠØ¯ +10%'}},
  'Murphy':{auto:{name:'Cannon Fire',nameAr:'Ù†ÙŠØ±Ø§Ù† Ø§Ù„Ù…Ø¯ÙØ¹',desc:'Ù‚Ø°ÙŠÙØ© Ù…Ø¯ÙØ¹ â€” Ø¶Ø±Ø± ÙÙŠØ²ÙŠØ§Ø¦ÙŠ'},tactics:{name:'Ironclad Barrier',nameAr:'Ø­Ø§Ø¬Ø² Ø­Ø¯ÙŠØ¯ÙŠ',desc:'ØªØ¹Ø²ÙŠØ² ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¶Ø±Ø± Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ 5 Ø«ÙˆØ§Ù†ÙŠ'},passive:{name:'Stand Firm',nameAr:'ØµÙ…ÙˆØ¯',desc:'ØªÙ‚Ù„ÙŠÙ„ Ø£Ø¶Ø±Ø§Ø± Ø§Ù„ØµÙ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ'},expertise:{name:'Super Sensing',nameAr:'Ø­Ø§Ø³Ø© Ø®Ø§Ø±Ù‚Ø©',desc:'HP/Ù‡Ø¬ÙˆÙ…/Ø¯ÙØ§Ø¹ +20%ØŒ ØªØ¨Ø±ÙŠØ¯ +10%'}},
  'Adam':{auto:{name:'MK43 Machine Gun',nameAr:'Ø±Ø´Ø§Ø´ MK43',desc:'Ø¶Ø±Ø± ÙÙŠØ²ÙŠØ§Ø¦ÙŠ Ù„Ø¹Ø¯Ùˆ ÙˆØ§Ø­Ø¯'},tactics:{name:'Counter Defense',nameAr:'Ø¯ÙØ§Ø¹ Ù…Ø¶Ø§Ø¯',desc:'ÙˆØ¶Ø¹ Ø¯ÙØ§Ø¹ Ù…Ø¶Ø§Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ'},passive:{name:'Spike Armor',nameAr:'Ø¯Ø±Ø¹ Ø´ÙˆÙƒÙŠ',desc:'ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø± Ø§Ù„Ø£Ù…Ø§Ù…'},expertise:{name:'Super Sensing',nameAr:'Ø­Ø§Ø³Ø© Ø®Ø§Ø±Ù‚Ø©',desc:'HP/Ù‡Ø¬ÙˆÙ…/Ø¯ÙØ§Ø¹ +20%ØŒ ØªØ¨Ø±ÙŠØ¯ +10%'}},
};

// â”€â”€ State â”€â”€
let selectedStars=0,selectedSkill=0,selectedLineup=1,selectedMedalRarity='UR';
let teamSlots=[],skillChartInstance=null,upgradeChartInstance=null;

// â”€â”€ Utilities â”€â”€
function parseValue(str){
  if(!str)return 0;
  str=String(str).trim().toUpperCase().replace(/,/g,'').replace(/\s/g,'');
  const m=str.match(/^([\d.]+)\s*([KMBT]?)$/i);
  if(m){const n=parseFloat(m[1]),s=m[2].toUpperCase();return s?n*({K:1e3,M:1e6,B:1e9,T:1e12}[s]||1):n;}
  return parseFloat(str)||0;
}
function formatNumber(n){
  if(n>=1e9)return(n/1e9).toFixed(2)+'B';
  if(n>=1e6)return(n/1e6).toFixed(2)+'M';
  if(n>=1e3)return n.toLocaleString('en-US');
  return Math.round(n).toLocaleString('en-US');
}

// â”€â”€ Tab Switch â”€â”€
function switchTab(tabId){
  document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  const el=document.getElementById(tabId);
  if(el)el.classList.add('active');
  const map=['calculator','compare','heroes','tierlist','teambuilder','tools','saved','charts'];
  const idx=map.indexOf(tabId);
  if(idx>=0)document.querySelectorAll('.tab')[idx].classList.add('active');
  if(tabId==='saved')loadSavedList();
  if(tabId==='charts')initCharts();
  if(tabId==='heroes')renderHeroes();
  if(tabId==='tierlist')renderTierList();
  if(tabId==='teambuilder'){renderTeamBuilderList();renderTeamSlots();renderMetaTeams();}
  window.scrollTo({top:0,behavior:'smooth'});
}

// â”€â”€ Theme â”€â”€
function toggleTheme(){
  const dark=document.body.getAttribute('data-theme')==='dark';
  document.body.setAttribute('data-theme',dark?'':'dark');
  document.querySelector('.theme-toggle').textContent=dark?'ğŸŒ™':'â˜€ï¸';
  localStorage.setItem('theme',dark?'light':'dark');
}
(function(){
  if(localStorage.getItem('theme')==='dark'){
    document.body.setAttribute('data-theme','dark');
    document.querySelector('.theme-toggle').textContent='â˜€ï¸';
  }
})();

// â”€â”€ Selections â”€â”€
function selectStars(i,el){selectedStars=i;el.closest('.grid-select').querySelectorAll('.select-item').forEach(x=>x.classList.remove('selected'));el.classList.add('selected');updatePreview();}
function selectSkill(i,el){selectedSkill=i;el.closest('.grid-select').querySelectorAll('.select-item').forEach(x=>x.classList.remove('selected'));el.classList.add('selected');updatePreview();}
function selectLineup(i,el){selectedLineup=i;document.querySelectorAll('#calculator .card:nth-child(3) .select-item').forEach(x=>x.classList.remove('selected'));el.classList.add('selected');updatePreview();}

// â”€â”€ Preview Update â”€â”€
function updatePreview(){
  const atk=parseValue(document.getElementById('attack').value);
  const hp=parseValue(document.getElementById('health').value);
  const cc=parseFloat(document.getElementById('critChance').value)||0;
  const cd=parseFloat(document.getElementById('critDamage').value)||0;
  const mo=parseFloat(document.getElementById('morale').value)||100;
  document.getElementById('attackValue').textContent=formatNumber(atk);
  document.getElementById('healthValue').textContent=formatNumber(hp);
  document.getElementById('critFreq').textContent=cc>0?Math.round(100/cc):'âˆ';
  document.getElementById('critMulti').textContent='Ã—'+(cd/100).toFixed(1);
  document.getElementById('moraleMulti').textContent='Ã—'+(mo/100).toFixed(2);
  const at=document.getElementById('attackerType').value;
  const dt=document.getElementById('defenderType').value;
  const prev=document.getElementById('typeAdvantagePreview');
  if(TYPE_ADVANTAGE[at]===dt)prev.innerHTML='<div class="type-badge advantage">âœ… Ø£ÙØ¶Ù„ÙŠØ© Ù†ÙˆØ¹! +20% Ø¶Ø±Ø±</div>';
  else if(TYPE_ADVANTAGE[dt]===at)prev.innerHTML='<div class="type-badge disadvantage">âŒ Ø¹ÙŠØ¨ Ù†ÙˆØ¹! -20% Ø¶Ø±Ø±</div>';
  else prev.innerHTML='<div class="type-badge neutral">âš–ï¸ ØªØ¹Ø§Ø¯Ù„ ÙÙŠ Ø§Ù„Ù†ÙˆØ¹</div>';
}

function getTypeMultiplier(a,d){
  if(TYPE_ADVANTAGE[a]===d)return 1.20;
  if(TYPE_ADVANTAGE[d]===a)return 0.80;
  return 1.0;
}

function calculateDamage(atk,def,stars,skill,at,dt,res,cc,cd,lineup,morale){
  const defRed=DEF_CONSTANT/(def+DEF_CONSTANT);
  const base=atk*defRed;
  const sB=1+STAR_BONUS[stars];
  const sM=SKILL_MULTIPLIER[skill];
  const tM=getTypeMultiplier(at,dt);
  const rM=1-(res/100);
  const lM=1+LINEUP_BONUS[lineup||0];
  const moM=(morale||100)/100;
  const norm=base*sB*sM*tM*rM*lM*moM;
  const cM=cd/100;
  const crit=norm*cM;
  const avg=norm*(1+(cc/100)*(cM-1));
  return{normal:Math.round(norm),critical:Math.round(crit),average:Math.round(avg),baseDmg:Math.round(base),defReduction:defRed,starBonus:sB,skillMult:sM,typeMult:tM,resistMult:rM,lineupMult:lM,moraleMult:moM};
}

// â”€â”€ Simulate Battle â”€â”€
function simulateBattle(){
  const atk=parseValue(document.getElementById('attack').value);
  const hp=parseValue(document.getElementById('health').value);
  const def=parseValue(document.getElementById('defense').value);
  const res=parseFloat(document.getElementById('resistance').value)||0;
  const cc=parseFloat(document.getElementById('critChance').value)||0;
  const cd=parseFloat(document.getElementById('critDamage').value)||150;
  const mo=parseFloat(document.getElementById('morale').value)||100;
  const at=document.getElementById('attackerType').value;
  const dt=document.getElementById('defenderType').value;
  const ehp=hp*(def+DEF_CONSTANT)/DEF_CONSTANT;
  const dmg=calculateDamage(atk,def,selectedStars,selectedSkill,at,dt,res,cc,cd,selectedLineup,mo);
  const hitsAvg=Math.ceil(hp/dmg.average);

  let remHP=hp,rounds=[];
  for(let r=1;r<=100&&remHP>0;r++){
    const isCrit=Math.random()*100<cc;
    const hit=isCrit?dmg.critical:dmg.normal;
    remHP=Math.max(0,remHP-hit);
    rounds.push({round:r,damage:hit,isCrit,remainingHP:remHP});
  }

  let typeInfo='';
  if(dmg.typeMult>1)typeInfo=`<div class="type-badge advantage">âœ… Ø£ÙØ¶Ù„ÙŠØ© Ù†ÙˆØ¹! Ã—${dmg.typeMult.toFixed(2)}</div>`;
  else if(dmg.typeMult<1)typeInfo=`<div class="type-badge disadvantage">âŒ Ø¹ÙŠØ¨ Ù†ÙˆØ¹! Ã—${dmg.typeMult.toFixed(2)}</div>`;
  else typeInfo='<div class="type-badge neutral">âš–ï¸ ØªØ¹Ø§Ø¯Ù„ Ù†ÙˆØ¹ Ã—1.00</div>';

  const html=`
  <div class="card" id="resultCard">
    <h2>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©</h2>
    <div style="text-align:center;margin-bottom:12px;">
      <span style="font-size:1.1rem;">${TYPE_NAMES[at]}</span>
      <span style="margin:0 8px;font-weight:800;color:var(--primary);">âš”ï¸</span>
      <span style="font-size:1.1rem;">${TYPE_NAMES[dt]}</span>
    </div>
    <div style="text-align:center;">${typeInfo}</div>
    <div class="stats-grid" style="margin-top:16px;">
      <div class="stat-box"><div class="stat-val" style="color:var(--danger);">${formatNumber(dmg.normal)}</div><div class="stat-lbl">Ø¶Ø±Ø± Ø¹Ø§Ø¯ÙŠ</div></div>
      <div class="stat-box"><div class="stat-val" style="color:var(--warning);">${formatNumber(dmg.critical)}</div><div class="stat-lbl">Ø¶Ø±Ø± Ø­Ø±Ø¬ ğŸ’¥</div></div>
      <div class="stat-box"><div class="stat-val" style="color:var(--info);">${formatNumber(dmg.average)}</div><div class="stat-lbl">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¶Ø±Ø±</div></div>
      <div class="stat-box"><div class="stat-val" style="color:var(--success);">${hitsAvg}</div><div class="stat-lbl">Ø¶Ø±Ø¨Ø§Øª Ù„Ù„Ù‚ØªÙ„</div></div>
    </div>
    <div style="margin-top:12px;padding:13px;background:linear-gradient(135deg,rgba(72,187,120,.08),rgba(66,153,225,.08));border-radius:14px;border:1px solid var(--border);">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <span style="font-weight:700;color:var(--primary);">ğŸ›¡ï¸ Effective HP</span>
        <strong style="font-size:1.1rem;color:var(--success);">${formatNumber(ehp)}</strong>
      </div>
      <div style="font-size:.72rem;color:var(--text-sub);">HP Ø§Ù„ÙØ¹Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ø¯ÙØ§Ø¹ = HP Ã— (DEF+4000)/4000</div>
    </div>
    <div style="margin-top:16px;padding:13px;background:var(--bg-body);border-radius:14px;font-size:.82rem;">
      <div style="font-weight:700;color:var(--primary);margin-bottom:10px;">ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©</div>
      ${[['Ø§Ù„Ø¶Ø±Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ',formatNumber(dmg.baseDmg),''],['ØªØ®ÙÙŠØ¶ Ø§Ù„Ø¯ÙØ§Ø¹',(dmg.defReduction*100).toFixed(1)+'%','var(--info)'],['Ø¨ÙˆÙ†Øµ Ø§Ù„Ù†Ø¬ÙˆÙ… âš ï¸','Ã—'+dmg.starBonus.toFixed(2),''],['Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ù…Ù‡Ø§Ø±Ø© âš ï¸','Ã—'+dmg.skillMult.toFixed(2),''],['Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ù†ÙˆØ¹','Ã—'+dmg.typeMult.toFixed(2),''],['ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©','Ã—'+dmg.resistMult.toFixed(2),''],['Ø¨ÙˆÙ†Øµ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©','Ã—'+dmg.lineupMult.toFixed(2),'var(--success)'],['Ø§Ù„Ø±ÙˆØ­ Ø§Ù„Ù…Ø¹Ù†ÙˆÙŠØ©','Ã—'+dmg.moraleMult.toFixed(2),'']].map(([l,v,c])=>`<div style="display:flex;justify-content:space-between;margin-bottom:6px;"><span>${l}</span><strong style="${c?'color:'+c:''}">${v}</strong></div>`).join('')}
    </div>
    <h2 style="margin-top:18px;">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©</h2>
    <div class="battle-log">
      ${rounds.map(r=>`<div class="log-entry ${r.isCrit?'critical':''}">
        <span>Ø§Ù„Ø¬ÙˆÙ„Ø© ${r.round} ${r.isCrit?'ğŸ’¥':'âš”ï¸'}</span>
        <span style="display:flex;gap:12px;">
          <span style="color:var(--danger);">-${formatNumber(r.damage)}</span>
          <span style="color:var(--text-sub);">â¤ï¸ ${formatNumber(r.remainingHP)}</span>
        </span>
      </div>`).join('')}
    </div>
  </div>`;

  const div=document.getElementById('results');
  div.innerHTML=html;div.style.display='block';
  setTimeout(()=>div.scrollIntoView({behavior:'smooth',block:'start'}),100);
}

// â”€â”€ Compare â”€â”€
function compareUnits(){
  const t1=document.getElementById('comp1Type').value,a1=parseValue(document.getElementById('comp1Attack').value),s1=parseInt(document.getElementById('comp1Stars').value);
  const t2=document.getElementById('comp2Type').value,a2=parseValue(document.getElementById('comp2Attack').value),s2=parseInt(document.getElementById('comp2Stars').value);
  const p1=a1*(1+STAR_BONUS[s1]),p2=a2*(1+STAR_BONUS[s2]);
  const tm1=getTypeMultiplier(t1,t2),tm2=getTypeMultiplier(t2,t1);
  const e1=p1*tm1,e2=p2*tm2;
  const winner=e1>e2?1:e2>e1?2:0;
  const pct=winner===1?((e1/e2-1)*100).toFixed(1):winner===2?((e2/e1-1)*100).toFixed(1):'0';
  const winText=winner===0?'âš–ï¸ ØªØ¹Ø§Ø¯Ù„ ØªØ§Ù…!':winner===1?`ğŸ† Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø£Ù‚ÙˆÙ‰ Ø¨Ù†Ø³Ø¨Ø© ${pct}%`:`ğŸ† Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø£Ù‚ÙˆÙ‰ Ø¨Ù†Ø³Ø¨Ø© ${pct}%`;
  const wColor=winner===1?'var(--success)':winner===2?'var(--info)':'var(--warning)';
  function typeTag(m){return m>1?`<span style="color:var(--success)">+20%</span>`:m<1?`<span style="color:var(--danger)">-20%</span>`:`<span style="color:var(--warning)">0%</span>`;}
  document.getElementById('compareResults').innerHTML=`
  <div class="card" style="margin-top:16px;">
    <h2>ğŸ“Š Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</h2>
    <div style="text-align:center;padding:12px 0;font-size:1.05rem;font-weight:800;color:${wColor};">${winText}</div>
    <div class="stats-grid">
      <div class="stat-box" style="border:2px solid ${winner===1?'var(--success)':'var(--border)'};">
        <div style="margin-bottom:6px;">${TYPE_NAMES[t1]}</div>
        <div class="stat-val">${formatNumber(p1)}</div><div class="stat-lbl">Ù‚ÙˆØ© Ø£Ø³Ø§Ø³ÙŠØ©</div>
        <div style="margin-top:8px;font-size:.8rem;">Ø£ÙØ¶Ù„ÙŠØ©: ${typeTag(tm1)}</div>
        <div class="stat-val" style="font-size:1.05rem;margin-top:5px;color:var(--primary);">${formatNumber(e1)}</div>
        <div class="stat-lbl">Ù‚ÙˆØ© ÙØ¹Ù„ÙŠØ©</div>
      </div>
      <div class="stat-box" style="border:2px solid ${winner===2?'var(--success)':'var(--border)'};">
        <div style="margin-bottom:6px;">${TYPE_NAMES[t2]}</div>
        <div class="stat-val">${formatNumber(p2)}</div><div class="stat-lbl">Ù‚ÙˆØ© Ø£Ø³Ø§Ø³ÙŠØ©</div>
        <div style="margin-top:8px;font-size:.8rem;">Ø£ÙØ¶Ù„ÙŠØ©: ${typeTag(tm2)}</div>
        <div class="stat-val" style="font-size:1.05rem;margin-top:5px;color:var(--primary);">${formatNumber(e2)}</div>
        <div class="stat-lbl">Ù‚ÙˆØ© ÙØ¹Ù„ÙŠØ©</div>
      </div>
    </div>
    <div style="margin-top:12px;padding:10px;background:var(--bg-body);border-radius:10px;font-size:.82rem;text-align:center;">
      Ø§Ù„ÙØ±Ù‚: <strong style="color:var(--primary);">${formatNumber(Math.abs(e1-e2))}</strong>
    </div>
  </div>`;
}

// â”€â”€ Save/Load â”€â”€
function saveCalculation(){
  const name=document.getElementById('calcName').value||'Ø­Ø³Ø§Ø¨ '+new Date().toLocaleString('ar-SA');
  const data={name,date:new Date().toISOString(),attackerType:document.getElementById('attackerType').value,attack:document.getElementById('attack').value,stars:selectedStars,skill:selectedSkill,critChance:document.getElementById('critChance').value,critDamage:document.getElementById('critDamage').value,defenderType:document.getElementById('defenderType').value,health:document.getElementById('health').value,defense:document.getElementById('defense').value,resistance:document.getElementById('resistance').value};
  let saves=JSON.parse(localStorage.getItem('lastwar_saves')||'[]');
  saves.unshift(data);if(saves.length>50)saves=saves.slice(0,50);
  localStorage.setItem('lastwar_saves',JSON.stringify(saves));
  const btn=event.target.closest('button'),orig=btn.innerHTML;
  btn.innerHTML='âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸!';btn.style.background='linear-gradient(135deg,#48bb78,#38a169)';btn.style.color='#fff';
  setTimeout(()=>{btn.innerHTML=orig;btn.style.background='';btn.style.color='';},1500);
}
function loadSavedList(){
  const saves=JSON.parse(localStorage.getItem('lastwar_saves')||'[]');
  const c=document.getElementById('savedList');
  if(!saves.length){c.innerHTML='<p style="text-align:center;color:var(--text-sub);padding:30px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯</p>';return;}
  c.innerHTML=saves.map((s,i)=>`
  <div class="saved-item" onclick="loadSave(${i})">
    <div style="min-width:0;flex:1;">
      <div style="font-weight:700;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${s.name}</div>
      <div style="font-size:.75rem;color:var(--text-sub);">${TYPE_NAMES[s.attackerType]||'?'} vs ${TYPE_NAMES[s.defenderType]||'?'} | ATK: ${s.attack}</div>
    </div>
    <button class="delete-btn" onclick="event.stopPropagation();deleteSave(${i})">ğŸ—‘ï¸</button>
  </div>`).join('');
}
function loadSave(i){
  const saves=JSON.parse(localStorage.getItem('lastwar_saves')||'[]'),s=saves[i];
  if(!s)return;
  ['attackerType','attack','critChance','critDamage','defenderType','health','defense','resistance','calcName'].forEach(id=>{if(s[id]!==undefined)document.getElementById(id).value=s[id];});
  selectedStars=s.stars||0;selectedSkill=s.skill||0;
  updatePreview();switchTab('calculator');
}
function deleteSave(i){
  const saves=JSON.parse(localStorage.getItem('lastwar_saves')||'[]');
  saves.splice(i,1);localStorage.setItem('lastwar_saves',JSON.stringify(saves));loadSavedList();
}

// â”€â”€ Screenshot â”€â”€
function shareAsImage(){
  const rc=document.getElementById('resultCard');
  if(!rc){simulateBattle();setTimeout(shareAsImage,600);return;}
  html2canvas(rc,{backgroundColor:document.body.getAttribute('data-theme')==='dark'?'#1e293b':'#ffffff',scale:2,useCORS:true,logging:false}).then(canvas=>{
    const a=document.createElement('a');a.download='lastwar-'+Date.now()+'.png';a.href=canvas.toDataURL('image/png');a.click();
  }).catch(()=>alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµÙˆÙŠØ±'));
}

// â”€â”€ Charts â”€â”€
function initCharts(){initSkillChart();initUpgradeChart();}
function initSkillChart(){
  const ctx=document.getElementById('skillChart').getContext('2d');
  const atk=parseValue(document.getElementById('attack').value);
  const def=parseValue(document.getElementById('defense').value);
  const base=atk*DEF_CONSTANT/(def+DEF_CONSTANT);
  const sb=1+STAR_BONUS[selectedStars];
  const dmgs=SKILL_MULTIPLIER.map(m=>Math.round(base*sb*m));
  if(skillChartInstance)skillChartInstance.destroy();
  skillChartInstance=new Chart(ctx,{type:'bar',data:{labels:SKILL_NAMES,datasets:[{label:'Ø§Ù„Ø¶Ø±Ø±',data:dmgs,backgroundColor:['rgba(102,126,234,.7)','rgba(237,137,54,.7)','rgba(245,101,101,.7)'],borderColor:['rgba(102,126,234,1)','rgba(237,137,54,1)','rgba(245,101,101,1)'],borderWidth:2,borderRadius:10}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>'Ø§Ù„Ø¶Ø±Ø±: '+formatNumber(ctx.parsed.y)}}},scales:{y:{beginAtZero:true,ticks:{callback:v=>formatNumber(v),color:'var(--text-sub)',font:{family:'Tajawal'}},grid:{color:'rgba(128,128,128,.1)'}},x:{ticks:{color:'var(--text-sub)',font:{family:'Tajawal',weight:'bold'}},grid:{display:false}}}}});
}
function initUpgradeChart(){
  const ctx=document.getElementById('upgradeChart').getContext('2d');
  const atk=parseValue(document.getElementById('attack').value);
  const powers=STAR_BONUS.map(b=>Math.round(atk*(1+b)));
  if(upgradeChartInstance)upgradeChartInstance.destroy();
  upgradeChartInstance=new Chart(ctx,{type:'line',data:{labels:['â­','â­â­','â­â­â­','â­â­â­â­','â­â­â­â­â­'],datasets:[{label:'Ø§Ù„Ù‚ÙˆØ© Ø§Ù„ÙØ¹Ù„ÙŠØ©',data:powers,borderColor:'rgba(118,75,162,1)',backgroundColor:'rgba(118,75,162,.15)',borderWidth:3,fill:true,tension:.4,pointRadius:6,pointBackgroundColor:'#fff',pointBorderColor:'rgba(118,75,162,1)',pointBorderWidth:3,pointHoverRadius:9}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>'Ø§Ù„Ù‚ÙˆØ©: '+formatNumber(ctx.parsed.y)}}},scales:{y:{beginAtZero:false,ticks:{callback:v=>formatNumber(v),color:'var(--text-sub)',font:{family:'Tajawal'}},grid:{color:'rgba(128,128,128,.1)'}},x:{ticks:{color:'var(--text-sub)',font:{family:'Tajawal',weight:'bold'}},grid:{display:false}}}}});
}

// â”€â”€ Hero Avatar â”€â”€
function heroAvatar(h,size=48){
  const rc={tank:{SSR:'linear-gradient(135deg,#9b59b6,#6c3483)',SR:'linear-gradient(135deg,#5dade2,#1a5276)'},plane:{SSR:'linear-gradient(135deg,#a569bd,#5b2c6f)',SR:'linear-gradient(135deg,#48c9b0,#148f77)'},missile:{SSR:'linear-gradient(135deg,#bb8fce,#6c3483)',SR:'linear-gradient(135deg,#85c1e9,#2471a3)'}};
  const ti={tank:'ğŸŸ«',plane:'âœˆï¸',missile:'ğŸš€'};
  if(h.img)return `<img src="${h.img}" alt="${h.name}" style="width:${size}px;height:${size}px;border-radius:10px;object-fit:cover;border:2px solid ${RARITY_COLORS[h.rarity]};box-shadow:0 2px 8px rgba(0,0,0,.3);flex-shrink:0;" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';">
  <div style="display:none;width:${size}px;height:${size}px;border-radius:10px;border:2px solid ${RARITY_COLORS[h.rarity]};background:${rc[h.type]?.[h.rarity]||'#444'};align-items:center;justify-content:center;font-weight:900;font-size:${Math.round(size*.42)}px;color:${RARITY_COLORS[h.rarity]};flex-shrink:0;">${h.name[0]}</div>`;
  const bg=h.rarity==='UR'?`linear-gradient(135deg,${RARITY_COLORS[h.rarity]},${RARITY_COLORS[h.rarity]}88)`:rc[h.type]?.[h.rarity]||'#444';
  return `<div style="width:${size}px;height:${size}px;border-radius:10px;border:2px solid ${RARITY_COLORS[h.rarity]};background:${bg};display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;box-shadow:0 2px 8px rgba(0,0,0,.25);">
    <div style="font-size:${Math.round(size*.28)}px;line-height:1;">${ti[h.type]||''}</div>
    <div style="font-weight:900;font-size:${Math.round(size*.3)}px;color:#fff;text-shadow:0 1px 3px rgba(0,0,0,.5);line-height:1.1;">${h.name[0]}</div>
  </div>`;
}

function toggleHeroSkills(name){
  const el=document.getElementById('skills-'+name);if(!el)return;
  const open=el.style.maxHeight&&el.style.maxHeight!=='0px';
  el.style.maxHeight=open?'0px':'400px';el.style.opacity=open?'0':'1';el.style.marginTop=open?'0':'10px';
}
function renderSkillsPanel(name){
  const sk=HERO_SKILLS[name];if(!sk)return'';
  return `<div id="skills-${name}" style="max-height:0;opacity:0;overflow:hidden;transition:all .3s ease;margin-top:0;">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:2px;">
      ${['auto','tactics','passive','expertise'].map(type=>{const s=sk[type],st=SKILL_TYPES[type];return`<div style="padding:8px;background:${st.color}11;border-radius:10px;border-right:3px solid ${st.color};">
        <div style="font-size:.7rem;font-weight:700;color:${st.color};margin-bottom:3px;">${st.icon} ${st.name}</div>
        <div style="font-size:.7rem;font-weight:700;">${s.nameAr}</div>
        <div style="font-size:.62rem;color:var(--text-sub);">${s.name}</div>
        <div style="font-size:.66rem;color:var(--text-sub);margin-top:3px;line-height:1.3;">${s.desc}</div>
      </div>`;}).join('')}
    </div>
  </div>`;
}

function filterHeroes(){
  const q=(document.getElementById('heroSearch')?.value||'').toLowerCase();
  const tf=document.getElementById('heroFilterType')?.value||'all';
  const rf=document.getElementById('heroFilterRarity')?.value||'all';
  const list=HEROES.filter(h=>(tf==='all'||h.type===tf)&&(rf==='all'||h.rarity===rf)&&(!q||h.name.toLowerCase().includes(q)||h.nameAr.includes(q)));
  const c=document.getElementById('heroList');if(!c)return;
  if(!list.length){c.innerHTML='<p style="text-align:center;color:var(--text-sub);padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>';return;}
  c.innerHTML=list.map(h=>{
    const hs=!!HERO_SKILLS[h.name];
    return `<div style="padding:11px;margin-bottom:8px;background:var(--bg-body);border-radius:14px;border-right:4px solid ${RARITY_COLORS[h.rarity]};${hs?'cursor:pointer;':''}" ${hs?`onclick="toggleHeroSkills('${h.name}')"`:''}>
      <div style="display:flex;align-items:center;gap:10px;">
        <div style="flex-shrink:0;">${heroAvatar(h,52)}</div>
        <div style="flex:1;min-width:0;">
          <div style="font-weight:800;font-size:.95rem;margin-bottom:2px;display:flex;align-items:center;gap:5px;flex-wrap:wrap;">
            ${TYPE_NAMES[h.type]} ${h.nameAr}
            <span style="font-size:.7rem;color:${RARITY_COLORS[h.rarity]};background:${RARITY_COLORS[h.rarity]}22;padding:1px 7px;border-radius:6px;">${h.rarity}</span>
            ${h.dmg?`<span style="font-size:.66rem;opacity:.7;">${DMG_ICONS[h.dmg]}</span>`:''}
          </div>
          ${h.title?`<div style="font-size:.7rem;color:${RARITY_COLORS[h.rarity]};opacity:.8;margin-bottom:2px;">Â«${h.title}Â»</div>`:''}
          <div style="font-size:.76rem;color:var(--text-sub);">${ROLE_NAMES[h.role]} Â· ${h.desc}</div>
          <div style="font-size:.66rem;color:var(--text-sub);margin-top:2px;opacity:.6;display:flex;align-items:center;gap:6px;">${h.name}${hs?'<span style="font-size:.6rem;background:var(--primary);color:#fff;padding:1px 5px;border-radius:4px;">â¬‡ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</span>':''}</div>
        </div>
      </div>
      ${hs?renderSkillsPanel(h.name):''}
    </div>`;
  }).join('');
}
function renderHeroes(){filterHeroes();}

// â”€â”€ EXP Calc â”€â”€
function calculateEXP(){
  const from=parseInt(document.getElementById('expFrom').value)||1;
  const to=parseInt(document.getElementById('expTo').value)||60;
  if(from>=to||from<1||to>175){document.getElementById('expResults').innerHTML='<p style="color:var(--danger);text-align:center;padding:12px;">âŒ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ… ØµØ­ÙŠØ­Ø© (1-175)</p>';return;}
  let total=0;for(let i=from;i<to;i++)total+=HERO_EXP[i]||0;
  let reqHQ=1;for(const[l,h]of Object.entries(HQ_CAPS)){if(to<=parseInt(l)){reqHQ=h;break;}}
  document.getElementById('expResults').innerHTML=`<div style="margin-top:12px;padding:14px;background:var(--bg-body);border-radius:14px;"><div class="stats-grid"><div class="stat-box"><div class="stat-val" style="color:var(--primary);">${formatNumber(total)}</div><div class="stat-lbl">EXP Ù…Ø·Ù„ÙˆØ¨</div></div><div class="stat-box"><div class="stat-val" style="color:var(--warning);">HQ ${reqHQ}</div><div class="stat-lbl">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø±</div></div></div><div style="margin-top:10px;font-size:.78rem;color:var(--text-sub);text-align:center;">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${from} â†’ ${to} | Ø§Ù„ÙØ±Ù‚: ${to-from} Ù…Ø³ØªÙˆÙ‰</div></div>`;
}

// â”€â”€ Shard Calc â”€â”€
function calculateShards(){
  const from=parseInt(document.getElementById('shardFrom').value);
  const to=parseInt(document.getElementById('shardTo').value);
  if(from>=to){document.getElementById('shardResults').innerHTML='<p style="color:var(--danger);text-align:center;padding:12px;">âŒ Ù†Ø¬Ù…Ø© Ø§Ù„Ù‡Ø¯Ù ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£Ø¹Ù„Ù‰</p>';return;}
  let total=0,breakdown=[];
  for(let i=from;i<to;i++){total+=SHARD_COSTS[i];breakdown.push({star:i+1,cost:SHARD_COSTS[i]});}
  document.getElementById('shardResults').innerHTML=`<div style="margin-top:12px;padding:14px;background:var(--bg-body);border-radius:14px;"><div class="stat-box" style="margin-bottom:12px;"><div class="stat-val" style="color:var(--primary);font-size:1.7rem;">${total}</div><div class="stat-lbl">Ø´Ø¸ÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø©</div></div><div style="font-size:.82rem;">${breakdown.map(b=>`<div style="display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);"><span>${'â­'.repeat(b.star)} Ù†Ø¬Ù…Ø© ${b.star}</span><strong>${b.cost}</strong></div>`).join('')}</div><div style="margin-top:10px;padding:9px;background:rgba(102,126,234,.08);border-radius:10px;font-size:.76rem;text-align:center;">ğŸ’¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ 0â†’5â­ = <strong>975 Ø´Ø¸ÙŠØ©</strong></div></div>`;
}

// â”€â”€ Medal Calc â”€â”€
function selectMedalRarity(r,el){
  selectedMedalRarity=r;
  el.parentElement.querySelectorAll('.select-item').forEach(i=>i.classList.remove('selected'));
  el.classList.add('selected');
  const mx=r==='UR'?40:30;
  document.getElementById('medalTo').max=mx;
  if(parseInt(document.getElementById('medalTo').value)>mx)document.getElementById('medalTo').value=mx;
}
function calculateMedals(){
  const from=parseInt(document.getElementById('medalFrom').value)||1;
  const to=parseInt(document.getElementById('medalTo').value)||30;
  const cnt=parseInt(document.getElementById('medalSkillCount').value)||1;
  const ratio=MEDAL_RATIO[selectedMedalRarity];
  const mx=selectedMedalRarity==='UR'?40:30;
  if(from>=to||from<1||to>mx){document.getElementById('medalResults').innerHTML='<p style="color:var(--danger);text-align:center;padding:12px;">âŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø¯Ø®Ù„Ø©</p>';return;}
  let totalPer=0;
  for(let i=from-1;i<to-1&&i<MEDAL_COSTS_UR.length;i++)totalPer+=Math.round(MEDAL_COSTS_UR[i]*ratio);
  const totalAll=totalPer*cnt;
  const re={UR:'ğŸŸ ',SSR:'ğŸŸ£',SR:'ğŸ”µ'};
  const noteUR=selectedMedalRarity==='UR'&&to>30?'<div style="margin-top:8px;padding:8px;background:rgba(246,173,85,.1);border-radius:8px;font-size:.74rem;text-align:center;">âš ï¸ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª 31-40 ØªØ­ØªØ§Ø¬ Exclusive Weapon</div>':'';
  document.getElementById('medalResults').innerHTML=`<div style="margin-top:12px;padding:14px;background:var(--bg-body);border-radius:14px;"><div class="stats-grid"><div class="stat-box"><div class="stat-val" style="color:var(--primary);">${formatNumber(totalPer)}</div><div class="stat-lbl">Ù…ÙŠØ¯Ø§Ù„ÙŠØ© / Ù…Ù‡Ø§Ø±Ø©</div></div><div class="stat-box"><div class="stat-val" style="color:var(--warning);">${formatNumber(totalAll)}</div><div class="stat-lbl">${cnt>1?`Ø¥Ø¬Ù…Ø§Ù„ÙŠ (${cnt} Ù…Ù‡Ø§Ø±Ø§Øª)`:'Ø¥Ø¬Ù…Ø§Ù„ÙŠ'}</div></div></div><div style="margin-top:10px;font-size:.78rem;text-align:center;color:var(--text-sub);">${re[selectedMedalRarity]} ${selectedMedalRarity} | Ù…Ù‡Ø§Ø±Ø© ${from}â†’${to} | ${cnt} Ù…Ù‡Ø§Ø±Ø©</div>${noteUR}</div>`;
}

// â”€â”€ Healing Calc â”€â”€
function calculateHealing(){
  const w=parseValue(document.getElementById('healWounded').value);
  const cap=parseValue(document.getElementById('healCapacity').value);
  const t=parseFloat(document.getElementById('healTime').value)||5;
  const ah=parseFloat(document.getElementById('healAllianceHelp').value)||0;
  if(w<=0||cap<=0){document.getElementById('healResults').innerHTML='<p style="color:var(--danger);text-align:center;padding:12px;">âŒ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ… ØµØ­ÙŠØ­Ø©</p>';return;}
  const batches=Math.ceil(w/cap);
  const adjT=t*(1-ah/100);
  const totalMin=Math.round((w*adjT)/60);
  const hrs=Math.floor(totalMin/60),mins=totalMin%60;
  const tStr=hrs>0?`${hrs}Ø³Ø§Ø¹Ø© Ùˆ ${mins}Ø¯Ù‚ÙŠÙ‚Ø©`:`${mins} Ø¯Ù‚ÙŠÙ‚Ø©`;
  const ov=w>cap?w-cap:0;
  document.getElementById('healResults').innerHTML=`<div style="margin-top:12px;padding:14px;background:var(--bg-body);border-radius:14px;"><div class="stats-grid"><div class="stat-box"><div class="stat-val" style="color:var(--primary);">${batches}</div><div class="stat-lbl">Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙØ¹Ø§Øª</div></div><div class="stat-box"><div class="stat-val" style="color:var(--warning);font-size:1rem;">${tStr}</div><div class="stat-lbl">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div></div></div>${ov>0?`<div style="margin-top:10px;padding:9px;background:rgba(255,68,68,.1);border-radius:10px;font-size:.78rem;text-align:center;color:var(--danger);">âš ï¸ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø³Ø¹Ø© Ø¨Ù€ ${formatNumber(ov)} Ø¬Ù†Ø¯ÙŠ</div>`:''}<div style="margin-top:9px;font-size:.76rem;color:var(--text-sub);text-align:center;">${formatNumber(w)} Ù…ØµØ§Ø¨ | Ø³Ø¹Ø© ${formatNumber(cap)} | ${ah}% Ù…Ø³Ø§Ø¹Ø¯Ø© Ø­Ù„Ù</div></div>`;
}

// â”€â”€ Tier List â”€â”€
function renderTierList(){
  const c=document.getElementById('tierListContent');let html='';
  for(const[tier,heroes]of Object.entries(TIER_LIST)){
    if(!heroes.length&&tier==='D')continue;
    const color=TIER_COLORS[tier];
    html+=`<div style="display:flex;align-items:stretch;margin-bottom:8px;border-radius:14px;overflow:hidden;border:1px solid var(--border);">
      <div style="width:50px;min-height:50px;background:${color};display:flex;align-items:center;justify-content:center;font-weight:900;font-size:1.25rem;color:#fff;">${tier}</div>
      <div style="flex:1;padding:8px;display:flex;flex-wrap:wrap;gap:7px;align-items:center;background:var(--bg-card);">
        ${!heroes.length?'<span style="color:var(--text-sub);font-size:.8rem;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¨Ø·Ø§Ù„</span>':heroes.map(name=>{
          const h=HEROES.find(x=>x.name===name);
          if(!h)return `<span style="padding:5px 10px;background:var(--bg-body);border-radius:8px;font-size:.8rem;">${name}</span>`;
          return`<div style="padding:5px 9px;background:var(--bg-body);border-radius:10px;font-size:.78rem;display:flex;align-items:center;gap:6px;border-bottom:2px solid ${color};">
            ${heroAvatar(h,30)}
            <div><div style="font-weight:700;font-size:.78rem;">${h.nameAr}</div><div style="font-size:.62rem;color:var(--text-sub);">${h.name}</div></div>
          </div>`;
        }).join('')}
      </div>
    </div>`;
  }
  c.innerHTML=html;
}

// â”€â”€ Team Builder â”€â”€
function renderTeamSlots(){
  const c=document.getElementById('teamSlots');let html='';
  for(let i=0;i<5;i++){
    if(teamSlots[i]){
      const h=teamSlots[i];
      html+=`<div style="padding:6px;background:var(--bg-body);border-radius:12px;text-align:center;border:2px solid ${RARITY_COLORS[h.rarity]};cursor:pointer;position:relative;display:flex;flex-direction:column;align-items:center;gap:3px;" onclick="removeFromTeam(${i})">
        ${heroAvatar(h,38)}
        <div style="font-size:.62rem;font-weight:700;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:100%;">${h.nameAr}</div>
        <div style="position:absolute;top:-4px;right:-4px;width:16px;height:16px;background:var(--danger);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.55rem;color:#fff;">âœ•</div>
      </div>`;
    }else{
      html+=`<div style="padding:8px;background:var(--bg-body);border-radius:12px;text-align:center;border:2px dashed var(--border);opacity:.45;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:72px;">
        <div style="font-size:1rem;">â•</div><div style="font-size:.6rem;margin-top:2px;">ÙØ§Ø±Øº</div>
      </div>`;
    }
  }
  c.innerHTML=html;
  document.getElementById('teamCount').textContent=teamSlots.filter(Boolean).length;
  analyzeTeam();
}
function renderTeamBuilderList(){
  const f=document.getElementById('tbFilter').value;
  const fl=HEROES.filter(h=>f==='all'||h.type===f);
  const c=document.getElementById('tbHeroList');
  const inTeam=teamSlots.filter(Boolean).map(h=>h.name);
  c.innerHTML=fl.map(h=>{
    const it=inTeam.includes(h.name);
    return`<div style="display:flex;align-items:center;gap:8px;padding:7px 10px;margin-bottom:5px;background:${it?'rgba(102,126,234,.15)':'var(--bg-body)'};border-radius:10px;border-left:3px solid ${RARITY_COLORS[h.rarity]};${it?'opacity:.5;':'cursor:pointer;'}" ${it?'':` onclick="addToTeam('${h.name}')"`}>
      <div style="flex-shrink:0;">${heroAvatar(h,34)}</div>
      <div style="flex:1;min-width:0;">
        <div style="display:flex;align-items:center;gap:4px;"><strong style="font-size:.8rem;">${h.nameAr}</strong><span style="font-size:.63rem;color:${RARITY_COLORS[h.rarity]};">${h.rarity}</span></div>
        <div style="font-size:.66rem;color:var(--text-sub);">${h.name}</div>
      </div>
      <div style="font-size:.7rem;color:var(--text-sub);flex-shrink:0;">${it?'âœ…':ROLE_NAMES[h.role]}</div>
    </div>`;
  }).join('');
}
function addToTeam(name){
  if(teamSlots.filter(Boolean).length>=5)return;
  const h=HEROES.find(x=>x.name===name);
  if(!h||teamSlots.some(s=>s&&s.name===name))return;
  const idx=teamSlots.findIndex(s=>!s);
  if(idx===-1&&teamSlots.length<5)teamSlots.push(h);
  else if(idx!==-1)teamSlots[idx]=h;
  while(teamSlots.length<5)teamSlots.push(undefined);
  renderTeamSlots();renderTeamBuilderList();
}
function removeFromTeam(i){
  teamSlots[i]=undefined;
  teamSlots=teamSlots.filter(Boolean);
  while(teamSlots.length<5)teamSlots.push(undefined);
  renderTeamSlots();renderTeamBuilderList();
}
function clearTeam(){teamSlots=[undefined,undefined,undefined,undefined,undefined];renderTeamSlots();renderTeamBuilderList();}
function analyzeTeam(){
  const team=teamSlots.filter(Boolean);
  const c=document.getElementById('teamAnalysis');
  if(!team.length){c.innerHTML='';return;}
  const tc={tank:0,plane:0,missile:0};team.forEach(h=>tc[h.type]++);
  const mx=Object.entries(tc).sort((a,b)=>b[1]-a[1])[0];
  let bonus=mx[1]>=5?20:mx[1]>=4?15:mx[1]>=3?10:0;
  const rc={attack:0,defense:0,support:0};team.forEach(h=>rc[h.role]++);
  const rr={UR:0,SSR:0,SR:0};team.forEach(h=>rr[h.rarity]++);
  c.innerHTML=`<div style="padding:13px;background:var(--bg-body);border-radius:12px;">
    <div style="font-weight:700;margin-bottom:10px;">ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ±ÙŠÙ‚</div>
    <div class="stats-grid" style="margin-bottom:10px;">
      <div class="stat-box"><div class="stat-val" style="color:${bonus>0?'var(--success)':'var(--text-sub)'};">+${bonus}%</div><div class="stat-lbl">Ø¨ÙˆÙ†Øµ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©</div></div>
      <div class="stat-box"><div class="stat-val">${team.length}/5</div><div class="stat-lbl">Ø£Ø¨Ø·Ø§Ù„</div></div>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;font-size:.78rem;"><span>ğŸŸ« ${tc.tank}</span><span>âœˆï¸ ${tc.plane}</span><span>ğŸš€ ${tc.missile}</span></div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;font-size:.78rem;margin-top:5px;"><span>âš”ï¸ ${rc.attack}</span><span>ğŸ›¡ï¸ ${rc.defense}</span><span>ğŸ’Š ${rc.support}</span></div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;font-size:.78rem;margin-top:5px;"><span style="color:${RARITY_COLORS.UR};">UR:${rr.UR}</span><span style="color:${RARITY_COLORS.SSR};">SSR:${rr.SSR}</span><span style="color:${RARITY_COLORS.SR};">SR:${rr.SR}</span></div>
    ${bonus===0&&team.length>=3?'<div style="margin-top:8px;padding:6px;background:rgba(255,136,0,.1);border-radius:8px;font-size:.71rem;color:var(--warning);text-align:center;">ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ù… 3+ Ø£Ø¨Ø·Ø§Ù„ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù†ÙˆØ¹ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙˆÙ†Øµ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©</div>':''}
  </div>`;
}
function renderMetaTeams(){
  document.getElementById('metaTeams').innerHTML=META_TEAMS.map((team,i)=>`
  <div style="padding:13px;background:var(--bg-body);border-radius:12px;margin-bottom:10px;">
    <div style="font-weight:700;margin-bottom:6px;">${team.name}</div>
    <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px;">
      ${team.heroes.map(n=>{const h=HEROES.find(x=>x.name===n);return`<span style="padding:4px 9px;background:var(--bg-card);border-radius:6px;font-size:.77rem;border-left:2px solid ${h?RARITY_COLORS[h.rarity]:'#888'};">${h?h.nameAr:n}</span>`;}).join('')}
    </div>
    <div style="font-size:.74rem;color:var(--text-sub);">${team.desc}</div>
    <button onclick="loadMetaTeam(${i})" style="margin-top:8px;padding:7px 14px;font-size:.77rem;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;border:none;border-radius:9px;cursor:pointer;font-family:Tajawal;font-weight:700;">ğŸ“‹ Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„ÙØ±ÙŠÙ‚</button>
  </div>`).join('');
}
function loadMetaTeam(i){
  const team=META_TEAMS[i];teamSlots=[];
  team.heroes.forEach(n=>{const h=HEROES.find(x=>x.name===n);if(h)teamSlots.push(h);});
  while(teamSlots.length<5)teamSlots.push(undefined);
  renderTeamSlots();renderTeamBuilderList();
}

updatePreview();
</script>

</body>
</html>