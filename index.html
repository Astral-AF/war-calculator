import { useState, useEffect } from â€œreactâ€;

// ========== MOCK DATA ==========
const MOCK_FEEDERS = [
{ id: â€œf1â€, name: â€œB313â€, substation: â€œØ¹Ø±Ø¹Ø± Ø¨â€, base_subscribers: 710, requires_escalation: false, has_sensitive: false },
{ id: â€œf2â€, name: â€œB314â€, substation: â€œØ¹Ø±Ø¹Ø± Ø¨â€, base_subscribers: 813, requires_escalation: true, has_sensitive: false },
{ id: â€œf3â€, name: â€œB315â€, substation: â€œØ¹Ø±Ø¹Ø± Ø¨â€, base_subscribers: 726, requires_escalation: true, has_sensitive: true },
{ id: â€œf4â€, name: â€œB316â€, substation: â€œØ¹Ø±Ø¹Ø± Ø¨â€, base_subscribers: 993, requires_escalation: true, has_sensitive: false },
{ id: â€œf5â€, name: â€œB317â€, substation: â€œØ¹Ø±Ø¹Ø± Ø£â€, base_subscribers: 416, requires_escalation: false, has_sensitive: false },
{ id: â€œf6â€, name: â€œB318â€, substation: â€œØ¹Ø±Ø¹Ø± Ø£â€, base_subscribers: 873, requires_escalation: true, has_sensitive: true },
{ id: â€œf7â€, name: â€œB360â€, substation: â€œØ±ÙØ­Ø§ Ø¨â€, base_subscribers: 837, requires_escalation: true, has_sensitive: false },
{ id: â€œf8â€, name: â€œB361â€, substation: â€œØ±ÙØ­Ø§ Ø¨â€, base_subscribers: 445, requires_escalation: false, has_sensitive: false },
];

const MOCK_SENSITIVE = {
f3: [â€œØ¥Ù…Ø§Ø±Ø© Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©â€, â€œØ¨Ø±Ø¬ Ø§ØªØµØ§Ù„Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø·Ø¹â€],
f6: [â€œØ´Ø±ÙƒØ© Ø§ØªØ­Ø§Ø¯ Ø§ØªØµØ§Ù„Ø§Øª Ù…ÙˆØ¨Ø§ÙŠÙ„ÙŠâ€, â€œÙ…Ø±ÙƒØ² ØªÙˆØ²ÙŠØ¹â€],
f7: [],
};

const USERS = {
dispatchers: [â€œØ£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù†Ø²ÙŠâ€, â€œÙ…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù…Ø±ÙŠâ€, â€œØ®Ø§Ù„Ø¯ Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠâ€, â€œØ³Ø¹Ø¯ Ø§Ù„Ø¨Ù„ÙˆÙŠâ€],
draftsmen: [â€œØ¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø±Ø¨ÙŠâ€, â€œÙÙŠØµÙ„ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠâ€],
};

const TASK_TYPES = {
install: â€œØªØ±ÙƒÙŠØ¨ Ù…Ø¹Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©â€,
replace: â€œØ§Ø³ØªØ¨Ø¯Ø§Ù„ Ù…Ø¹Ø¯Ø©â€,
remove: â€œØ¥Ø²Ø§Ù„Ø© Ù…Ø¹Ø¯Ø©â€,
fix_terminals: â€œØªØµØ­ÙŠØ­ Ø£Ø·Ø±Ø§Ùâ€,
change_route: â€œØªØºÙŠÙŠØ± Ù…Ø³Ø§Ø± ØªØºØ°ÙŠØ©â€,
};

const STATUS_LABELS = {
open: â€œÙ…ÙØªÙˆØ­Ø©â€,
received: â€œØ§Ø³ØªÙÙ„Ù…Øªâ€,
zenon_done: â€œØ²ÙŠÙ†ÙˆÙ† âœ“â€,
microstation_done: â€œÙ…Ø§ÙŠÙƒØ±ÙˆØ³ØªÙŠØ´Ù† âœ“â€,
reviewed: â€œÙ…Ø±Ø§Ø¬Ø¹Ø©â€,
closed: â€œÙ…ØºÙ„Ù‚Ø©â€,
};

const STATUS_COLORS = {
open: â€œ#EF4444â€,
received: â€œ#F59E0Bâ€,
zenon_done: â€œ#3B82F6â€,
microstation_done: â€œ#8B5CF6â€,
reviewed: â€œ#10B981â€,
closed: â€œ#64748Bâ€,
};

// ========== HELPERS ==========
function fmtDuration(ms) {
const s = Math.floor(ms / 1000);
const h = Math.floor(s / 3600);
const m = Math.floor((s % 3600) / 60);
const sec = s % 60;
if (h > 0) return `${h}:${String(m).padStart(2,"0")}:${String(sec).padStart(2,"0")}`;
return `${m}:${String(sec).padStart(2,"0")}`;
}

function fmtTime(d) {
return new Date(d).toLocaleTimeString(â€œar-SAâ€, { hour: â€œ2-digitâ€, minute: â€œ2-digitâ€ });
}

function timerColor(ms, warnMs = 4*3600*1000, dangerMs = 24*3600*1000) {
if (ms > dangerMs) return â€œ#EF4444â€;
if (ms > warnMs) return â€œ#F59E0Bâ€;
return â€œ#10B981â€;
}

function taskTimerColor(createdAt) {
const days = (Date.now() - createdAt) / 86400000;
if (days > 3) return â€œ#EF4444â€;
if (days > 1) return â€œ#F59E0Bâ€;
return â€œ#10B981â€;
}

// ========== LIVE TIMER ==========
function LiveTimer({ startTime, warnMs, dangerMs, style = {} }) {
const [now, setNow] = useState(Date.now());
useEffect(() => {
const t = setInterval(() => setNow(Date.now()), 1000);
return () => clearInterval(t);
}, []);
const ms = now - startTime;
const col = timerColor(ms, warnMs, dangerMs);
return <span style={{ color: col, fontFamily: â€œmonospaceâ€, fontWeight: 700, â€¦style }}>{fmtDuration(ms)}</span>;
}

// ========== MAIN APP ==========
export default function App() {
const [page, setPage] = useState(â€œdashboardâ€);
const [tasks, setTasks] = useState([
{ id: â€œt1â€, type: â€œfix_terminalsâ€, device_no: â€œ403061â€, feeder_id: â€œf1â€, substation: â€œØ¹Ø±Ø¹Ø± Ø¨â€, status: â€œzenon_doneâ€, created_by: â€œØ£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù†Ø²ÙŠâ€, assigned_to: â€œØ¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø±Ø¨ÙŠâ€, device_type: â€œ3wayâ€, ring1: â€œB313â€, ring2: â€œB314â€, created_at: Date.now() - 2*86400000, notes: â€œØ§Ù„Ø·Ø±Ù Ø§Ù„Ø£ÙŠÙ…Ù† Ù…Ø¹ÙƒÙˆØ³â€ },
{ id: â€œt2â€, type: â€œinstallâ€, device_no: â€œ403100â€, feeder_id: â€œf3â€, substation: â€œØ¹Ø±Ø¹Ø± Ø¨â€, status: â€œopenâ€, created_by: â€œÙ…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù…Ø±ÙŠâ€, assigned_to: â€œÙÙŠØµÙ„ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠâ€, created_at: Date.now() - 4*86400000, notes: â€œâ€ },
{ id: â€œt3â€, type: â€œreplaceâ€, device_no: â€œ403077â€, feeder_id: â€œf5â€, substation: â€œØ¹Ø±Ø¹Ø± Ø£â€, status: â€œclosedâ€, created_by: â€œØ®Ø§Ù„Ø¯ Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠâ€, assigned_to: â€œØ¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø±Ø¨ÙŠâ€, created_at: Date.now() - 7*86400000, notes: â€œâ€ },
{ id: â€œt4â€, type: â€œfix_terminalsâ€, device_no: â€œ403088â€, feeder_id: â€œf6â€, substation: â€œØ¹Ø±Ø¹Ø± Ø£â€, status: â€œreceivedâ€, created_by: â€œØ³Ø¹Ø¯ Ø§Ù„Ø¨Ù„ÙˆÙŠâ€, assigned_to: â€œÙÙŠØµÙ„ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠâ€, device_type: â€œ4wayâ€, ring1: â€œB318â€, ring2: â€œB360â€, ring3: â€œB361â€, ring4: â€œâ€, created_at: Date.now() - 86400000, notes: â€œâ€ },
]);
const [transfers, setTransfers] = useState([
{ id: â€œtr1â€, type: â€œemergencyâ€, from_feeder_id: â€œf1â€, to_feeder_id: â€œf2â€, from_device: â€œ403050â€, to_device: â€œ403065â€, count: 300, reason: â€œØ¹Ø·Ù„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§Ø¨Ù„â€, started_at: Date.now() - 2.5*3600*1000 },
]);
const [outages, setOutages] = useState([
{ id: â€œo1â€, feeder_id: â€œf7â€, started_at: Date.now() - 1.4*3600*1000, ended_at: null, affected_areas: â€œØ§Ù„Ù‚Ø¯Ø³ØŒ Ø§Ù„ÙÙŠØµÙ„ÙŠØ©â€, notes: â€œN.O 315028 RTU faultyâ€, phases: [{ id:â€œp1â€, phase_number:1, restored_at: Date.now()-1.2*3600*1000, restored_count:231, method:â€œautoâ€ }], notifications: [â€œØ§Ù„Ø£Ø²Ù…Ø§Øª ÙˆØ§Ù„ÙƒÙˆØ§Ø±Ø«â€,â€œØ§Ù„ØªØ´ØºÙŠÙ„â€] },
]);
const [showNewTask, setShowNewTask] = useState(false);
const [showNewTransfer, setShowNewTransfer] = useState(false);
const [showNewOutage, setShowNewOutage] = useState(false);
const [selectedTask, setSelectedTask] = useState(null);
const [selectedOutage, setSelectedOutage] = useState(null);
const [now, setNow] = useState(Date.now());

useEffect(() => {
const t = setInterval(() => setNow(Date.now()), 1000);
return () => clearInterval(t);
}, []);

// Live subscriber calc
function liveCount(feederId) {
const f = MOCK_FEEDERS.find(x => x.id === feederId);
if (!f) return 0;
let count = f.base_subscribers;
transfers.filter(t => !t.ended_at).forEach(t => {
if (t.to_feeder_id === feederId) count += t.count;
if (t.from_feeder_id === feederId) count -= t.count;
});
return count;
}

function needsEscalation(feederId) {
return liveCount(feederId) >= 500 || (MOCK_SENSITIVE[feederId] || []).length > 0;
}

// Alerts
const alerts = [];
outages.filter(o => !o.ended_at).forEach(o => {
const f = MOCK_FEEDERS.find(x => x.id === o.feeder_id);
alerts.push({ type: â€œoutageâ€, color: â€œ#EF4444â€, icon: â€œâš¡â€, label: `Ø§Ù†Ù‚Ø·Ø§Ø¹ Ù†Ø´Ø· â€” ${f?.name} (${f?.substation})`, startTime: o.started_at, id: o.id });
});
transfers.filter(t => !t.ended_at && (now - t.started_at) > 24*3600*1000).forEach(t => {
const ff = MOCK_FEEDERS.find(x => x.id === t.from_feeder_id);
const tf = MOCK_FEEDERS.find(x => x.id === t.to_feeder_id);
alerts.push({ type: â€œtransfer24â€, color: â€œ#F59E0Bâ€, icon: â€œğŸ”„â€, label: `ØªØ­ÙˆÙŠÙ„ ØªØ¬Ø§ÙˆØ² 24 Ø³Ø§Ø¹Ø© â€” ${ff?.name} â† ${tf?.name}`, startTime: t.started_at, id: t.id });
});
tasks.filter(t => t.status !== â€œclosedâ€ && (now - t.created_at) > 3*86400000).forEach(t => {
alerts.push({ type: â€œtaskâ€, color: â€œ#F59E0Bâ€, icon: â€œğŸ“‹â€, label: `Ù…Ù‡Ù…Ø© Ù…ØªØ£Ø®Ø±Ø© â€” ${TASK_TYPES[t.type]} (${t.device_no})`, startTime: t.created_at, id: t.id });
});

const activeTransfers = transfers.filter(t => !t.ended_at);
const activeOutages = outages.filter(o => !o.ended_at);
const openTasks = tasks.filter(t => t.status !== â€œclosedâ€);

const navItems = [
{ key: â€œdashboardâ€, icon: â€œğŸ â€, label: â€œØ§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯â€ },
{ key: â€œtasksâ€, icon: â€œğŸ“‹â€, label: â€œØ§Ù„Ù…Ù‡Ø§Ù…â€ },
{ key: â€œoutagesâ€, icon: â€œâš¡â€, label: â€œØ§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹Ø§Øªâ€ },
{ key: â€œtransfersâ€, icon: â€œğŸ”„â€, label: â€œØ§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øªâ€ },
{ key: â€œnetworkâ€, icon: â€œğŸ—ºï¸â€, label: â€œØ§Ù„Ø´Ø¨ÙƒØ©â€ },
];

const styles = {
app: { display:â€œflexâ€, height:â€œ100vhâ€, background:â€#0F172Aâ€, color:â€#F1F5F9â€, fontFamily:â€œTajawal, Arial, sans-serifâ€, direction:â€œrtlâ€, overflow:â€œhiddenâ€ },
sidebar: { width:200, background:â€#0A1628â€, borderLeft:â€œ1px solid #1E293Bâ€, display:â€œflexâ€, flexDirection:â€œcolumnâ€, padding:â€œ16px 0â€ },
logo: { padding:â€œ0 16px 20pxâ€, borderBottom:â€œ1px solid #1E293Bâ€, marginBottom:8 },
logoText: { fontSize:13, fontWeight:700, color:â€#3B82F6â€, lineHeight:1.4 },
navItem: (active) => ({ display:â€œflexâ€, alignItems:â€œcenterâ€, gap:10, padding:â€œ10px 16pxâ€, cursor:â€œpointerâ€, borderRadius:8, margin:â€œ2px 8pxâ€, background: active ? â€œ#1E3A5Fâ€ : â€œtransparentâ€, color: active ? â€œ#3B82F6â€ : â€œ#94A3B8â€, fontSize:13, fontWeight: active ? 700 : 400, transition:â€œall 0.2sâ€ }),
main: { flex:1, overflow:â€œautoâ€, padding:20 },
header: { fontSize:22, fontWeight:700, marginBottom:20, color:â€#F1F5F9â€ },
card: { background:â€#1E293Bâ€, borderRadius:12, padding:16, marginBottom:12 },
statsRow: { display:â€œgridâ€, gridTemplateColumns:â€œrepeat(4,1fr)â€, gap:12, marginBottom:20 },
statCard: (col) => ({ background:â€#1E293Bâ€, borderRadius:12, padding:16, borderTop:`3px solid ${col}` }),
statNum: { fontSize:32, fontWeight:700, marginBottom:4 },
statLabel: { fontSize:12, color:â€#94A3B8â€ },
alertRow: { display:â€œflexâ€, alignItems:â€œcenterâ€, gap:12, padding:â€œ10px 14pxâ€, background:â€#0F172Aâ€, borderRadius:8, marginBottom:8 },
badge: (col) => ({ background:col+â€œ22â€, color:col, padding:â€œ2px 10pxâ€, borderRadius:20, fontSize:11, fontWeight:700, whiteSpace:â€œnowrapâ€ }),
btn: (col=â€#3B82F6â€) => ({ background:col, color:â€#fffâ€, border:â€œnoneâ€, borderRadius:8, padding:â€œ8px 18pxâ€, cursor:â€œpointerâ€, fontSize:13, fontWeight:700 }),
btnSm: (col=â€#3B82F6â€) => ({ background:col+â€œ22â€, color:col, border:`1px solid ${col}44`, borderRadius:6, padding:â€œ4px 12pxâ€, cursor:â€œpointerâ€, fontSize:12, fontWeight:600 }),
input: { background:â€#0F172Aâ€, border:â€œ1px solid #334155â€, borderRadius:8, padding:â€œ8px 12pxâ€, color:â€#F1F5F9â€, fontSize:13, width:â€œ100%â€, boxSizing:â€œborder-boxâ€ },
label: { fontSize:12, color:â€#94A3B8â€, marginBottom:4, display:â€œblockâ€ },
select: { background:â€#0F172Aâ€, border:â€œ1px solid #334155â€, borderRadius:8, padding:â€œ8px 12pxâ€, color:â€#F1F5F9â€, fontSize:13, width:â€œ100%â€, boxSizing:â€œborder-boxâ€ },
modal: { position:â€œfixedâ€, inset:0, background:â€#000000aaâ€, display:â€œflexâ€, alignItems:â€œcenterâ€, justifyContent:â€œcenterâ€, zIndex:100 },
modalBox: { background:â€#1E293Bâ€, borderRadius:16, padding:24, width:â€œmin(90vw,520px)â€, maxHeight:â€œ85vhâ€, overflowY:â€œautoâ€ },
tag: (col) => ({ display:â€œinline-blockâ€, background:col+â€œ22â€, color:col, borderRadius:6, padding:â€œ2px 8pxâ€, fontSize:11, fontWeight:700 }),
divider: { borderBottom:â€œ1px solid #334155â€, margin:â€œ12px 0â€ },
timelineStep: (done) => ({ display:â€œflexâ€, alignItems:â€œflex-startâ€, gap:12, marginBottom:12, opacity: done ? 1 : 0.4 }),
timelineDot: (col) => ({ width:12, height:12, borderRadius:â€œ50%â€, background:col, marginTop:3, flexShrink:0 }),
ringBox: { background:â€#0F172Aâ€, border:â€œ1px solid #3B82F6â€, borderRadius:8, padding:â€œ8px 12pxâ€, textAlign:â€œcenterâ€, minWidth:90 },
ringLabel: { fontSize:10, color:â€#64748Bâ€, marginBottom:4 },
ringValue: { fontSize:13, fontWeight:700, color:â€#3B82F6â€ },
feederCard: (esc) => ({ background:â€#1E293Bâ€, borderRadius:10, padding:12, borderRight:`3px solid ${esc ? "#EF4444" : "#334155"}`, marginBottom:8 }),
};

// ========== PAGES ==========

function Dashboard() {
return (
<div>
<div style={styles.header}>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>

```
    {/* Stats */}
    <div style={styles.statsRow}>
      {[
        { label:"Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙØªÙˆØ­Ø©", val: openTasks.length, col:"#3B82F6" },
        { label:"Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©", val: activeTransfers.length, col:"#F59E0B" },
        { label:"Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©", val: activeOutages.length, col:"#EF4444" },
        { label:"Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØºÙ„Ù‚Ø©", val: tasks.filter(t=>t.status==="closed").length, col:"#10B981" },
      ].map((s,i) => (
        <div key={i} style={styles.statCard(s.col)}>
          <div style={{...styles.statNum, color:s.col}}>{s.val}</div>
          <div style={styles.statLabel}>{s.label}</div>
        </div>
      ))}
    </div>

    {/* Alerts */}
    <div style={styles.card}>
      <div style={{fontSize:14, fontWeight:700, marginBottom:12, color:"#94A3B8"}}>ğŸ”” Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</div>
      {alerts.length === 0 && <div style={{color:"#64748B", fontSize:13}}>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹ âœ…</div>}
      {alerts.map((a, i) => (
        <div key={i} style={styles.alertRow}>
          <span style={{fontSize:18}}>{a.icon}</span>
          <span style={{flex:1, fontSize:13}}>{a.label}</span>
          <LiveTimer startTime={a.startTime} warnMs={4*3600*1000} dangerMs={24*3600*1000} />
        </div>
      ))}
    </div>

    {/* Active Outages */}
    {activeOutages.length > 0 && (
      <div style={styles.card}>
        <div style={{fontSize:14, fontWeight:700, marginBottom:12, color:"#EF4444"}}>âš¡ Ø§Ù†Ù‚Ø·Ø§Ø¹Ø§Øª Ù†Ø´Ø·Ø©</div>
        {activeOutages.map(o => {
          const f = MOCK_FEEDERS.find(x => x.id === o.feeder_id);
          const cnt = liveCount(o.feeder_id);
          const esc = needsEscalation(o.feeder_id);
          return (
            <div key={o.id} style={{...styles.alertRow, background:"#1E0A0A", borderRadius:10, padding:14}}>
              <div style={{flex:1}}>
                <div style={{fontWeight:700}}>{f?.name} â€” {f?.substation}</div>
                <div style={{fontSize:12, color:"#94A3B8", marginTop:2}}>Ø§Ù„Ù…ØªØ£Ø«Ø±ÙˆÙ†: {cnt} Ù…Ø´ØªØ±Ùƒ</div>
                {esc && <div style={{...styles.tag("#EF4444"), marginTop:4}}>âš ï¸ ÙŠØ¬Ø¨ Ø§Ù„ØªØµØ¹ÙŠØ¯ Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø£Ø²Ù…Ø§Øª</div>}
              </div>
              <LiveTimer startTime={o.started_at} warnMs={3600*1000} dangerMs={4*3600*1000} />
            </div>
          );
        })}
      </div>
    )}

    {/* Active Transfers */}
    {activeTransfers.length > 0 && (
      <div style={styles.card}>
        <div style={{fontSize:14, fontWeight:700, marginBottom:12, color:"#F59E0B"}}>ğŸ”„ ØªØ­ÙˆÙŠÙ„Ø§Øª Ù†Ø´Ø·Ø©</div>
        {activeTransfers.map(t => {
          const ff = MOCK_FEEDERS.find(x => x.id === t.from_feeder_id);
          const tf = MOCK_FEEDERS.find(x => x.id === t.to_feeder_id);
          return (
            <div key={t.id} style={{...styles.alertRow, background:"#1A1400", borderRadius:10, padding:14}}>
              <div style={{flex:1}}>
                <div style={{fontWeight:700}}>{ff?.name} â† {tf?.name}</div>
                <div style={{fontSize:12, color:"#94A3B8", marginTop:2}}>
                  {t.type === "emergency" ? "ØªØ­ÙˆÙŠÙ„ Ø·Ø§Ø±Ø¦" : "Ù…Ù†Ø§Ù‚Ù„Ø© Ø£Ø­Ù…Ø§Ù„"} Â· {t.count} Ù…Ø´ØªØ±Ùƒ
                </div>
              </div>
              <LiveTimer startTime={t.started_at} warnMs={4*3600*1000} dangerMs={24*3600*1000} />
            </div>
          );
        })}
      </div>
    )}

    {/* Recent Tasks */}
    <div style={styles.card}>
      <div style={{fontSize:14, fontWeight:700, marginBottom:12, color:"#94A3B8"}}>ğŸ“‹ Ø¢Ø®Ø± Ø§Ù„Ù…Ù‡Ø§Ù…</div>
      {tasks.slice(0,3).map(t => (
        <div key={t.id} style={{display:"flex", alignItems:"center", gap:10, padding:"8px 0", borderBottom:"1px solid #334155"}}>
          <span style={styles.tag(STATUS_COLORS[t.status])}>{STATUS_LABELS[t.status]}</span>
          <span style={{flex:1, fontSize:13}}>{TASK_TYPES[t.type]} â€” {t.device_no}</span>
          <span style={{fontSize:11, color: taskTimerColor(t.created_at), fontFamily:"monospace"}}>
            {Math.floor((now - t.created_at)/86400000)} ÙŠÙˆÙ…
          </span>
        </div>
      ))}
    </div>
  </div>
);
```

}

function TasksPage() {
const [filter, setFilter] = useState(â€œallâ€);
const filtered = filter === â€œallâ€ ? tasks : filter === â€œopenâ€ ? tasks.filter(t=>t.status!==â€œclosedâ€) : tasks.filter(t=>t.status===â€œclosedâ€);

```
const STEPS = ["open","received","zenon_done","microstation_done","reviewed","closed"];

function advanceTask(taskId) {
  setTasks(prev => prev.map(t => {
    if (t.id !== taskId) return t;
    const idx = STEPS.indexOf(t.status);
    if (idx < STEPS.length-1) return {...t, status: STEPS[idx+1]};
    return t;
  }));
}

return (
  <div>
    <div style={{display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:20}}>
      <div style={styles.header}>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</div>
      <button style={styles.btn()} onClick={() => setShowNewTask(true)}>+ Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>

    <div style={{display:"flex", gap:8, marginBottom:16}}>
      {[["all","Ø§Ù„ÙƒÙ„"],["open","Ø§Ù„Ù…ÙØªÙˆØ­Ø©"],["closed","Ø§Ù„Ù…ØºÙ„Ù‚Ø©"]].map(([k,l]) => (
        <button key={k} style={styles.btnSm(filter===k ? "#3B82F6" : "#64748B")} onClick={() => setFilter(k)}>{l}</button>
      ))}
    </div>

    {filtered.map(t => {
      const f = MOCK_FEEDERS.find(x => x.id === t.feeder_id);
      const stepIdx = STEPS.indexOf(t.status);
      return (
        <div key={t.id} style={styles.card}>
          <div style={{display:"flex", alignItems:"flex-start", justifyContent:"space-between", marginBottom:10}}>
            <div>
              <span style={styles.tag(STATUS_COLORS[t.status])}>{STATUS_LABELS[t.status]}</span>
              <span style={{...styles.tag("#64748B"), marginRight:6}}>{TASK_TYPES[t.type]}</span>
              <div style={{fontSize:15, fontWeight:700, marginTop:6}}>{t.device_no} â€” {f?.name} ({t.substation})</div>
            </div>
            <span style={{fontSize:11, color: taskTimerColor(t.created_at), fontFamily:"monospace"}}>
              {Math.floor((now - t.created_at)/86400000)} ÙŠÙˆÙ…
            </span>
          </div>

          {/* Timeline */}
          <div style={{display:"flex", gap:4, marginBottom:10, flexWrap:"wrap"}}>
            {STEPS.map((s,i) => (
              <div key={s} style={{display:"flex", alignItems:"center", gap:4}}>
                <div style={{padding:"3px 8px", borderRadius:6, fontSize:11, fontWeight:600,
                  background: i <= stepIdx ? STATUS_COLORS[s]+"33" : "#0F172A",
                  color: i <= stepIdx ? STATUS_COLORS[s] : "#475569",
                  border: `1px solid ${i <= stepIdx ? STATUS_COLORS[s]+"66" : "#334155"}`
                }}>{STATUS_LABELS[s]}</div>
                {i < STEPS.length-1 && <span style={{color:"#334155", fontSize:10}}>â†</span>}
              </div>
            ))}
          </div>

          {/* Terminals */}
          {t.type === "fix_terminals" && t.device_type && (
            <div style={{marginBottom:10}}>
              <div style={{fontSize:11, color:"#64748B", marginBottom:6}}>Ø§Ù„Ø£Ø·Ø±Ø§Ù:</div>
              <div style={{display:"flex", alignItems:"center", gap:8, justifyContent:"flex-start"}}>
                {t.device_type === "3way" ? (
                  <>
                    <div style={styles.ringBox}><div style={styles.ringLabel}>Ring 2</div><div style={styles.ringValue}>{t.ring2||"â€”"}</div></div>
                    <span style={{color:"#334155"}}>â€”</span>
                    <div style={{...styles.ringBox, borderColor:"#F59E0B"}}><div style={styles.ringLabel}>Ring (Ø§Ù„Ù…Ø¹Ø¯Ø©)</div><div style={{...styles.ringValue, color:"#F59E0B"}}>{t.device_no}</div></div>
                    <span style={{color:"#334155"}}>â€”</span>
                    <div style={styles.ringBox}><div style={styles.ringLabel}>Ring 1</div><div style={styles.ringValue}>{t.ring1||"â€”"}</div></div>
                  </>
                ) : (
                  <>
                    {["ring4","ring3","ring2","ring1"].map((r,i) => (
                      <div key={r} style={{display:"flex", alignItems:"center", gap:8}}>
                        <div style={styles.ringBox}><div style={styles.ringLabel}>Ring {4-i}</div><div style={styles.ringValue}>{t[r]||"â€”"}</div></div>
                        {i < 3 && <span style={{color:"#334155"}}>â€”</span>}
                      </div>
                    ))}
                  </>
                )}
              </div>
            </div>
          )}

          <div style={{display:"flex", alignItems:"center", justifyContent:"space-between"}}>
            <div style={{fontSize:11, color:"#64748B"}}>
              Ø§Ù„Ù…Ø±Ø­Ù‘Ù„: {t.created_by} Â· Ø§Ù„Ø±Ø³Ø§Ù…: {t.assigned_to}
              {t.notes ? ` Â· ${t.notes}` : ""}
            </div>
            {t.status !== "closed" && (
              <button style={styles.btnSm()} onClick={() => advanceTask(t.id)}>
                {stepIdx === STEPS.length-2 ? "Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØ¥ØºÙ„Ø§Ù‚ âœ“" : "ØªÙ‚Ø¯Ù‘Ù… Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© â†’"}
              </button>
            )}
          </div>
        </div>
      );
    })}
  </div>
);
```

}

function OutagesPage() {
const [newPhase, setNewPhase] = useState({ outageId: null, count: â€œâ€, method: â€œautoâ€, time: â€œâ€ });
const [reportOutage, setReportOutage] = useState(null);

```
function addPhase(outageId) {
  if (!newPhase.count) return;
  setOutages(prev => prev.map(o => {
    if (o.id !== outageId) return o;
    const phases = [...o.phases, {
      id: "p" + Date.now(),
      phase_number: o.phases.length + 1,
      restored_at: Date.now(),
      restored_count: parseInt(newPhase.count),
      method: newPhase.method
    }];
    return {...o, phases};
  }));
  setNewPhase({ outageId: null, count: "", method: "auto", time: "" });
}

function closeOutage(id) {
  setOutages(prev => prev.map(o => o.id === id ? {...o, ended_at: Date.now()} : o));
}

function generateReport(o) {
  const f = MOCK_FEEDERS.find(x => x.id === o.feeder_id);
  const sensitives = MOCK_SENSITIVE[o.feeder_id] || [];
  const phasesText = o.phases.map((p,i) =>
    `*(${i+1})* Ø§Ù„Ø³Ø§Ø¹Ø©: - ${fmtTime(p.restored_at)} Ù„Ø¹Ø¯Ø¯ (${p.restored_count}) Ù…Ø´ØªØ±Ùƒ ${p.method==="auto" ? "Ø¨Ø§Ù„Ø£ØªÙ…ØªØ©" : "Ø¨Ø§Ù„ØªØ´ØºÙŠÙ„"}`
  ).join("\n");
  return `ğŸ”¸ *Ø¨Ù„Ø§Øº Ø¬Ø¯ÙŠØ¯*\n\nğŸ”¸ *Ø¥Ø¯Ø§Ø±Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¡: Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©*\n\nğŸ”¶Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø®Ø¯Ù…Ø© Ø¨Ø³Ø¨Ø¨ ÙÙ‚Ø¯ ØªØºØ°ÙŠØ© Ø¹Ù†\n\nâ€¢ *Ø§Ù„Ù…ÙƒØªØ¨: Ø¹Ø±Ø¹Ø±*\nâ€¢ *Ù…Ø­Ø·Ø© Ø±Ù‚Ù…: ${f?.substation}*\nâ€¢ *Ù…ØºØ°ÙŠ Ø±Ù‚Ù…: ${f?.name}*\nâ€¢ *ÙˆÙ‚Øª Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹: ${fmtTime(o.started_at)}*\nâ€¢ *Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ†: ${liveCount(o.feeder_id)}*\n\nğŸ”¸ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ø­Ø³Ø§Ø³ÙŠÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ†:\n${sensitives.length > 0 ? sensitives.join("\n") : "Ù„Ø§ÙŠÙˆØ¬Ø¯"}\n\nğŸ”¸Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©:\n${o.affected_areas||"â€”"}\n\nğŸ”¸Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¥Ø¹Ø§Ø¯Ø©:\n${phasesText||"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø¹Ø¯"}\n${o.ended_at ? "\n(Ø§Ù†ØªÙ‡Ù‰ âœ”)" : ""}\n\nğŸ”¸Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø§Ø¨Ù„Ø§ØºÙ‡Ø§:\n${o.notifications.map(n=>`â€¢ ${n}`).join("\n")}\n\nğŸ”¶Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ø®Ø±Ù‰:\n${o.notes||"â€”"}`;
}

return (
  <div>
    <div style={{display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:20}}>
      <div style={styles.header}>Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹Ø§Øª</div>
      <button style={styles.btn()} onClick={() => setShowNewOutage(true)}>+ ØªØ³Ø¬ÙŠÙ„ Ø§Ù†Ù‚Ø·Ø§Ø¹</button>
    </div>

    {outages.map(o => {
      const f = MOCK_FEEDERS.find(x => x.id === o.feeder_id);
      const cnt = liveCount(o.feeder_id);
      const esc = needsEscalation(o.feeder_id);
      const sens = MOCK_SENSITIVE[o.feeder_id] || [];
      const isOpen = !o.ended_at;
      const report = generateReport(o);

      return (
        <div key={o.id} style={{...styles.card, borderRight:`3px solid ${isOpen ? "#EF4444" : "#334155"}`}}>
          <div style={{display:"flex", justifyContent:"space-between", alignItems:"flex-start", marginBottom:10}}>
            <div>
              <span style={styles.tag(isOpen ? "#EF4444" : "#64748B")}>{isOpen ? "Ù†Ø´Ø·" : "Ù…Ù†ØªÙ‡ÙŠ"}</span>
              <div style={{fontSize:16, fontWeight:700, marginTop:6}}>{f?.name} â€” {f?.substation}</div>
              <div style={{fontSize:12, color:"#94A3B8", marginTop:2}}>
                ÙˆÙ‚Øª Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹: {fmtTime(o.started_at)} Â· Ø§Ù„Ù…ØªØ£Ø«Ø±ÙˆÙ†: {cnt}
              </div>
              {esc && <div style={{...styles.tag("#EF4444"), marginTop:4}}>âš ï¸ ÙŠØ¬Ø¨ Ø§Ù„ØªØµØ¹ÙŠØ¯ â€” Ù…Ø±ÙƒØ² Ø§Ù„Ø£Ø²Ù…Ø§Øª</div>}
              {sens.length > 0 && <div style={{fontSize:11, color:"#F59E0B", marginTop:4}}>Ù…Ø´ØªØ±ÙƒÙˆÙ† Ø­Ø³Ø§Ø³ÙˆÙ†: {sens.join("ØŒ ")}</div>}
            </div>
            {isOpen && <LiveTimer startTime={o.started_at} warnMs={3600*1000} dangerMs={4*3600*1000} style={{fontSize:20}} />}
          </div>

          {/* Phases */}
          <div style={styles.divider} />
          <div style={{fontSize:12, color:"#94A3B8", marginBottom:8}}>Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¥Ø¹Ø§Ø¯Ø©:</div>
          {o.phases.map(p => (
            <div key={p.id} style={{display:"flex", gap:8, alignItems:"center", fontSize:12, marginBottom:4, color:"#10B981"}}>
              <span>âœ“</span>
              <span>({p.phase_number}) {fmtTime(p.restored_at)} â€” {p.restored_count} Ù…Ø´ØªØ±Ùƒ â€” {p.method==="auto" ? "Ø£ØªÙ…ØªØ©" : "ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ"}</span>
            </div>
          ))}
          {o.ended_at && <div style={{fontSize:12, color:"#10B981", fontWeight:700}}>(Ø§Ù†ØªÙ‡Ù‰ âœ”) {fmtTime(o.ended_at)}</div>}

          {/* Actions */}
          {isOpen && (
            <div style={{display:"flex", gap:8, marginTop:10, flexWrap:"wrap"}}>
              {newPhase.outageId === o.id ? (
                <div style={{display:"flex", gap:8, alignItems:"center", flex:1}}>
                  <input placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†" type="number" style={{...styles.input, width:120}} value={newPhase.count}
                    onChange={e => setNewPhase(p => ({...p, count: e.target.value}))} />
                  <select style={{...styles.select, width:130}} value={newPhase.method}
                    onChange={e => setNewPhase(p => ({...p, method: e.target.value}))}>
                    <option value="auto">Ø£ØªÙ…ØªØ©</option>
                    <option value="manual">ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ</option>
                  </select>
                  <button style={styles.btnSm("#10B981")} onClick={() => addPhase(o.id)}>Ø¥Ø¶Ø§ÙØ©</button>
                  <button style={styles.btnSm("#64748B")} onClick={() => setNewPhase({outageId:null,count:"",method:"auto"})}>Ø¥Ù„ØºØ§Ø¡</button>
                </div>
              ) : (
                <button style={styles.btnSm()} onClick={() => setNewPhase(p => ({...p, outageId: o.id}))}>+ Ù…Ø±Ø­Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø©</button>
              )}
              <button style={styles.btnSm("#10B981")} onClick={() => closeOutage(o.id)}>Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹ âœ“</button>
            </div>
          )}

          {/* Report */}
          <div style={styles.divider} />
          <div style={{background:"#0F172A", borderRadius:8, padding:12, fontSize:11, whiteSpace:"pre-wrap", color:"#94A3B8", maxHeight:160, overflow:"auto", marginBottom:8, fontFamily:"monospace"}}>{report}</div>
          <button style={styles.btn()} onClick={() => { navigator.clipboard?.writeText(report); }}>
            ğŸ“‹ Ù†Ø³Ø® Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
          </button>
        </div>
      );
    })}
  </div>
);
```

}

function TransfersPage() {
function closeTransfer(id) {
setTransfers(prev => prev.map(t => t.id === id ? {â€¦t, ended_at: Date.now()} : t));
}

```
return (
  <div>
    <div style={{display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:20}}>
      <div style={styles.header}>Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ©</div>
      <button style={styles.btn()} onClick={() => setShowNewTransfer(true)}>+ ØªØ³Ø¬ÙŠÙ„ ØªØ­ÙˆÙŠÙ„</button>
    </div>

    {transfers.map(t => {
      const ff = MOCK_FEEDERS.find(x => x.id === t.from_feeder_id);
      const tf = MOCK_FEEDERS.find(x => x.id === t.to_feeder_id);
      const isActive = !t.ended_at;
      const ms = now - t.started_at;
      const over24 = ms > 24*3600*1000;
      return (
        <div key={t.id} style={{...styles.card, borderRight:`3px solid ${isActive ? (over24 ? "#EF4444" : "#F59E0B") : "#334155"}`}}>
          <div style={{display:"flex", justifyContent:"space-between", alignItems:"flex-start"}}>
            <div>
              <span style={styles.tag(isActive ? "#F59E0B" : "#64748B")}>{isActive ? "Ù†Ø´Ø·" : "Ù…Ù†ØªÙ‡ÙŠ"}</span>
              <span style={{...styles.tag(t.type==="emergency" ? "#EF4444" : "#3B82F6"), marginRight:6}}>
                {t.type==="emergency" ? "ØªØ­ÙˆÙŠÙ„ Ø·Ø§Ø±Ø¦" : "Ù…Ù†Ø§Ù‚Ù„Ø© Ø£Ø­Ù…Ø§Ù„"}
              </span>
              {over24 && isActive && <span style={{...styles.tag("#EF4444"), marginRight:6}}>ØªØ¬Ø§ÙˆØ² 24 Ø³Ø§Ø¹Ø©!</span>}
              <div style={{fontSize:16, fontWeight:700, marginTop:6}}>
                {ff?.name} â† {tf?.name}
              </div>
              <div style={{fontSize:12, color:"#94A3B8", marginTop:2}}>
                Ù…Ù† Ù…Ø¹Ø¯Ø© {t.from_device} Ø¥Ù„Ù‰ {t.to_device} Â· {t.count} Ù…Ø´ØªØ±Ùƒ
              </div>
              <div style={{fontSize:12, color:"#64748B", marginTop:2}}>Ø§Ù„Ø³Ø¨Ø¨: {t.reason}</div>
              <div style={{marginTop:8, display:"flex", gap:16, fontSize:12}}>
                <div>
                  <span style={{color:"#64748B"}}>{ff?.name} Ø§Ù„Ø¢Ù†: </span>
                  <span style={{color:"#F1F5F9", fontWeight:700}}>{liveCount(t.from_feeder_id)}</span>
                </div>
                <div>
                  <span style={{color:"#64748B"}}>{tf?.name} Ø§Ù„Ø¢Ù†: </span>
                  <span style={{color: liveCount(t.to_feeder_id)>=500 ? "#EF4444" : "#F1F5F9", fontWeight:700}}>{liveCount(t.to_feeder_id)}</span>
                  {liveCount(t.to_feeder_id) >= 500 && <span style={{...styles.tag("#EF4444"), marginRight:6}}>ØªØµØ¹ÙŠØ¯!</span>}
                </div>
              </div>
            </div>
            {isActive && <LiveTimer startTime={t.started_at} warnMs={4*3600*1000} dangerMs={24*3600*1000} style={{fontSize:22}} />}
          </div>
          {isActive && (
            <div style={{marginTop:12}}>
              <button style={styles.btnSm("#10B981")} onClick={() => closeTransfer(t.id)}>Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ­ÙˆÙŠÙ„ â€” Ø±Ø¬Ø¹ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ âœ“</button>
            </div>
          )}
        </div>
      );
    })}

    {transfers.filter(t=>!t.ended_at).length === 0 && (
      <div style={{...styles.card, color:"#64748B", fontSize:13}}>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­ÙˆÙŠÙ„Ø§Øª Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ âœ…</div>
    )}
  </div>
);
```

}

function NetworkPage() {
const [expanded, setExpanded] = useState({});
const substations = [â€¦new Set(MOCK_FEEDERS.map(f => f.substation))];

```
return (
  <div>
    <div style={styles.header}>Ø§Ù„Ø´Ø¨ÙƒØ© â€” Ø§Ù„Ù…Ø­Ø·Ø§Øª ÙˆØ§Ù„Ù…ØºØ°ÙŠØ§Øª</div>
    {substations.map(sub => (
      <div key={sub} style={styles.card}>
        <div style={{display:"flex", alignItems:"center", justifyContent:"space-between", cursor:"pointer"}}
          onClick={() => setExpanded(e => ({...e, [sub]: !e[sub]}))}>
          <div style={{fontWeight:700, fontSize:15}}>ğŸ­ {sub}</div>
          <span style={{color:"#64748B"}}>{expanded[sub] ? "â–²" : "â–¼"}</span>
        </div>
        {expanded[sub] && (
          <div style={{marginTop:12}}>
            {MOCK_FEEDERS.filter(f => f.substation === sub).map(f => {
              const cnt = liveCount(f.id);
              const esc = needsEscalation(f.id);
              const hasTransfer = activeTransfers.some(t => t.from_feeder_id===f.id || t.to_feeder_id===f.id);
              const hasOutage = activeOutages.some(o => o.feeder_id===f.id);
              const sens = MOCK_SENSITIVE[f.id] || [];
              return (
                <div key={f.id} style={styles.feederCard(esc)}>
                  <div style={{display:"flex", justifyContent:"space-between", alignItems:"center"}}>
                    <div style={{fontWeight:700, fontSize:14}}>{f.name}</div>
                    <div style={{display:"flex", gap:6}}>
                      {esc && <span style={styles.tag("#EF4444")}>ØªØµØ¹ÙŠØ¯</span>}
                      {hasTransfer && <span style={styles.tag("#F59E0B")}>ØªØ­ÙˆÙŠÙ„ Ù†Ø´Ø·</span>}
                      {hasOutage && <span style={styles.tag("#EF4444")}>Ø§Ù†Ù‚Ø·Ø§Ø¹ Ù†Ø´Ø·</span>}
                    </div>
                  </div>
                  <div style={{display:"flex", gap:20, marginTop:6, fontSize:12}}>
                    <div>
                      <span style={{color:"#64748B"}}>Ø§Ù„Ø£ØµÙ„ÙŠ: </span>
                      <span>{f.base_subscribers}</span>
                    </div>
                    <div>
                      <span style={{color:"#64748B"}}>Ø§Ù„ÙØ¹Ù„ÙŠ: </span>
                      <span style={{fontWeight:700, color: cnt >= 500 ? "#EF4444" : "#10B981"}}>{cnt}</span>
                    </div>
                    {sens.length > 0 && (
                      <div style={{color:"#F59E0B"}}>âš ï¸ Ø­Ø³Ø§Ø³ÙˆÙ†: {sens.length}</div>
                    )}
                  </div>
                  {sens.length > 0 && (
                    <div style={{fontSize:11, color:"#F59E0B", marginTop:4}}>{sens.join(" Â· ")}</div>
                  )}
                </div>
              );
            })}
          </div>
        )}
      </div>
    ))}
  </div>
);
```

}

// ========== MODALS ==========

function NewTaskModal() {
const [form, setForm] = useState({ type:â€œfix_terminalsâ€, device_no:â€â€, feeder_id:â€œf1â€, substation:â€œØ¹Ø±Ø¹Ø± Ø¨â€, device_type:â€œ3wayâ€, ring1:â€â€, ring2:â€â€, ring3:â€â€, ring4:â€â€, assigned_to: USERS.draftsmen[0], notes:â€â€ });
const set = (k, v) => setForm(p => ({â€¦p, [k]: v}));

```
function submit() {
  if (!form.device_no) return;
  setTasks(prev => [...prev, {
    id: "t" + Date.now(),
    ...form,
    status: "open",
    created_by: "Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù†Ø²ÙŠ",
    created_at: Date.now()
  }]);
  setShowNewTask(false);
}

return (
  <div style={styles.modal} onClick={e => e.target === e.currentTarget && setShowNewTask(false)}>
    <div style={styles.modalBox}>
      <div style={{fontSize:16, fontWeight:700, marginBottom:16}}>Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>

      <div style={{marginBottom:12}}>
        <label style={styles.label}>Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
        <select style={styles.select} value={form.type} onChange={e => set("type", e.target.value)}>
          {Object.entries(TASK_TYPES).map(([k,v]) => <option key={k} value={k}>{v}</option>)}
        </select>
      </div>

      <div style={{marginBottom:12}}>
        <label style={styles.label}>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø¯Ø©</label>
        <input style={styles.input} value={form.device_no} onChange={e => set("device_no", e.target.value)} placeholder="Ù…Ø«Ø§Ù„: 403061" />
      </div>

      <div style={{display:"grid", gridTemplateColumns:"1fr 1fr", gap:10, marginBottom:12}}>
        <div>
          <label style={styles.label}>Ø§Ù„Ù…Ø­Ø·Ø©</label>
          <select style={styles.select} value={form.feeder_id} onChange={e => set("feeder_id", e.target.value)}>
            {MOCK_FEEDERS.map(f => <option key={f.id} value={f.id}>{f.name} â€” {f.substation}</option>)}
          </select>
        </div>
        <div>
          <label style={styles.label}>Ø§Ù„Ø±Ø³Ø§Ù… Ø§Ù„Ù…ÙƒÙ„Ù‘Ù</label>
          <select style={styles.select} value={form.assigned_to} onChange={e => set("assigned_to", e.target.value)}>
            {USERS.draftsmen.map(d => <option key={d} value={d}>{d}</option>)}
          </select>
        </div>
      </div>

      {form.type === "fix_terminals" && (
        <div style={{marginBottom:12}}>
          <label style={styles.label}>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø¯Ø©</label>
          <div style={{display:"flex", gap:8, marginBottom:12}}>
            {["3way","4way"].map(t => (
              <button key={t} style={styles.btnSm(form.device_type===t ? "#3B82F6" : "#64748B")} onClick={() => set("device_type", t)}>{t}</button>
            ))}
          </div>

          <label style={styles.label}>Ø§Ù„Ø£Ø·Ø±Ø§Ù</label>
          <div style={{display:"flex", alignItems:"center", gap:8, justifyContent:"flex-start"}}>
            {form.device_type === "3way" ? (
              <>
                <div style={{textAlign:"center"}}>
                  <div style={{fontSize:10, color:"#64748B", marginBottom:4}}>Ring 2 (ÙŠØ³Ø§Ø±)</div>
                  <input style={{...styles.input, width:90, textAlign:"center"}} value={form.ring2} onChange={e => set("ring2", e.target.value)} placeholder="B314" />
                </div>
                <span style={{color:"#334155", fontSize:18}}>â€”</span>
                <div style={{textAlign:"center"}}>
                  <div style={{fontSize:10, color:"#F59E0B", marginBottom:4}}>Ring (Ø§Ù„Ù…Ø¹Ø¯Ø©)</div>
                  <div style={{...styles.ringBox, width:90, borderColor:"#F59E0B"}}>
                    <div style={{fontSize:12, color:"#F59E0B", fontWeight:700}}>{form.device_no||"Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø¯Ø©"}</div>
                  </div>
                </div>
                <span style={{color:"#334155", fontSize:18}}>â€”</span>
                <div style={{textAlign:"center"}}>
                  <div style={{fontSize:10, color:"#64748B", marginBottom:4}}>Ring 1 (ÙŠÙ…ÙŠÙ†)</div>
                  <input style={{...styles.input, width:90, textAlign:"center"}} value={form.ring1} onChange={e => set("ring1", e.target.value)} placeholder="B313" />
                </div>
              </>
            ) : (
              <>
                {[["ring4","Ring 4"],["ring3","Ring 3"],["ring2","Ring 2"],["ring1","Ring 1"]].map(([k,l], i) => (
                  <div key={k} style={{display:"flex", alignItems:"center", gap:8}}>
                    <div style={{textAlign:"center"}}>
                      <div style={{fontSize:10, color:"#64748B", marginBottom:4}}>{l}</div>
                      <input style={{...styles.input, width:75, textAlign:"center"}} value={form[k]} onChange={e => set(k, e.target.value)} placeholder="B..." />
                    </div>
                    {i < 3 && <span style={{color:"#334155", fontSize:18}}>â€”</span>}
                  </div>
                ))}
              </>
            )}
          </div>
        </div>
      )}

      <div style={{marginBottom:16}}>
        <label style={styles.label}>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
        <input style={styles.input} value={form.notes} onChange={e => set("notes", e.target.value)} placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©" />
      </div>

      <div style={{display:"flex", gap:8, justifyContent:"flex-end"}}>
        <button style={styles.btnSm("#64748B")} onClick={() => setShowNewTask(false)}>Ø¥Ù„ØºØ§Ø¡</button>
        <button style={styles.btn()} onClick={submit}>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©</button>
      </div>
    </div>
  </div>
);
```

}

function NewTransferModal() {
const [form, setForm] = useState({ type:â€œemergencyâ€, from_feeder_id:â€œf1â€, to_feeder_id:â€œf2â€, from_device:â€â€, to_device:â€â€, count:â€â€, reason:â€â€ });
const set = (k,v) => setForm(p => ({â€¦p, [k]:v}));

```
function submit() {
  if (!form.count || !form.from_device || !form.to_device) return;
  setTransfers(prev => [...prev, {
    id: "tr" + Date.now(),
    ...form,
    count: parseInt(form.count),
    started_at: Date.now(),
    ended_at: null
  }]);
  setShowNewTransfer(false);
}

const previewFrom = liveCount(form.from_feeder_id) - (parseInt(form.count)||0);
const previewTo = liveCount(form.to_feeder_id) + (parseInt(form.count)||0);

return (
  <div style={styles.modal} onClick={e => e.target === e.currentTarget && setShowNewTransfer(false)}>
    <div style={styles.modalBox}>
      <div style={{fontSize:16, fontWeight:700, marginBottom:16}}>ØªØ³Ø¬ÙŠÙ„ ØªØ­ÙˆÙŠÙ„ Ù…Ø¤Ù‚Øª</div>

      <div style={{marginBottom:12}}>
        <label style={styles.label}>Ù†ÙˆØ¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„</label>
        <div style={{display:"flex", gap:8}}>
          {[["emergency","ØªØ­ÙˆÙŠÙ„ Ø·Ø§Ø±Ø¦"],["load_transfer","Ù…Ù†Ø§Ù‚Ù„Ø© Ø£Ø­Ù…Ø§Ù„"]].map(([k,l]) => (
            <button key={k} style={styles.btnSm(form.type===k ? "#3B82F6" : "#64748B")} onClick={() => set("type",k)}>{l}</button>
          ))}
        </div>
      </div>

      <div style={{display:"grid", gridTemplateColumns:"1fr 1fr", gap:10, marginBottom:12}}>
        <div>
          <label style={styles.label}>Ø§Ù„Ù…ØºØ°ÙŠ Ø§Ù„Ø£ØµÙ„ÙŠ</label>
          <select style={styles.select} value={form.from_feeder_id} onChange={e => set("from_feeder_id", e.target.value)}>
            {MOCK_FEEDERS.map(f => <option key={f.id} value={f.id}>{f.name}</option>)}
          </select>
        </div>
        <div>
          <label style={styles.label}>Ø§Ù„Ù…ØºØ°ÙŠ Ø§Ù„Ø¨Ø¯ÙŠÙ„</label>
          <select style={styles.select} value={form.to_feeder_id} onChange={e => set("to_feeder_id", e.target.value)}>
            {MOCK_FEEDERS.map(f => <option key={f.id} value={f.id}>{f.name}</option>)}
          </select>
        </div>
        <div>
          <label style={styles.label}>Ù…Ù† Ø§Ù„Ù…Ø¹Ø¯Ø© Ø±Ù‚Ù…</label>
          <input style={styles.input} value={form.from_device} onChange={e => set("from_device", e.target.value)} placeholder="403050" />
        </div>
        <div>
          <label style={styles.label}>Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø¯Ø© Ø±Ù‚Ù…</label>
          <input style={styles.input} value={form.to_device} onChange={e => set("to_device", e.target.value)} placeholder="403065" />
        </div>
      </div>

      <div style={{marginBottom:12}}>
        <label style={styles.label}>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„ÙŠÙ†</label>
        <input style={styles.input} type="number" value={form.count} onChange={e => set("count", e.target.value)} placeholder="300" />
      </div>

      {/* Live preview */}
      {form.count && (
        <div style={{background:"#0F172A", borderRadius:8, padding:12, marginBottom:12, fontSize:12}}>
          <div style={{color:"#64748B", marginBottom:6}}>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„:</div>
          <div style={{display:"flex", gap:20}}>
            <div>
              <span style={{color:"#64748B"}}>{MOCK_FEEDERS.find(f=>f.id===form.from_feeder_id)?.name}: </span>
              <span style={{color: previewFrom >= 500 ? "#EF4444" : "#10B981", fontWeight:700}}>{previewFrom}</span>
            </div>
            <div>
              <span style={{color:"#64748B"}}>{MOCK_FEEDERS.find(f=>f.id===form.to_feeder_id)?.name}: </span>
              <span style={{color: previewTo >= 500 ? "#EF4444" : "#10B981", fontWeight:700}}>{previewTo}</span>
              {previewTo >= 500 && <span style={{...styles.tag("#EF4444"), marginRight:6}}>âš ï¸ ÙŠØ³ØªÙˆØ¬Ø¨ Ø§Ù„ØªØµØ¹ÙŠØ¯!</span>}
            </div>
          </div>
        </div>
      )}

      <div style={{marginBottom:16}}>
        <label style={styles.label}>Ø³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„</label>
        <input style={styles.input} value={form.reason} onChange={e => set("reason", e.target.value)} placeholder="Ø¹Ø·Ù„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§Ø¨Ù„..." />
      </div>

      <div style={{display:"flex", gap:8, justifyContent:"flex-end"}}>
        <button style={styles.btnSm("#64748B")} onClick={() => setShowNewTransfer(false)}>Ø¥Ù„ØºØ§Ø¡</button>
        <button style={styles.btn()} onClick={submit}>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ­ÙˆÙŠÙ„</button>
      </div>
    </div>
  </div>
);
```

}

function NewOutageModal() {
const [form, setForm] = useState({ feeder_id:â€œf7â€, affected_areas:â€â€, notes:â€â€ });
const set = (k,v) => setForm(p => ({â€¦p, [k]:v}));

```
function submit() {
  const f = MOCK_FEEDERS.find(x => x.id === form.feeder_id);
  const sens = (MOCK_SENSITIVE[form.feeder_id] || []).length > 0;
  setOutages(prev => [...prev, {
    id: "o" + Date.now(),
    ...form,
    started_at: Date.now(),
    ended_at: null,
    affected_count: liveCount(form.feeder_id),
    has_sensitive: sens,
    escalated: needsEscalation(form.feeder_id),
    phases: [],
    notifications: needsEscalation(form.feeder_id) ? ["Ø§Ù„Ø£Ø²Ù…Ø§Øª ÙˆØ§Ù„ÙƒÙˆØ§Ø±Ø«","Ø§Ù„ØªØ´ØºÙŠÙ„"] : ["Ø§Ù„ØªØ´ØºÙŠÙ„"]
  }]);
  setShowNewOutage(false);
}

const esc = needsEscalation(form.feeder_id);
const cnt = liveCount(form.feeder_id);
const sens = MOCK_SENSITIVE[form.feeder_id] || [];

return (
  <div style={styles.modal} onClick={e => e.target === e.currentTarget && setShowNewOutage(false)}>
    <div style={styles.modalBox}>
      <div style={{fontSize:16, fontWeight:700, marginBottom:16}}>ØªØ³Ø¬ÙŠÙ„ Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø¬Ø¯ÙŠØ¯</div>

      <div style={{marginBottom:12}}>
        <label style={styles.label}>Ø§Ù„Ù…ØºØ°ÙŠ</label>
        <select style={styles.select} value={form.feeder_id} onChange={e => set("feeder_id", e.target.value)}>
          {MOCK_FEEDERS.map(f => <option key={f.id} value={f.id}>{f.name} â€” {f.substation}</option>)}
        </select>
      </div>

      {/* Auto-filled preview */}
      <div style={{background:"#0F172A", borderRadius:8, padding:12, marginBottom:12, fontSize:12}}>
        <div style={{color:"#64748B", marginBottom:6}}>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©:</div>
        <div style={{display:"flex", flexDirection:"column", gap:4}}>
          <div><span style={{color:"#64748B"}}>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ† Ø§Ù„ÙØ¹Ù„ÙŠ: </span><span style={{fontWeight:700, color: cnt>=500?"#EF4444":"#F1F5F9"}}>{cnt}</span></div>
          <div><span style={{color:"#64748B"}}>Ø§Ù„Ù…Ø´ØªØ±ÙƒÙˆÙ† Ø§Ù„Ø­Ø³Ø§Ø³ÙˆÙ†: </span><span style={{color: sens.length>0?"#F59E0B":"#10B981"}}>{sens.length>0 ? sens.join("ØŒ ") : "Ù„Ø§ ÙŠÙˆØ¬Ø¯"}</span></div>
          {esc && <div style={styles.tag("#EF4444")}>âš ï¸ ÙŠØ¬Ø¨ Ø§Ù„ØªØµØ¹ÙŠØ¯ Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø£Ø²Ù…Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</div>}
        </div>
      </div>

      <div style={{marginBottom:12}}>
        <label style={styles.label}>Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©</label>
        <input style={styles.input} value={form.affected_areas} onChange={e => set("affected_areas", e.target.value)} placeholder="Ø§Ù„Ù‚Ø¯Ø³ØŒ Ø§Ù„ÙÙŠØµÙ„ÙŠØ©..." />
      </div>

      <div style={{marginBottom:16}}>
        <label style={styles.label}>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
        <input style={styles.input} value={form.notes} onChange={e => set("notes", e.target.value)} placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª..." />
      </div>

      <div style={{display:"flex", gap:8, justifyContent:"flex-end"}}>
        <button style={styles.btnSm("#64748B")} onClick={() => setShowNewOutage(false)}>Ø¥Ù„ØºØ§Ø¡</button>
        <button style={styles.btn("#EF4444")} onClick={submit}>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹</button>
      </div>
    </div>
  </div>
);
```

}

const pages = { dashboard: <Dashboard />, tasks: <TasksPage />, outages: <OutagesPage />, transfers: <TransfersPage />, network: <NetworkPage /> };

return (
<div style={styles.app}>
{/* Sidebar */}
<div style={styles.sidebar}>
<div style={styles.logo}>
<div style={styles.logoText}>âš¡ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø©<br/>Ø´Ø¨ÙƒØ© Ø§Ù„ØªÙˆØ²ÙŠØ¹</div>
</div>
{navItems.map(n => (
<div key={n.key} style={styles.navItem(page===n.key)} onClick={() => setPage(n.key)}>
<span>{n.icon}</span>
<span>{n.label}</span>
{n.key===â€œtasksâ€ && openTasks.length>0 && <span style={{marginRight:â€œautoâ€, background:â€#3B82F6â€, color:â€#fffâ€, borderRadius:10, padding:â€œ0 6pxâ€, fontSize:10}}>{openTasks.length}</span>}
{n.key===â€œoutagesâ€ && activeOutages.length>0 && <span style={{marginRight:â€œautoâ€, background:â€#EF4444â€, color:â€#fffâ€, borderRadius:10, padding:â€œ0 6pxâ€, fontSize:10}}>{activeOutages.length}</span>}
{n.key===â€œtransfersâ€ && activeTransfers.length>0 && <span style={{marginRight:â€œautoâ€, background:â€#F59E0Bâ€, color:â€#fffâ€, borderRadius:10, padding:â€œ0 6pxâ€, fontSize:10}}>{activeTransfers.length}</span>}
</div>
))}
<div style={{marginTop:â€œautoâ€, padding:â€œ16pxâ€, borderTop:â€œ1px solid #1E293Bâ€}}>
<div style={{fontSize:12, color:â€#94A3B8â€}}>Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù†Ø²ÙŠ</div>
<div style={{fontSize:10, color:â€#475569â€}}>Ù…Ø±Ø­Ù‘Ù„</div>
</div>
</div>

```
  {/* Main */}
  <div style={styles.main}>
    {pages[page]}
  </div>

  {/* Modals */}
  {showNewTask && <NewTaskModal />}
  {showNewTransfer && <NewTransferModal />}
  {showNewOutage && <NewOutageModal />}
</div>
```

);
}