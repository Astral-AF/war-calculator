<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Pro">
    <meta name="theme-color" content="#667eea">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„Ø£Ø®ÙŠØ±Ø© Pro Max</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a6fd6;
            --accent: #764ba2;
            --bg-body: #f0f2f5;
            --bg-card: rgba(255, 255, 255, 0.75);
            --bg-card-solid: #fff;
            --text-main: #2d3748;
            --text-sub: #718096;
            --border: rgba(226, 232, 240, 0.6);
            --success: #48bb78;
            --danger: #f56565;
            --warning: #ed8936;
            --info: #4299e1;
            --radius: 18px;
            --glass-blur: 12px;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.08)
        }

        [data-theme="dark"] {
            --primary: #7f9cf5;
            --primary-dark: #667eea;
            --accent: #5a67d8;
            --bg-body: #0f172a;
            --bg-card: rgba(30, 41, 59, 0.8);
            --bg-card-solid: #1e293b;
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --border: rgba(71, 85, 105, 0.5);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3)
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Tajawal', 'Segoe UI', Tahoma, sans-serif
        }

        body {
            background: var(--bg-body);
            color: var(--text-main);
            padding-bottom: 80px;
            transition: background .4s, color .4s;
            overflow-x: hidden
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 20%, rgba(102, 126, 234, 0.08) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(118, 75, 162, 0.06) 0%, transparent 50%);
            z-index: -1;
            animation: bgFloat 20s ease-in-out infinite alternate
        }

        @keyframes bgFloat {
            0% {
                transform: translate(0, 0)
            }

            100% {
                transform: translate(-5%, 5%)
            }
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: #fff;
            padding: 28px 15px;
            padding-top: max(28px, env(safe-area-inset-top));
            text-align: center;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
            position: relative;
            margin-bottom: 24px;
            overflow: hidden
        }

        .header::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 60%);
            animation: headerShine 6s ease-in-out infinite
        }

        @keyframes headerShine {

            0%,
            100% {
                transform: translate(-30%, -30%)
            }

            50% {
                transform: translate(30%, 30%)
            }
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 6px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            position: relative
        }

        .header p {
            opacity: .9;
            font-size: .85rem;
            position: relative
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            left: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: transform .3s, background .3s;
            z-index: 10
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.3)
        }

        .tabs-wrapper {
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(15px);
            background: rgba(240, 242, 245, 0.8);
            padding: 12px 10px;
            transition: background .4s
        }

        [data-theme="dark"] .tabs-wrapper {
            background: rgba(15, 23, 42, 0.85)
        }

        .tabs {
            display: flex;
            overflow-x: auto;
            gap: 8px;
            padding: 6px;
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(var(--glass-blur));
            scrollbar-width: none
        }

        .tabs::-webkit-scrollbar {
            display: none
        }

        .tab {
            flex: 0 0 auto;
            padding: 11px 22px;
            border: none;
            background: transparent;
            color: var(--text-sub);
            font-weight: 700;
            border-radius: 12px;
            font-size: .9rem;
            cursor: pointer;
            transition: all .3s cubic-bezier(.4, 0, .2, 1);
            position: relative;
            overflow: hidden
        }

        .tab::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            opacity: 0;
            transition: opacity .3s;
            border-radius: 12px
        }

        .tab.active {
            color: #fff;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.35);
            transform: translateY(-1px)
        }

        .tab.active::before {
            opacity: 1
        }

        .tab span {
            position: relative;
            z-index: 1
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 15px
        }

        .tab-content {
            display: none;
            animation: slideUp .4s cubic-bezier(.4, 0, .2, 1)
        }

        .tab-content.active {
            display: block
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(25px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 22px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            backdrop-filter: blur(var(--glass-blur));
            transition: transform .2s, box-shadow .2s
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12)
        }

        .card h2 {
            font-size: 1.15rem;
            color: var(--primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 800
        }

        .input-group {
            margin-bottom: 20px
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-sub);
            font-size: .9rem;
            font-weight: 700
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 13px 16px;
            border: 2px solid var(--border);
            border-radius: 14px;
            background: var(--bg-body);
            color: var(--text-main);
            font-size: 16px;
            font-family: 'Tajawal', sans-serif;
            transition: all .3s;
            appearance: none
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.12);
            transform: scale(1.01)
        }

        .preview-box {
            font-size: .82rem;
            color: var(--primary);
            margin-top: 8px;
            padding: 10px 14px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.08), rgba(118, 75, 162, 0.05));
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600
        }

        .grid-select {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 8px
        }

        .select-item {
            background: var(--bg-body);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 10px 5px;
            text-align: center;
            cursor: pointer;
            transition: all .25s cubic-bezier(.4, 0, .2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 68px
        }

        .select-item:hover {
            border-color: var(--primary);
            transform: translateY(-2px)
        }

        .select-item.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.1));
            color: var(--primary);
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2)
        }

        .select-item span {
            font-size: 1.2rem;
            display: block;
            margin-bottom: 4px
        }

        .select-item small {
            font-size: .7rem;
            font-weight: 700
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 25px
        }

        button.btn-lg {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all .3s cubic-bezier(.4, 0, .2, 1);
            position: relative;
            overflow: hidden;
            font-family: 'Tajawal', sans-serif
        }

        button.btn-lg:active {
            transform: scale(.97)
        }

        button.btn-lg::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(rgba(255, 255, 255, 0.2), transparent);
            opacity: 0;
            transition: opacity .3s
        }

        button.btn-lg:hover::after {
            opacity: 1
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: #fff;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3)
        }

        .btn-primary:hover {
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.45);
            transform: translateY(-2px)
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-main);
            border: 2px solid var(--border) !important;
            box-shadow: var(--shadow)
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: #fff;
            box-shadow: 0 6px 20px rgba(72, 187, 120, 0.3)
        }

        .type-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: .87rem;
            font-weight: 700;
            margin-bottom: 15px;
            animation: badgePulse 2s ease-in-out infinite
        }

        @keyframes badgePulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.2)
            }

            50% {
                box-shadow: 0 0 0 8px rgba(102, 126, 234, 0)
            }
        }

        .type-badge.advantage {
            background: rgba(72, 187, 120, 0.15);
            color: var(--success);
            border: 2px solid var(--success)
        }

        .type-badge.disadvantage {
            background: rgba(245, 101, 101, 0.15);
            color: var(--danger);
            border: 2px solid var(--danger)
        }

        .type-badge.neutral {
            background: rgba(237, 137, 54, 0.15);
            color: var(--warning);
            border: 2px solid var(--warning)
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px
        }

        .stat-box {
            background: var(--bg-body);
            padding: 16px;
            border-radius: 14px;
            text-align: center;
            border: 1px solid var(--border);
            transition: transform .2s
        }

        .stat-box:hover {
            transform: scale(1.03)
        }

        .stat-val {
            font-size: 1.35rem;
            font-weight: 800;
            color: var(--text-main)
        }

        .stat-lbl {
            font-size: .8rem;
            color: var(--text-sub);
            margin-top: 5px;
            font-weight: 600
        }

        .battle-log {
            max-height: 300px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 20px;
            padding: 10px;
            background: var(--bg-body);
            border-radius: 14px
        }

        .log-entry {
            padding: 10px 12px;
            margin-bottom: 8px;
            border-radius: 10px;
            border-right: 4px solid var(--primary);
            background: var(--bg-card);
            font-size: .85rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background .2s
        }

        .log-entry:hover {
            background: rgba(102, 126, 234, 0.05)
        }

        .log-entry.critical {
            border-right-color: var(--warning);
            background: rgba(237, 137, 54, 0.08)
        }

        .vs-badge {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: #fff;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            margin: -12px auto 12px;
            border: 4px solid var(--bg-card-solid);
            position: relative;
            z-index: 2;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            font-size: .9rem
        }

        .chart-wrapper {
            height: 250px;
            position: relative;
            margin: 15px 0
        }

        .saved-item {
            padding: 14px;
            margin-bottom: 10px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 14px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all .25s;
            backdrop-filter: blur(var(--glass-blur))
        }

        .saved-item:hover {
            border-color: var(--primary);
            transform: translateX(-4px);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15)
        }

        .delete-btn {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            color: #fff;
            border: none;
            padding: 8px 14px;
            border-radius: 10px;
            font-size: .8rem;
            cursor: pointer;
            font-weight: 700;
            transition: transform .2s;
            font-family: 'Tajawal', sans-serif
        }

        .delete-btn:hover {
            transform: scale(1.05)
        }

        .info-tooltip {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: #fff;
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
            font-size: 11px;
            margin-right: 5px;
            cursor: help
        }

        .footer {
            background: linear-gradient(135deg, #1a202c 0%, #0f172a 100%);
            color: #fff;
            padding: 30px 15px;
            text-align: center;
            margin-top: 40px;
            border-top: 4px solid #ffd700;
            position: relative;
            overflow: hidden
        }

        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ffd700, #ff6b6b, #667eea, #48bb78, #ffd700);
            background-size: 200% 100%;
            animation: footerGlow 3s linear infinite
        }

        @keyframes footerGlow {
            0% {
                background-position: 0% 0%
            }

            100% {
                background-position: 200% 0%
            }
        }

        .footer-avatar {
            width: 75px;
            height: 75px;
            border-radius: 50%;
            border: 3px solid #ffd700;
            margin-bottom: 15px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3)
        }

        .footer h3 {
            color: #ffd700;
            font-size: 1.3rem;
            margin-bottom: 8px;
            font-weight: 800
        }

        .footer p {
            color: #94a3b8;
            font-size: .85rem;
            margin: 4px 0
        }
    </style>
</head>

<body>

    <div class="header">
        <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
        <h1>âš”ï¸ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„Ø£Ø®ÙŠØ±Ø© Pro Max</h1>
        <p>Ù…Ø­Ø§ÙƒÙŠ Ù‚ØªØ§Ù„ Ù…ØªÙ‚Ø¯Ù… + Ø£Ø¯ÙˆØ§Øª Ø´Ø§Ù…Ù„Ø© v5.1 | Built by DistopÇa</p>
    </div>

    <div class="tabs-wrapper">
        <div class="tabs" style="flex-wrap:wrap;">
            <button class="tab active" onclick="switchTab('calculator')"><span>ğŸ¯ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</span></button>
            <button class="tab" onclick="switchTab('compare')"><span>âš”ï¸ Ù…Ù‚Ø§Ø±Ù†Ø©</span></button>
            <button class="tab" onclick="switchTab('heroes')"><span>ğŸ¦¸ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</span></button>
            <button class="tab" onclick="switchTab('tierlist')"><span>ğŸ† Tier List</span></button>
            <button class="tab" onclick="switchTab('teambuilder')"><span>ğŸ‘¥ Ø§Ù„ÙØ±ÙŠÙ‚</span></button>
            <button class="tab" onclick="switchTab('tools')"><span>ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª</span></button>
            <button class="tab" onclick="switchTab('saved')"><span>ğŸ’¾ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</span></button>
            <button class="tab" onclick="switchTab('charts')"><span>ğŸ“Š Ø§Ù„Ø±Ø³ÙˆÙ…</span></button>
        </div>
    </div>

    <div class="container">
        <div id="calculator" class="tab-content active">
            <div class="card">
                <h2>ğŸ—¡ï¸ Ø§Ù„Ù…Ù‡Ø§Ø¬Ù…</h2>
                <div class="input-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                    <select id="attackerType" onchange="updatePreview()">
                        <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø© (Tank)</option>
                        <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø© (Aircraft)</option>
                        <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ® (Missile)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Ù‚ÙˆØ© Ø§Ù„Ù‡Ø¬ÙˆÙ…</label>
                    <input type="text" id="attack" value="65.2K" inputmode="decimal" oninput="updatePreview()">
                    <div class="preview-box"><span>Ø§Ù„Ù‚ÙŠÙ…Ø©:</span><strong id="attackValue">65,200</strong></div>
                </div>
                <div class="input-group">
                    <label><span class="info-tooltip">â„¹</span> Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø¬ÙˆÙ… <span
                            style="font-size:.7rem;color:var(--warning);font-weight:600;">âš ï¸ ØªÙ‚Ø±ÙŠØ¨ÙŠ</span></label>
                    <div class="grid-select">
                        <div class="select-item selected" onclick="selectStars(0,this)">
                            <span>â­</span><small>+30%</small>
                        </div>
                        <div class="select-item" onclick="selectStars(1,this)"><span>â­â­</span><small>+70%</small></div>
                        <div class="select-item" onclick="selectStars(2,this)"><span>â­â­â­</span><small>+120%</small>
                        </div>
                        <div class="select-item" onclick="selectStars(3,this)"><span>â­â­â­â­</span><small>+185%</small>
                        </div>
                        <div class="select-item" onclick="selectStars(4,this)"><span>â­â­â­â­â­</span><small>+270%</small>
                        </div>
                    </div>
                </div>
                <div class="input-group">
                    <label><span class="info-tooltip">â„¹</span> Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ø§Ø±Ø© <span
                            style="font-size:.7rem;color:var(--warning);font-weight:600;">âš ï¸ ØªÙ‚Ø±ÙŠØ¨ÙŠ</span></label>
                    <div class="grid-select" style="grid-template-columns:repeat(3,1fr);">
                        <div class="select-item selected" onclick="selectSkill(0,this)">
                            <span>âš”ï¸</span><small>Ø¹Ø§Ø¯ÙŠØ©<br>100%</small>
                        </div>
                        <div class="select-item" onclick="selectSkill(1,this)">
                            <span>ğŸ”¥</span><small>Ø®Ø§ØµØ©<br>345%</small>
                        </div>
                        <div class="select-item" onclick="selectSkill(2,this)">
                            <span>ğŸ’¥</span><small>Ù†Ù‡Ø§Ø¦ÙŠØ©<br>405%</small>
                        </div>
                    </div>
                    <div
                        style="font-size:.72rem;color:var(--text-sub);margin-top:8px;padding:8px 12px;background:rgba(237,137,54,0.08);border-radius:8px;border-right:3px solid var(--warning);">
                        âš ï¸ Ù†Ø³Ø¨ Ø§Ù„Ù†Ø¬ÙˆÙ… ÙˆØ§Ù„Ù…Ù‡Ø§Ø±Ø§Øª ØªÙ‚Ø±ÙŠØ¨ÙŠØ© â€” ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙƒÙ„ Ø¨Ø·Ù„ Ù„Ù‡ Ù†Ø³Ø¨ Ù…Ø®ØªÙ„ÙØ© Ø­Ø³Ø¨ Ù…Ù‡Ø§Ø±Ø§ØªÙ‡ ÙˆÙ…Ø³ØªÙˆØ§Ù‡
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="input-group" style="margin:0;">
                        <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬ %</label>
                        <input type="number" id="critChance" value="20" inputmode="numeric" oninput="updatePreview()">
                        <div class="preview-box" style="margin-top:8px;"><span>1 Ù…Ù† ÙƒÙ„</span><strong
                                id="critFreq">5</strong></div>
                    </div>
                    <div class="input-group" style="margin:0;">
                        <label>Ø¶Ø±Ø± Ø§Ù„Ø­Ø±Ø¬ %</label>
                        <input type="number" id="critDamage" value="150" inputmode="numeric" oninput="updatePreview()">
                        <div class="preview-box" style="margin-top:8px;"><span>Ù…Ø¶Ø§Ø¹Ù</span><strong
                                id="critMulti">Ã—1.5</strong></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ›¡ï¸ Ø§Ù„Ù…Ø¯Ø§ÙØ¹</h2>
                <div class="input-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                    <select id="defenderType" onchange="updatePreview()">
                        <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø© (Tank)</option>
                        <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø© (Aircraft)</option>
                        <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ® (Missile)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Ù†Ù‚Ø§Ø· Ø§Ù„ØµØ­Ø© (HP)</label>
                    <input type="text" id="health" value="1.4M" inputmode="decimal" oninput="updatePreview()">
                    <div class="preview-box"><span>Ø§Ù„Ù‚ÙŠÙ…Ø©:</span><strong id="healthValue">1,400,000</strong></div>
                </div>
                <div class="stats-grid">
                    <div class="input-group" style="margin:0;">
                        <label>Ø§Ù„Ø¯ÙØ§Ø¹</label>
                        <input type="text" id="defense" value="8.4K" inputmode="decimal" oninput="updatePreview()">
                    </div>
                    <div class="input-group" style="margin:0;">
                        <label>Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© %</label>
                        <input type="number" id="resistance" value="10" inputmode="numeric">
                    </div>
                </div>
                <div class="input-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <input type="text" id="calcName" placeholder="Ù…Ø«Ø§Ù„: Ø¯Ø¨Ø§Ø¨ØªÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
                </div>
            </div>

            <div class="card">
                <h2>ğŸ‘¥ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ±ÙŠÙ‚</h2>
                <div class="input-group">
                    <label><span class="info-tooltip">â„¹</span> Ø¨ÙˆÙ†Øµ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© (Lineup Bonus)</label>
                    <div class="grid-select" style="grid-template-columns:repeat(4,1fr);">
                        <div class="select-item" onclick="selectLineup(0,this)">
                            <span>ğŸ‘¤</span><small>Ø¨Ø¯ÙˆÙ†<br>0%</small>
                        </div>
                        <div class="select-item selected" onclick="selectLineup(1,this)">
                            <span>ğŸ‘¥</span><small>3 Ù†ÙØ³<br>+5%</small>
                        </div>
                        <div class="select-item" onclick="selectLineup(2,this)">
                            <span>ğŸ‘¥ğŸ‘¤</span><small>3+2<br>+10%</small>
                        </div>
                        <div class="select-item" onclick="selectLineup(3,this)">
                            <span>ğŸ‘¥ğŸ‘¥</span><small>4 Ù†ÙØ³<br>+15%</small>
                        </div>
                    </div>
                    <div class="grid-select" style="grid-template-columns:1fr;margin-top:8px;">
                        <div class="select-item" onclick="selectLineup(4,this)">
                            <span>ğŸ‘¥ğŸ‘¥ğŸ‘¤</span><small>5 Ù†ÙØ³ Ø§Ù„Ù†ÙˆØ¹ â€” +20% Ù‡Ø¬ÙˆÙ…/HP/Ø¯ÙØ§Ø¹</small>
                        </div>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="input-group" style="margin:0;">
                        <label>ğŸ¯ Ø§Ù„Ø±ÙˆØ­ Ø§Ù„Ù…Ø¹Ù†ÙˆÙŠØ© (Morale) %</label>
                        <input type="number" id="morale" value="100" inputmode="numeric" min="50" max="200"
                            oninput="updatePreview()">
                        <div class="preview-box" style="margin-top:8px;"><span>Ù…Ø¶Ø§Ø¹Ù</span><strong
                                id="moraleMulti">Ã—1.00</strong></div>
                    </div>
                    <div class="input-group" style="margin:0;">
                        <label>ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø©</label>
                        <div
                            style="font-size:.75rem;color:var(--text-sub);padding:10px;background:var(--bg-body);border-radius:10px;line-height:1.6;">
                            100% = Ù„Ø§ ØªØ£Ø«ÙŠØ±<br>
                            >100% = Ø¶Ø±Ø± Ø¥Ø¶Ø§ÙÙŠ<br>
                            <100%=Ø¶Ø±Ø± Ø£Ù‚Ù„ </div>
                        </div>
                    </div>
                </div>

                <div id="typeAdvantagePreview" style="text-align:center;margin:15px 0;"></div>

                <div class="action-buttons">
                    <button class="btn-lg btn-primary" onclick="simulateBattle()"><span>ğŸ¯</span> Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©</button>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
                        <button class="btn-lg btn-secondary" onclick="saveCalculation()">ğŸ’¾ Ø­ÙØ¸</button>
                        <button class="btn-lg btn-success" onclick="shareAsImage()">ğŸ“¸ ØµÙˆØ±Ø©</button>
                    </div>
                </div>
                <div id="results" style="display:none;margin-top:25px;"></div>
            </div>

            <div id="compare" class="tab-content">
                <div class="card">
                    <h2>Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</h2>
                    <div class="input-group"><label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label><select id="comp1Type">
                            <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©</option>
                            <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø©</option>
                            <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ®</option>
                        </select></div>
                    <div class="input-group"><label>Ø§Ù„Ù‡Ø¬ÙˆÙ…</label><input type="text" id="comp1Attack" value="65.2K">
                    </div>
                    <div class="input-group"><label>Ø§Ù„Ù†Ø¬ÙˆÙ…</label><select id="comp1Stars">
                            <option value="0">â­ +30%</option>
                            <option value="1">â­â­ +70%</option>
                            <option value="2">â­â­â­ +120%</option>
                            <option value="3">â­â­â­â­ +185%</option>
                            <option value="4">â­â­â­â­â­ +270%</option>
                        </select></div>
                </div>
                <div class="vs-badge">VS</div>
                <div class="card">
                    <h2>Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</h2>
                    <div class="input-group"><label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label><select id="comp2Type">
                            <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©</option>
                            <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø©</option>
                            <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ®</option>
                        </select></div>
                    <div class="input-group"><label>Ø§Ù„Ù‡Ø¬ÙˆÙ…</label><input type="text" id="comp2Attack" value="70K"></div>
                    <div class="input-group"><label>Ø§Ù„Ù†Ø¬ÙˆÙ…</label><select id="comp2Stars">
                            <option value="0">â­ +30%</option>
                            <option value="1">â­â­ +70%</option>
                            <option value="2">â­â­â­ +120%</option>
                            <option value="3">â­â­â­â­ +185%</option>
                            <option value="4">â­â­â­â­â­ +270%</option>
                        </select></div>
                </div>
                <button class="btn-lg btn-primary" onclick="compareUnits()">ğŸ” Ù‚Ø§Ø±Ù† Ø§Ù„Ø¢Ù†</button>
                <div id="compareResults"></div>
            </div>

            <div id="saved" class="tab-content">
                <div class="card">
                    <h2>ğŸ’¾ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h2>
                    <div id="savedList"></div>
                </div>
            </div>

            <div id="charts" class="tab-content">
                <div class="card">
                    <h2>ğŸ“Š Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h2>
                    <div class="chart-wrapper"><canvas id="skillChart"></canvas></div>
                </div>
                <div class="card">
                    <h2>ğŸ“ˆ Ù…Ù†Ø­Ù†Ù‰ Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª</h2>
                    <div class="chart-wrapper"><canvas id="upgradeChart"></canvas></div>
                </div>
            </div>

            <div id="heroes" class="tab-content">
                <div class="card">
                    <h2>ğŸ¦¸ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</h2>
                    <div class="input-group">
                        <input type="text" id="heroSearch" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¨Ø·Ù„..." oninput="filterHeroes()">
                    </div>
                    <div class="stats-grid" style="margin-bottom:12px;">
                        <div>
                            <select id="heroFilterType" onchange="filterHeroes()"
                                style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--bg-body);color:var(--text);font-family:Tajawal;">
                                <option value="all">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                                <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©</option>
                                <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø©</option>
                                <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ®</option>
                            </select>
                        </div>
                        <div>
                            <select id="heroFilterRarity" onchange="filterHeroes()"
                                style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--bg-body);color:var(--text);font-family:Tajawal;">
                                <option value="all">ÙƒÙ„ Ø§Ù„Ù†Ø¯Ø±Ø§Øª</option>
                                <option value="UR">ğŸŸ  UR (Ø£Ø³Ø·ÙˆØ±ÙŠ)</option>
                                <option value="SSR">ğŸŸ£ SSR (Ù…Ù„Ø­Ù…ÙŠ)</option>
                                <option value="SR">ğŸ”µ SR (Ù†Ø§Ø¯Ø±)</option>
                            </select>
                        </div>
                    </div>
                    <div id="heroList"></div>
                </div>
            </div>

            <!-- Tier List Tab -->
            <div id="tierlist" class="tab-content">
                <div class="card">
                    <h2>ğŸ† Tier List â€” ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</h2>
                    <p style="font-size:.82rem;color:var(--text-sub);margin-bottom:16px;">Ù…Ø¨Ù†ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙŠØªØ§ Ø§Ù„Ø­Ø§Ù„ÙŠØ© â€”
                        Ù…ØµØ¯Ø±: lastwarhandbook.com</p>
                    <div id="tierListContent"></div>
                </div>
            </div>

            <!-- Team Builder Tab -->
            <div id="teambuilder" class="tab-content">
                <div class="card">
                    <h2>ğŸ‘¥ Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙØ±ÙŠÙ‚</h2>
                    <p style="font-size:.82rem;color:var(--text-sub);margin-bottom:12px;">Ø§Ø®ØªØ± 5 Ø£Ø¨Ø·Ø§Ù„ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨ÙˆÙ†Øµ
                        ÙˆØ§Ù„ØªÙˆØ§ÙÙ‚</p>
                    <div class="stats-grid" style="margin-bottom:12px;">
                        <div>
                            <select id="tbFilter" onchange="renderTeamBuilderList()"
                                style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--bg-body);color:var(--text);font-family:Tajawal;">
                                <option value="all">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                                <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©</option>
                                <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø©</option>
                                <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ®</option>
                            </select>
                        </div>
                        <div>
                            <button class="btn-lg btn-primary" onclick="clearTeam()" style="width:100%;margin:0;">ğŸ—‘ï¸
                                Ù…Ø³Ø­ Ø§Ù„ÙØ±ÙŠÙ‚</button>
                        </div>
                    </div>
                    <div style="margin-bottom:16px;">
                        <h3 style="margin-bottom:8px;">ÙØ±ÙŠÙ‚Ùƒ (<span id="teamCount">0</span>/5)</h3>
                        <div id="teamSlots" style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;"></div>
                    </div>
                    <div id="teamAnalysis"></div>
                    <div style="margin-top:16px;">
                        <h3 style="margin-bottom:8px;">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</h3>
                        <div id="tbHeroList"></div>
                    </div>
                </div>
                <div class="card">
                    <h2>â­ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§ (Meta)</h2>
                    <div id="metaTeams"></div>
                </div>
            </div>

            <div id="tools" class="tab-content">
                <div class="card">
                    <h2>ğŸ“Š Ø­Ø§Ø³Ø¨Ø© EXP Ø§Ù„Ø¨Ø·Ù„</h2>
                    <p style="font-size:.82rem;color:var(--text-sub);margin-bottom:12px;">Ø§Ø­Ø³Ø¨ ÙƒÙ…ÙŠØ© Ø§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ù„Ø§Ø²Ù…Ø©
                        Ù„ØªØ±Ù‚ÙŠØ© Ø¨Ø·Ù„Ùƒ (Ø­ØªÙ‰ Ù…Ø³ØªÙˆÙ‰ 175)</p>
                    <div class="stats-grid">
                        <div class="input-group" style="margin:0;">
                            <label>Ù…Ù† Ù…Ø³ØªÙˆÙ‰</label>
                            <input type="number" id="expFrom" value="1" min="1" max="174" inputmode="numeric">
                        </div>
                        <div class="input-group" style="margin:0;">
                            <label>Ø¥Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰</label>
                            <input type="number" id="expTo" value="60" min="2" max="175" inputmode="numeric">
                        </div>
                    </div>
                    <button class="btn-lg btn-primary" onclick="calculateEXP()" style="margin-top:12px;">ğŸ“Š Ø§Ø­Ø³Ø¨
                        EXP</button>
                    <div id="expResults"></div>
                </div>

                <div class="card">
                    <h2>ğŸ–ï¸ Ø­Ø§Ø³Ø¨Ø© Ù…ÙŠØ¯Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h2>
                    <p style="font-size:.82rem;color:var(--text-sub);margin-bottom:12px;">Ø§Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙŠØ¯Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                        Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</p>
                    <div class="input-group">
                        <label>Ù†Ø¯Ø±Ø© Ø§Ù„Ø¨Ø·Ù„</label>
                        <div style="display:flex;gap:8px;">
                            <button class="select-item selected" onclick="selectMedalRarity('UR',this)"
                                style="flex:1;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--bg-card);color:var(--text);cursor:pointer;font-family:Tajawal;">ğŸŸ 
                                UR</button>
                            <button class="select-item" onclick="selectMedalRarity('SSR',this)"
                                style="flex:1;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--bg-card);color:var(--text);cursor:pointer;font-family:Tajawal;">ğŸŸ£
                                SSR</button>
                            <button class="select-item" onclick="selectMedalRarity('SR',this)"
                                style="flex:1;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--bg-card);color:var(--text);cursor:pointer;font-family:Tajawal;">ğŸ”µ
                                SR</button>
                        </div>
                    </div>
                    <div class="stats-grid">
                        <div class="input-group" style="margin:0;">
                            <label>Ù…Ù† Ù…Ø³ØªÙˆÙ‰ Ù…Ù‡Ø§Ø±Ø©</label>
                            <input type="number" id="medalFrom" value="1" min="1" max="39" inputmode="numeric">
                        </div>
                        <div class="input-group" style="margin:0;">
                            <label>Ø¥Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ù…Ù‡Ø§Ø±Ø©</label>
                            <input type="number" id="medalTo" value="30" min="2" max="40" inputmode="numeric">
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</label>
                        <input type="number" id="medalSkillCount" value="1" min="1" max="4" inputmode="numeric">
                    </div>
                    <button class="btn-lg btn-primary" onclick="calculateMedals()" style="margin-top:8px;">ğŸ–ï¸ Ø§Ø­Ø³Ø¨
                        Ø§Ù„Ù…ÙŠØ¯Ø§Ù„ÙŠØ§Øª</button>
                    <div id="medalResults"></div>
                </div>

                <div class="card">
                    <h2>ğŸ’ Ø­Ø§Ø³Ø¨Ø© Ø´Ø¸Ø§ÙŠØ§ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</h2>
                    <p style="font-size:.82rem;color:var(--text-sub);margin-bottom:12px;">Ø§Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø¸Ø§ÙŠØ§ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                        Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù†Ø¬ÙˆÙ…</p>
                    <div class="stats-grid">
                        <div class="input-group" style="margin:0;">
                            <label>Ù…Ù† Ù†Ø¬Ù…Ø©</label>
                            <select id="shardFrom"
                                style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--bg-body);color:var(--text);font-family:Tajawal;">
                                <option value="0">0 (Ø¨Ø¯ÙˆÙ†)</option>
                                <option value="1">â­ 1</option>
                                <option value="2">â­â­ 2</option>
                                <option value="3">â­â­â­ 3</option>
                                <option value="4">â­â­â­â­ 4</option>
                            </select>
                        </div>
                        <div class="input-group" style="margin:0;">
                            <label>Ø¥Ù„Ù‰ Ù†Ø¬Ù…Ø©</label>
                            <select id="shardTo"
                                style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--bg-body);color:var(--text);font-family:Tajawal;">
                                <option value="1">â­ 1</option>
                                <option value="2">â­â­ 2</option>
                                <option value="3">â­â­â­ 3</option>
                                <option value="4">â­â­â­â­ 4</option>
                                <option value="5" selected>â­â­â­â­â­ 5</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn-lg btn-primary" onclick="calculateShards()" style="margin-top:12px;">ğŸ’ Ø§Ø­Ø³Ø¨
                        Ø§Ù„Ø´Ø¸Ø§ÙŠØ§</button>
                    <div id="shardResults"></div>
                </div>

                <div class="card">
                    <h2>ğŸ¥ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø´ÙØ§Ø¡</h2>
                    <p style="font-size:.82rem;color:var(--text-sub);margin-bottom:12px;">Ø§Ø­Ø³Ø¨ Ø³Ø¹Ø© Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ ÙˆØ§Ù„ÙˆÙ‚Øª
                        Ø§Ù„Ù„Ø§Ø²Ù… Ù„Ù„Ø´ÙØ§Ø¡</p>
                    <div class="stats-grid">
                        <div class="input-group" style="margin:0;">
                            <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ù†ÙˆØ¯ Ø§Ù„Ù…ØµØ§Ø¨ÙŠÙ†</label>
                            <input type="text" id="healWounded" value="50000" inputmode="numeric">
                        </div>
                        <div class="input-group" style="margin:0;">
                            <label>Ø³Ø¹Ø© Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰</label>
                            <input type="text" id="healCapacity" value="20000" inputmode="numeric">
                        </div>
                    </div>
                    <div class="stats-grid">
                        <div class="input-group" style="margin:0;">
                            <label>ÙˆÙ‚Øª Ø§Ù„Ø´ÙØ§Ø¡/Ø¬Ù†Ø¯ÙŠ (Ø«Ø§Ù†ÙŠØ©)</label>
                            <input type="number" id="healTime" value="5" min="1" inputmode="numeric">
                        </div>
                        <div class="input-group" style="margin:0;">
                            <label>Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø­Ù„Ù (ØªÙ‚Ù„ÙŠÙ„ %)</label>
                            <input type="number" id="healAllianceHelp" value="20" min="0" max="50" inputmode="numeric">
                        </div>
                    </div>
                    <button class="btn-lg btn-primary" onclick="calculateHealing()" style="margin-top:8px;">ğŸ¥ Ø§Ø­Ø³Ø¨
                        Ø§Ù„Ø´ÙØ§Ø¡</button>
                    <div id="healResults"></div>
                </div>

                <div class="card">
                    <h2>ğŸ“‹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©</h2>
                    <div style="font-size:.82rem;line-height:1.8;">
                        <div style="font-weight:700;color:var(--primary);margin-bottom:8px;">ğŸ›¡ï¸ Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø¯ÙØ§Ø¹ (Ù…ÙØ«Ø¨ØªØ©)
                        </div>
                        <div
                            style="padding:10px;background:var(--bg-body);border-radius:10px;font-family:monospace;text-align:center;margin-bottom:12px;direction:ltr;">
                            Damage = ATK Ã— 4000 / (DEF + 4000)
                        </div>
                        <div style="font-weight:700;color:var(--primary);margin-bottom:8px;">â¤ï¸ Ø§Ù„ØµØ­Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©</div>
                        <div
                            style="padding:10px;background:var(--bg-body);border-radius:10px;font-family:monospace;text-align:center;margin-bottom:12px;direction:ltr;">
                            EHP = HP Ã— (DEF + 4000) / 4000
                        </div>
                        <div style="font-weight:700;color:var(--primary);margin-bottom:8px;">âš”ï¸ Ø£ÙØ¶Ù„ÙŠØ© Ø§Ù„Ù†ÙˆØ¹</div>
                        <div style="padding:10px;background:var(--bg-body);border-radius:10px;margin-bottom:12px;">
                            ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø© â†’ ğŸš€ ØµØ§Ø±ÙˆØ® â†’ âœˆï¸ Ø·Ø§Ø¦Ø±Ø© â†’ ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©<br>
                            <span style="color:var(--success);">+20% Ø¶Ø±Ø±</span> Ø¶Ø¯ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¶Ø¹Ù | <span
                                style="color:var(--danger);">-20%</span> Ø¶Ø¯ Ø§Ù„Ø£Ù‚ÙˆÙ‰
                        </div>
                        <div style="font-weight:700;color:var(--primary);margin-bottom:8px;">ğŸ‘¥ Ø¨ÙˆÙ†Øµ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©</div>
                        <div style="padding:10px;background:var(--bg-body);border-radius:10px;">
                            3 Ù†ÙØ³ Ø§Ù„Ù†ÙˆØ¹ = +5% | 3+2 = +10% | 4 = +15% | 5 = +20%
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="footer">
            <img src="https://i.pinimg.com/736x/d0/f6/36/d0f636b1d0308c95b4ffcc75c3df88bc.jpg" alt="Jiraiya"
                class="footer-avatar">
            <h3>DistopÇa - 1930</h3>
            <p>ğŸ® Master Tactician</p>
            <p>âš”ï¸ Last War: Survival Game</p>
            <p style="margin-top:10px;opacity:.7;">"Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ØªØ£ØªÙŠ Ù…Ù† Ø§Ù„ØªØ®Ø·ÙŠØ· ÙˆØ§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©"</p>
        </div>

        <script>
            /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„Ø£Ø®ÙŠØ±Ø© Pro Max - v5.1
               Built by DistopÇa
               Data verified from: Reddit, Fandom, BlueStacks,
               allclash.com, lastwargame.online, medievalfun.com,
               lastwarhandbook.com
               â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

            // â”€â”€ Game Constants â”€â”€
            const STAR_BONUS = [0.30, 0.70, 1.20, 1.85, 2.70]; // ØªÙ‚Ø±ÙŠØ¨ÙŠ
            const SKILL_MULTIPLIER = [1.0, 3.45, 4.05]; // ØªÙ‚Ø±ÙŠØ¨ÙŠ â€” ÙŠØ®ØªÙ„Ù Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø·Ù„
            const SKILL_NAMES = ['Ø¹Ø§Ø¯ÙŠØ© âš”ï¸', 'Ø®Ø§ØµØ© ğŸ”¥', 'Ù†Ù‡Ø§Ø¦ÙŠØ© ğŸ’¥'];
            const TYPE_NAMES = { tank: 'ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©', plane: 'âœˆï¸ Ø·Ø§Ø¦Ø±Ø©', missile: 'ğŸš€ ØµØ§Ø±ÙˆØ®' };
            const TYPE_ADVANTAGE = { tank: 'missile', missile: 'plane', plane: 'tank' };
            const LINEUP_BONUS = [0, 0.05, 0.10, 0.15, 0.20];
            const DEF_CONSTANT = 4000;

            // â”€â”€ Hero Shard Costs (verified from Reddit/community) â”€â”€
            const SHARD_COSTS = [25, 50, 100, 300, 500]; // per star (1â˜…-5â˜…), total = 975

            // â”€â”€ Hero EXP Table (verified from Fandom wiki + lastwarhandbook.com) â”€â”€
            // Index = level-1, value = EXP needed to go FROM that level to next
            const HERO_EXP = [
                0, 100, 200, 300, 400, 500, 600, 700, 800, 900,                          // 1-10
                1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900,              // 11-20
                2000, 2200, 2300, 2700, 3200, 3900, 4600, 5500, 6600, 8000,              // 21-30
                9500, 12000, 14000, 17000, 20000, 24000, 29000, 35000, 41000, 49000,     // 31-40
                59000, 71000, 85000, 110000, 130000, 150000, 180000, 220000, 260000, 310000, // 41-50
                370000, 440000, 530000, 630000, 760000, 910000, 1100000, 1400000, 1600000, 1900000, // 51-60
                2100000, 2300000, 2500000, 2800000, 3100000, 3400000, 3700000, 4100000, 4500000, 4900000, // 61-70
                5400000, 5900000, 6500000, 7200000, 7900000, 8700000, 9500000, 11000000, 12000000, 13000000, // 71-80
                13000000, 14000000, 14000000, 15000000, 16000000, 17000000, 17000000, // 81-87
                // Levels 88-175 â€” estimated scaling from community data
                18000000, 19000000, 20000000, 21000000, 22000000, 24000000, 26000000, 28000000, 30000000, 32000000, 35000000, 38000000, 41000000, // 88-100
                44000000, 47000000, 50000000, 54000000, 58000000, 62000000, 66000000, 70000000, 75000000, 80000000, // 101-110
                85000000, 90000000, 95000000, 100000000, 105000000, 110000000, 116000000, 122000000, 128000000, 135000000, // 111-120
                142000000, 149000000, 157000000, 165000000, 173000000, 181000000, 190000000, 199000000, 208000000, 218000000, // 121-130
                228000000, 239000000, 250000000, 261000000, 273000000, 285000000, 298000000, 311000000, 325000000, 339000000, // 131-140
                354000000, 369000000, 385000000, 401000000, 418000000, 435000000, 453000000, 472000000, 491000000, 511000000, // 141-150
                532000000, 554000000, 576000000, 599000000, 623000000, 648000000, 674000000, 700000000, 728000000, 756000000, // 151-160
                786000000, 816000000, 848000000, 881000000, 916000000, 952000000, 989000000, 1028000000, 1068000000, 1110000000, // 161-170
                1154000000, 1200000000, 1247000000, 1296000000, 1348000000 // 171-175
            ];

            // â”€â”€ HQ Level Caps (verified from lastwarhandbook.com) â”€â”€
            const HQ_CAPS = {
                5: 1, 10: 2, 15: 3, 20: 4, 25: 5, 30: 6, 35: 7, 40: 8, 45: 9, 50: 10,
                55: 11, 60: 12, 65: 13, 70: 14, 75: 15, 80: 16, 85: 17, 90: 18, 95: 19, 100: 20,
                105: 21, 110: 22, 115: 23, 120: 24, 125: 25, 130: 26, 135: 27, 140: 28, 145: 29, 150: 30,
                155: 31, 160: 32, 165: 33, 170: 34, 175: 35
            };

            // â”€â”€ Skill Medal Costs per Level (UR base, verified from lastwarhandbook.com) â”€â”€
            // SSR = UR Ã— 0.9, SR = UR Ã— 0.74
            const MEDAL_COSTS_UR = [
                0, 200, 400, 600, 800, 1000, 1400, 1800, 2200, 2600,    // 1â†’2 through 10â†’11
                3200, 3800, 4400, 5000, 5800, 6600, 7600, 8600, 9800, 11000, // 11â†’12 through 20â†’21
                12400, 13800, 15400, 17200, 19000, 21000, 23200, 25600, 28200, 26000, // 21â†’22 through 30â†’31
                28000, 30000, 32000, 34000, 36000, 38000, 40000, 42000, 44000 // 31â†’32 through 39â†’40
            ];
            const MEDAL_RATIO = { UR: 1.0, SSR: 0.9, SR: 0.74 };

            // â”€â”€ Tier List Data (from lastwarhandbook.com) â”€â”€
            const TIER_LIST = {
                'SS': ['Fiona'],
                'S': ['Kimberly', 'DVA', 'Tesla', 'Williams', 'Marshall', 'Stetmann'],
                'A': ['Murphy', 'Carlie', 'Schuyler', 'Lucius', 'Morrison', 'McGregor'],
                'B': ['Adam', 'Swift', 'Mason', 'Violet', 'Scarlett'],
                'C': ['Jackson', 'Emma', 'Lily', 'Noah', 'Sophia', 'Ethan', 'Ava', 'Lucas', 'Isabella'],
                'D': []
            };
            const TIER_COLORS = { 'SS': '#ff4444', 'S': '#ff8800', 'A': '#44bb44', 'B': '#4488ff', 'C': '#aa77cc', 'D': '#888888' };

            // â”€â”€ Meta Teams â”€â”€
            const META_TEAMS = [
                { name: 'ğŸŸ« ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¨Ø§Ø¨Ø§Øª Ø§Ù„Ù…ÙŠØªØ§', heroes: ['Williams', 'Murphy', 'Kimberly', 'Tesla', 'Stetmann'], desc: 'Ø£Ù‚ÙˆÙ‰ ØªØ´ÙƒÙŠÙ„Ø© Ø¯ÙØ§Ø¹ÙŠØ© â€” Williams Ù„Ù„Ø­Ù…Ø§ÙŠØ© + Kimberly/Tesla Ù„Ù„Ø¶Ø±Ø±' },
                { name: 'âœˆï¸ ÙØ±ÙŠÙ‚ Ø§Ù„Ø·Ø§Ø¦Ø±Ø§Øª Ø§Ù„Ù…ÙŠØªØ§', heroes: ['Carlie', 'Lucius', 'Schuyler', 'DVA', 'Morrison'], desc: 'Ø£Ù‚ÙˆÙ‰ Ø¶Ø±Ø± Ø§Ù†ÙØ¬Ø§Ø±ÙŠ â€” DVA/Schuyler Ù„Ù„Ù€ burst + Carlie/Lucius Ù„Ù„Ø­Ù…Ø§ÙŠØ©' },
                { name: 'ğŸš€ ÙØ±ÙŠÙ‚ Ø§Ù„ØµÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠØªØ§', heroes: ['Fiona', 'Tesla', 'Adam', 'McGregor', 'Swift'], desc: 'Ø£Ù‚ÙˆÙ‰ Ø¶Ø±Ø± Ù…Ø³Ø§Ø­ÙŠ â€” Fiona SS-tier nuker + Tesla Ù„Ù„Ø·Ø§Ù‚Ø©' },
            ];

            // â”€â”€ Hero Database (verified from lastwarhandbook.com + lastwargame.online) â”€â”€
            const IMG_BASE = 'https://www.lastwargame.online/wp-content/uploads/2026/01/';
            const HEROES = [
                // UR Heroes (17 â€” includes Stetmann, Morrison, Swift upgraded)
                { name: 'Fiona', nameAr: 'ÙÙŠÙˆÙ†Ø§', title: 'Lion Cub', type: 'missile', role: 'attack', rarity: 'UR', dmg: 'physical', desc: 'AoE Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù â€” SS-tier nuker', img: IMG_BASE + 'fiona_icon.webp' },
                { name: 'Kimberly', nameAr: 'ÙƒÙŠÙ…Ø¨Ø±Ù„ÙŠ', title: 'Rocket Shadow', type: 'tank', role: 'attack', rarity: 'UR', dmg: 'energy', desc: 'AoE Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¶Ø±Ø± â€” S-tier', img: IMG_BASE + 'kimberly_icon.webp' },
                { name: 'DVA', nameAr: 'Ø¯ÙŠÙØ§', title: 'Sky Reaver', type: 'plane', role: 'attack', rarity: 'UR', dmg: 'energy', desc: 'Ø¶Ø±Ø± Ø§Ù†ÙØ¬Ø§Ø±ÙŠ + Ø³Ø±Ø¹Ø© Ù‡Ø¬ÙˆÙ… â€” S-tier', img: IMG_BASE + 'dva_icon.webp' },
                { name: 'Tesla', nameAr: 'ØªÙŠØ³Ù„Ø§', title: 'Magnetic Expert', type: 'missile', role: 'attack', rarity: 'UR', dmg: 'energy', desc: 'Ø¶Ø±Ø± Ø·Ø§Ù‚Ø© + Ø­Ø±Ø¬Ø§Øª Ø¹Ø§Ù„ÙŠØ© â€” S-tier', img: IMG_BASE + 'tesla_icon.webp' },
                { name: 'Williams', nameAr: 'ÙˆÙŠÙ„ÙŠØ§Ù…Ø²', title: 'Storm Hunter', type: 'tank', role: 'defense', rarity: 'UR', dmg: 'physical', desc: 'ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø± Ø§Ù„ÙØ±ÙŠÙ‚ â€” S-tier', img: IMG_BASE + 'williams_icon.webp' },
                { name: 'Marshall', nameAr: 'Ù…Ø§Ø±Ø´Ø§Ù„', title: 'Blade of Legion', type: 'tank', role: 'support', rarity: 'UR', dmg: 'energy', desc: 'Ø¯Ø¹Ù… Ø´Ø§Ù…Ù„ + ØªØ¹Ø²ÙŠØ² Ù‡Ø¬ÙˆÙ… â€” S-tier', img: IMG_BASE + 'marshall_icon.webp' },
                { name: 'Stetmann', nameAr: 'Ø³ØªÙŠØªÙ…Ø§Ù†', title: 'EM Hunter', type: 'tank', role: 'attack', rarity: 'UR', dmg: 'energy', desc: 'Ø¶Ø±Ø± ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ Ù…Ø³ØªÙ…Ø± â€” S-tier', img: IMG_BASE + 'stetmann_icon.webp' },
                { name: 'Murphy', nameAr: 'Ù…ÙŠØ±ÙÙŠ', title: 'Unyielding Warrior', type: 'tank', role: 'defense', rarity: 'UR', dmg: 'physical', desc: 'Ø¯Ø¨Ø§Ø¨Ø© Ø¯ÙØ§Ø¹ÙŠØ© Ù‚ÙˆÙŠØ© â€” A-tier', img: IMG_BASE + 'merfi.webp' },
                { name: 'Carlie', nameAr: 'ÙƒØ§Ø±Ù„ÙŠ', title: 'Scamp', type: 'plane', role: 'defense', rarity: 'UR', dmg: 'physical', desc: 'ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø± Ø§Ù„Ø·Ø§Ù‚Ø© â€” A-tier', img: IMG_BASE + 'carlie_icon.webp' },
                { name: 'Schuyler', nameAr: 'Ø´ÙˆÙŠÙ„Ø±', title: 'Magblade', type: 'plane', role: 'attack', rarity: 'UR', dmg: 'energy', desc: 'ØµØ¹Ù‚ + Ø´Ù„Ù„ + AoE â€” A-tier', img: IMG_BASE + 'schuyler_icon.webp' },
                { name: 'Lucius', nameAr: 'Ù„ÙˆØ³ÙŠÙˆØ³', title: 'Sky Knight', type: 'plane', role: 'defense', rarity: 'UR', dmg: 'physical', desc: 'ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø± Ø§Ù„ØµÙ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ â€” A-tier', img: IMG_BASE + 'lucius_icon.webp' },
                { name: 'Morrison', nameAr: 'Ù…ÙˆØ±ÙŠØ³ÙˆÙ†', title: 'The Reaper', type: 'plane', role: 'attack', rarity: 'UR', dmg: 'physical', desc: 'Ø¶Ø±Ø± Ø§Ù†ÙØ¬Ø§Ø±ÙŠ + ØªÙ‚Ù„ÙŠÙ„ Ø¯ÙØ§Ø¹ â€” A-tier', img: IMG_BASE + 'morrison_icon.webp' },
                { name: 'McGregor', nameAr: 'Ù…Ø§ÙƒØºØ±ÙŠØºÙˆØ±', title: 'Ironclad General', type: 'missile', role: 'defense', rarity: 'UR', dmg: 'physical', desc: 'Ø§Ø³ØªÙØ²Ø§Ø² + Ø­Ù…Ø§ÙŠØ© â€” A-tier', img: IMG_BASE + 'mcgregor_icon.webp' },
                { name: 'Swift', nameAr: 'Ø³ÙˆÙŠÙØª', title: 'Thunder', type: 'missile', role: 'attack', rarity: 'UR', dmg: 'physical', desc: 'Ø¥Ø¹Ø¯Ø§Ù… Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ Ø¶Ø¹Ø§Ù HP â€” B-tier', img: IMG_BASE + 'swift_icon.webp' },
                { name: 'Adam', nameAr: 'Ø¢Ø¯Ù…', title: 'Titan', type: 'missile', role: 'defense', rarity: 'UR', dmg: 'physical', desc: 'Ù‡Ø¬ÙˆÙ… Ù…Ø¶Ø§Ø¯ + ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø± â€” B-tier', img: IMG_BASE + 'adam_icon.webp' },
                { name: 'Mason', nameAr: 'Ù…ÙŠØ³ÙˆÙ†', title: 'Zombie Bane', type: 'tank', role: 'attack', rarity: 'UR', dmg: 'physical', desc: 'AoE + ØªØ¹Ø²ÙŠØ² Ø¶Ø¯ Ø§Ù„ÙˆØ­ÙˆØ´ â€” B-tier', img: '' },
                { name: 'Violet', nameAr: 'ÙÙŠÙˆÙ„ÙŠØª', title: 'Frost Guard', type: 'tank', role: 'defense', rarity: 'UR', dmg: 'physical', desc: 'Ø¯Ø±Ø¹ Ø¬Ù„ÙŠØ¯ + Ø¥Ø¶Ø¹Ø§Ù â€” B-tier', img: '' },
                { name: 'Scarlett', nameAr: 'Ø³ÙƒØ§Ø±Ù„ÙŠØª', title: 'Iron Rose', type: 'tank', role: 'defense', rarity: 'UR', dmg: 'physical', desc: 'ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø± + Ø²ÙŠØ§Ø¯Ø© Ø¯ÙØ§Ø¹ â€” B-tier', img: '' },
                // SSR Heroes (11 â€” removed Morrison/Swift/Stetmann duplicates)
                { name: 'Helena', nameAr: 'Ù‡ÙŠÙ„ÙŠÙ†Ø§', title: 'Healer', type: 'tank', role: 'support', rarity: 'SSR', dmg: 'energy', desc: 'Ø¯Ø¹Ù… + Ø´ÙØ§Ø¡ â€” Meta hero', img: '' },
                { name: 'Marcus', nameAr: 'Ù…Ø§Ø±ÙƒÙˆØ³', title: 'Warlord', type: 'missile', role: 'attack', rarity: 'SSR', dmg: 'physical', desc: 'Ø¶Ø±Ø± Ù…Ø³Ø§Ø­ÙŠ Ù‚ÙˆÙŠ â€” Meta hero', img: '' },
                { name: 'Monica', nameAr: 'Ù…ÙˆÙ†ÙŠÙƒØ§', title: 'Supplier', type: 'tank', role: 'support', rarity: 'SSR', dmg: 'energy', desc: 'ØªØ¹Ø²ÙŠØ² Ù…ÙˆØ§Ø±Ø¯ + Ø¶Ø±Ø± Ø²ÙˆÙ…Ø¨ÙŠ', img: '' },
                { name: 'Ambolt', nameAr: 'Ø£Ù…Ø¨ÙˆÙ„Øª', title: 'Medic', type: 'plane', role: 'support', rarity: 'SSR', dmg: 'energy', desc: 'Ø´ÙØ§Ø¡ Ø£Ø³Ø§Ø³ÙŠ', img: '' },
                { name: 'Cage', nameAr: 'ÙƒÙŠØ¬', title: 'Shield', type: 'plane', role: 'defense', rarity: 'SSR', dmg: 'physical', desc: 'ØªØ¹Ø²ÙŠØ² Ø¯ÙØ§Ø¹ Ø§Ù„Ø£Ù…Ø§Ù…', img: '' },
                { name: 'Drake', nameAr: 'Ø¯Ø±ÙŠÙƒ', title: 'Fortress', type: 'tank', role: 'defense', rarity: 'SSR', dmg: 'physical', desc: 'Ø¯Ø¨Ø§Ø¨Ø© Ù…ØªÙˆØ³Ø·Ø©', img: '' },
                { name: 'Kane', nameAr: 'ÙƒÙŠÙ†', title: 'Sniper', type: 'missile', role: 'attack', rarity: 'SSR', dmg: 'physical', desc: 'Ø¶Ø±Ø± Ù‡Ø¯Ù ÙˆØ§Ø­Ø¯', img: '' },
                { name: 'Maxwell', nameAr: 'Ù…Ø§ÙƒØ³ÙˆÙŠÙ„', title: 'Shock', type: 'plane', role: 'attack', rarity: 'SSR', dmg: 'physical', desc: 'Ø¶Ø±Ø± ÙÙŠØ²ÙŠØ§Ø¦ÙŠ + ØµØ¹Ù‚', img: '' },
                { name: 'Richard', nameAr: 'Ø±ÙŠØªØ´Ø§Ø±Ø¯', title: 'Vanguard', type: 'tank', role: 'attack', rarity: 'SSR', dmg: 'physical', desc: 'Ø¶Ø±Ø± Ù…ØªØ¹Ø¯Ø¯ Ø£Ù‡Ø¯Ø§Ù', img: '' },
                { name: 'Sarah', nameAr: 'Ø³Ø§Ø±Ø©', title: 'Hunter', type: 'plane', role: 'support', rarity: 'SSR', dmg: 'energy', desc: 'ØªØ¹Ø²ÙŠØ² Ø¶Ø±Ø± ÙˆØ­ÙˆØ´', img: '' },
                { name: 'Venom', nameAr: 'ÙÙŠÙ†ÙˆÙ…', title: 'Toxin', type: 'missile', role: 'attack', rarity: 'SSR', dmg: 'energy', desc: 'Ø¶Ø±Ø± Ø³Ù… Ù…Ø³ØªÙ…Ø±', img: '' },
                // SR Heroes (14)
                { name: 'Farhad', nameAr: 'ÙØ±Ù‡Ø§Ø¯', title: 'Recruit', type: 'tank', role: 'attack', rarity: 'SR', dmg: 'physical', desc: 'Ù…Ù‡Ø§Ø¬Ù… Ø£Ø³Ø§Ø³ÙŠ', img: '' },
                { name: 'Elsa', nameAr: 'Ø¥Ù„Ø³Ø§', title: 'Frost', type: 'tank', role: 'defense', rarity: 'SR', dmg: 'energy', desc: 'Ø¥Ø¨Ø·Ø§Ø¡ + ØªÙ‚Ù„ÙŠÙ„ Ø¶Ø±Ø±', img: '' },
                { name: 'Blaz', nameAr: 'Ø¨Ù„Ø§Ø²', title: 'Flame', type: 'missile', role: 'attack', rarity: 'SR', dmg: 'physical', desc: 'ÙØ¹Ø§Ù„ Ø¶Ø¯ Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ ÙÙ‚Ø·', img: '' },
                { name: 'Gump', nameAr: 'ØºØ§Ù…Ø¨', title: 'Blaze', type: 'tank', role: 'attack', rarity: 'SR', dmg: 'physical', desc: 'Ù‡Ø¬ÙˆÙ… Ù†Ø§Ø±ÙŠ', img: '' },
                { name: 'Loki', nameAr: 'Ù„ÙˆÙƒÙŠ', title: 'Guard', type: 'tank', role: 'defense', rarity: 'SR', dmg: 'physical', desc: 'Ø¯ÙØ§Ø¹ Ø£Ø³Ø§Ø³ÙŠ', img: '' },
                { name: 'Jackson', nameAr: 'Ø¬Ø§ÙƒØ³ÙˆÙ†', title: 'Cadet', type: 'tank', role: 'defense', rarity: 'SR', dmg: 'physical', desc: 'Ø¯Ø¨Ø§Ø¨Ø© Ù…Ø¨ØªØ¯Ø¦Ø© Ø¬ÙŠØ¯Ø©', img: '' },
                { name: 'Noah', nameAr: 'Ù†ÙˆØ­', title: 'Salvager', type: 'tank', role: 'defense', rarity: 'SR', dmg: 'physical', desc: 'Ø¯Ø¨Ø§Ø¨Ø© ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ø±ØªØ¬Ù„Ø©', img: '' },
                { name: 'Lucas', nameAr: 'Ù„ÙˆÙƒØ§Ø³', title: 'Reserve', type: 'tank', role: 'defense', rarity: 'SR', dmg: 'physical', desc: 'Ù…Ø´ØºÙ„ Ø¯Ø¨Ø§Ø¨Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠ', img: '' },
                { name: 'Emma', nameAr: 'Ø¥ÙŠÙ…Ø§', title: 'Researcher', type: 'missile', role: 'attack', rarity: 'SR', dmg: 'energy', desc: 'ØµØ§Ø±ÙˆØ® Ø¨Ø­Ø« Ø£Ø³Ø§Ø³ÙŠ', img: '' },
                { name: 'Ethan', nameAr: 'Ø¥ÙŠØ«Ø§Ù†', title: 'Militia', type: 'missile', role: 'attack', rarity: 'SR', dmg: 'physical', desc: 'ØªØ¯Ø±ÙŠØ¨ ØµØ§Ø±ÙˆØ®ÙŠ Ø£Ø³Ø§Ø³ÙŠ', img: '' },
                { name: 'Isabella', nameAr: 'Ø¥ÙŠØ²Ø§Ø¨ÙŠÙ„Ø§', title: 'Trainee', type: 'missile', role: 'attack', rarity: 'SR', dmg: 'physical', desc: 'Ù…ØªØ¯Ø±Ø¨Ø© Ù…Ø¯ÙØ¹ÙŠØ©', img: '' },
                { name: 'Lily', nameAr: 'Ù„ÙŠÙ„ÙŠ', title: 'Pilot', type: 'plane', role: 'attack', rarity: 'SR', dmg: 'physical', desc: 'Ø·ÙŠØ§Ø±Ø© Ù…ØªØ¯Ø±Ø¨Ø©', img: '' },
                { name: 'Sophia', nameAr: 'ØµÙˆÙÙŠØ§', title: 'Medivac', type: 'plane', role: 'support', rarity: 'SR', dmg: 'energy', desc: 'Ø¯Ø¹Ù… Ø·Ø¨ÙŠ Ø¬ÙˆÙŠ', img: '' },
                { name: 'Ava', nameAr: 'Ø¢ÙØ§', title: 'Scout', type: 'plane', role: 'attack', rarity: 'SR', dmg: 'physical', desc: 'Ø·Ø§Ø¦Ø±Ø© Ø§Ø³ØªØ·Ù„Ø§Ø¹', img: '' },
            ];

            const ROLE_NAMES = { attack: 'âš”ï¸ Ù…Ù‡Ø§Ø¬Ù…', defense: 'ğŸ›¡ï¸ Ù…Ø¯Ø§ÙØ¹', support: 'ğŸ’Š Ø¯Ø¹Ù…' };
            const RARITY_COLORS = { UR: '#f6ad55', SSR: '#b794f4', SR: '#63b3ed' };
            const DMG_ICONS = { physical: 'ğŸ’¥', energy: 'âš¡' };

            // â”€â”€ State â”€â”€
            let selectedStars = 0;
            let selectedSkill = 0;
            let selectedLineup = 1;
            let selectedMedalRarity = 'UR';
            let teamSlots = [];
            let battleChart = null;
            let skillChartInstance = null;
            let upgradeChartInstance = null;

            // â”€â”€ Utility: Parse shorthand values like 65.2K, 1.4M, 2B â”€â”€
            function parseValue(str) {
                if (!str) return 0;
                str = String(str).trim().toUpperCase().replace(/,/g, '').replace(/\s/g, '');
                const multipliers = { K: 1e3, M: 1e6, B: 1e9, T: 1e12 };
                const match = str.match(/^([\d.]+)\s*([KMBT]?)$/i);
                if (match) {
                    const num = parseFloat(match[1]);
                    const suffix = match[2].toUpperCase();
                    return suffix ? num * (multipliers[suffix] || 1) : num;
                }
                return parseFloat(str) || 0;
            }

            // â”€â”€ Format number with commas â”€â”€
            function formatNumber(n) {
                if (n >= 1e9) return (n / 1e9).toFixed(2) + 'B';
                if (n >= 1e6) return (n / 1e6).toFixed(2) + 'M';
                if (n >= 1e3) return n.toLocaleString('en-US');
                return Math.round(n).toLocaleString('en-US');
            }

            // â”€â”€ Tab Switching â”€â”€
            function switchTab(tabId) {
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');

                const tabs = document.querySelectorAll('.tab');
                const tabMap = ['calculator', 'compare', 'heroes', 'tierlist', 'teambuilder', 'tools', 'saved', 'charts'];
                const idx = tabMap.indexOf(tabId);
                if (idx >= 0) tabs[idx].classList.add('active');

                if (tabId === 'saved') loadSavedList();
                if (tabId === 'charts') initCharts();
                if (tabId === 'heroes') renderHeroes();
                if (tabId === 'tierlist') renderTierList();
                if (tabId === 'teambuilder') { renderTeamBuilderList(); renderTeamSlots(); renderMetaTeams(); }
            }

            // â”€â”€ Theme Toggle â”€â”€
            function toggleTheme() {
                const body = document.body;
                const isDark = body.getAttribute('data-theme') === 'dark';
                body.setAttribute('data-theme', isDark ? '' : 'dark');
                document.querySelector('.theme-toggle').textContent = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
                localStorage.setItem('theme', isDark ? 'light' : 'dark');
            }

            // Load saved theme
            (function () {
                const saved = localStorage.getItem('theme');
                if (saved === 'dark') {
                    document.body.setAttribute('data-theme', 'dark');
                    document.querySelector('.theme-toggle').textContent = 'â˜€ï¸';
                }
            })();

            // â”€â”€ Star Selection â”€â”€
            function selectStars(index, el) {
                selectedStars = index;
                const parent = el.parentElement;
                parent.querySelectorAll('.select-item').forEach(i => i.classList.remove('selected'));
                el.classList.add('selected');
                updatePreview();
            }

            // â”€â”€ Skill Selection â”€â”€
            function selectSkill(index, el) {
                selectedSkill = index;
                const parent = el.parentElement;
                parent.querySelectorAll('.select-item').forEach(i => i.classList.remove('selected'));
                el.classList.add('selected');
                updatePreview();
            }

            // â”€â”€ Lineup Selection â”€â”€
            function selectLineup(index, el) {
                selectedLineup = index;
                // Deselect all lineup items across both grids
                document.querySelectorAll('.card:has(#morale) .select-item').forEach(i => i.classList.remove('selected'));
                el.classList.add('selected');
                updatePreview();
            }

            // â”€â”€ Update Preview Values â”€â”€
            function updatePreview() {
                const attack = parseValue(document.getElementById('attack').value);
                const health = parseValue(document.getElementById('health').value);
                const critChance = parseFloat(document.getElementById('critChance').value) || 0;
                const critDamage = parseFloat(document.getElementById('critDamage').value) || 0;
                const morale = parseFloat(document.getElementById('morale').value) || 100;

                document.getElementById('attackValue').textContent = formatNumber(attack);
                document.getElementById('healthValue').textContent = formatNumber(health);
                document.getElementById('critFreq').textContent = critChance > 0 ? Math.round(100 / critChance) : 'âˆ';
                document.getElementById('critMulti').textContent = 'Ã—' + (critDamage / 100).toFixed(1);
                document.getElementById('moraleMulti').textContent = 'Ã—' + (morale / 100).toFixed(2);

                // Type advantage preview
                const atkType = document.getElementById('attackerType').value;
                const defType = document.getElementById('defenderType').value;
                const preview = document.getElementById('typeAdvantagePreview');

                if (TYPE_ADVANTAGE[atkType] === defType) {
                    preview.innerHTML = '<div class="type-badge advantage">âœ… Ø£ÙØ¶Ù„ÙŠØ© Ù†ÙˆØ¹! +20% Ø¶Ø±Ø±</div>';
                } else if (TYPE_ADVANTAGE[defType] === atkType) {
                    preview.innerHTML = '<div class="type-badge disadvantage">âŒ Ø¹ÙŠØ¨ Ù†ÙˆØ¹! -20% Ø¶Ø±Ø±</div>';
                } else {
                    preview.innerHTML = '<div class="type-badge neutral">âš–ï¸ ØªØ¹Ø§Ø¯Ù„ ÙÙŠ Ø§Ù„Ù†ÙˆØ¹</div>';
                }
            }

            // â”€â”€ Get Type Advantage Multiplier â”€â”€
            function getTypeMultiplier(atkType, defType) {
                if (TYPE_ADVANTAGE[atkType] === defType) return 1.20;
                if (TYPE_ADVANTAGE[defType] === atkType) return 0.80;
                return 1.0;
            }

            // â”€â”€ Damage Calculation (community-verified formula) â”€â”€
            // Formula: ATK Ã— 4000/(DEF+4000) Ã— starBonus Ã— skillMult Ã— typeMult Ã— (1-DR) Ã— lineupBonus Ã— morale
            function calculateDamage(attack, defense, starLevel, skillLevel, atkType, defType, resistance, critChance, critDamage, lineupLevel, morale) {
                // Defense formula: ATK Ã— 4000 / (DEF + 4000)
                const defReduction = DEF_CONSTANT / (defense + DEF_CONSTANT);
                const baseDmg = attack * defReduction;
                const starBonus = 1 + STAR_BONUS[starLevel];
                const skillMult = SKILL_MULTIPLIER[skillLevel];
                const typeMult = getTypeMultiplier(atkType, defType);
                const resistMult = 1 - (resistance / 100);
                const lineupMult = 1 + LINEUP_BONUS[lineupLevel || 0];
                const moraleMult = (morale || 100) / 100;

                const normalDmg = baseDmg * starBonus * skillMult * typeMult * resistMult * lineupMult * moraleMult;
                const critMult = critDamage / 100;
                const critDmg = normalDmg * critMult;

                const avgDmg = normalDmg * (1 + (critChance / 100) * (critMult - 1));

                return {
                    normal: Math.round(normalDmg),
                    critical: Math.round(critDmg),
                    average: Math.round(avgDmg),
                    baseDmg: Math.round(baseDmg),
                    defReduction,
                    starBonus,
                    skillMult,
                    typeMult,
                    resistMult,
                    lineupMult,
                    moraleMult
                };
            }

            // â”€â”€ Battle Simulation â”€â”€
            function simulateBattle() {
                const attack = parseValue(document.getElementById('attack').value);
                const health = parseValue(document.getElementById('health').value);
                const defense = parseValue(document.getElementById('defense').value);
                const resistance = parseFloat(document.getElementById('resistance').value) || 0;
                const critChance = parseFloat(document.getElementById('critChance').value) || 0;
                const critDamage = parseFloat(document.getElementById('critDamage').value) || 150;
                const morale = parseFloat(document.getElementById('morale').value) || 100;
                const atkType = document.getElementById('attackerType').value;
                const defType = document.getElementById('defenderType').value;

                // Effective HP calculation
                const effectiveHP = health * (defense + DEF_CONSTANT) / DEF_CONSTANT;

                const dmg = calculateDamage(attack, defense, selectedStars, selectedSkill, atkType, defType, resistance, critChance, critDamage, selectedLineup, morale);

                const hitsToKill = Math.ceil(health / dmg.average);
                const hitsToKillNormal = Math.ceil(health / dmg.normal);

                // Simulate round-by-round
                let remainingHP = health;
                const rounds = [];
                let roundNum = 0;
                while (remainingHP > 0 && roundNum < 100) {
                    roundNum++;
                    const isCrit = Math.random() * 100 < critChance;
                    const hit = isCrit ? dmg.critical : dmg.normal;
                    remainingHP = Math.max(0, remainingHP - hit);
                    rounds.push({
                        round: roundNum,
                        damage: hit,
                        isCrit,
                        remainingHP
                    });
                }

                // Type advantage info
                let typeInfo = '';
                if (dmg.typeMult > 1) typeInfo = '<div class="type-badge advantage">âœ… Ø£ÙØ¶Ù„ÙŠØ© Ù†ÙˆØ¹! Ã—' + dmg.typeMult.toFixed(2) + '</div>';
                else if (dmg.typeMult < 1) typeInfo = '<div class="type-badge disadvantage">âŒ Ø¹ÙŠØ¨ Ù†ÙˆØ¹! Ã—' + dmg.typeMult.toFixed(2) + '</div>';
                else typeInfo = '<div class="type-badge neutral">âš–ï¸ ØªØ¹Ø§Ø¯Ù„ Ù†ÙˆØ¹ Ã—1.00</div>';

                const resultsHtml = `
                <div class="card" id="resultCard">
                    <h2>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©</h2>
                    <div style="text-align:center;margin-bottom:15px;">
                        <span style="font-size:1.2rem;">${TYPE_NAMES[atkType]}</span>
                        <span style="margin:0 10px;font-weight:800;color:var(--primary);">âš”ï¸</span>
                        <span style="font-size:1.2rem;">${TYPE_NAMES[defType]}</span>
                    </div>
                    <div style="text-align:center;">${typeInfo}</div>

                    <div class="stats-grid" style="margin-top:20px;">
                        <div class="stat-box">
                            <div class="stat-val" style="color:var(--danger);">${formatNumber(dmg.normal)}</div>
                            <div class="stat-lbl">Ø¶Ø±Ø± Ø¹Ø§Ø¯ÙŠ</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-val" style="color:var(--warning);">${formatNumber(dmg.critical)}</div>
                            <div class="stat-lbl">Ø¶Ø±Ø± Ø­Ø±Ø¬ ğŸ’¥</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-val" style="color:var(--info);">${formatNumber(dmg.average)}</div>
                            <div class="stat-lbl">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¶Ø±Ø±</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-val" style="color:var(--success);">${hitsToKill}</div>
                            <div class="stat-lbl">Ø¶Ø±Ø¨Ø§Øª Ù„Ù„Ù‚ØªÙ„</div>
                        </div>
                    </div>

                    <div style="margin-top:12px;padding:14px;background:linear-gradient(135deg,rgba(72,187,120,0.08),rgba(66,153,225,0.08));border-radius:14px;border:1px solid var(--border);">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                            <span style="font-weight:700;color:var(--primary);">ğŸ›¡ï¸ Effective HP (EHP)</span>
                            <strong style="font-size:1.15rem;color:var(--success);">${formatNumber(effectiveHP)}</strong>
                        </div>
                        <div style="font-size:.75rem;color:var(--text-sub);">HP Ø§Ù„ÙØ¹Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ø¯ÙØ§Ø¹ = HP Ã— (DEF+4000)/4000</div>
                    </div>

                    <div style="margin-top:20px;padding:14px;background:var(--bg-body);border-radius:14px;font-size:.82rem;">
                        <div style="font-weight:700;color:var(--primary);margin-bottom:10px;font-size:.9rem;">ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©</div>
                        <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                            <span>Ø§Ù„Ø¶Ø±Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (ATKÃ—4000/(DEF+4000))</span><strong>${formatNumber(dmg.baseDmg)}</strong>
                        </div>
                        <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                            <span>ØªØ®ÙÙŠØ¶ Ø§Ù„Ø¯ÙØ§Ø¹</span><strong style="color:var(--info);">${(dmg.defReduction * 100).toFixed(1)}%</strong>
                        </div>
                        <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                            <span>Ø¨ÙˆÙ†Øµ Ø§Ù„Ù†Ø¬ÙˆÙ… âš ï¸</span><strong>Ã—${dmg.starBonus.toFixed(2)}</strong>
                        </div>
                        <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                            <span>Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ù…Ù‡Ø§Ø±Ø© âš ï¸</span><strong>Ã—${dmg.skillMult.toFixed(2)}</strong>
                        </div>
                        <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                            <span>Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ù†ÙˆØ¹</span><strong>Ã—${dmg.typeMult.toFixed(2)}</strong>
                        </div>
                        <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                            <span>ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©</span><strong>Ã—${dmg.resistMult.toFixed(2)}</strong>
                        </div>
                        <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                            <span>Ø¨ÙˆÙ†Øµ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©</span><strong style="color:var(--success);">Ã—${dmg.lineupMult.toFixed(2)}</strong>
                        </div>
                        <div style="display:flex;justify-content:space-between;">
                            <span>Ø§Ù„Ø±ÙˆØ­ Ø§Ù„Ù…Ø¹Ù†ÙˆÙŠØ©</span><strong>Ã—${dmg.moraleMult.toFixed(2)}</strong>
                        </div>
                    </div>

                    <h2 style="margin-top:20px;">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©</h2>
                    <div class="battle-log">
                        ${rounds.map(r => `
                            <div class="log-entry ${r.isCrit ? 'critical' : ''}">
                                <span>Ø§Ù„Ø¬ÙˆÙ„Ø© ${r.round} ${r.isCrit ? 'ğŸ’¥' : 'âš”ï¸'}</span>
                                <span style="display:flex;gap:15px;">
                                    <span style="color:var(--danger);">-${formatNumber(r.damage)}</span>
                                    <span style="color:var(--text-sub);">â¤ï¸ ${formatNumber(r.remainingHP)}</span>
                                </span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML = resultsHtml;
                resultsDiv.style.display = 'block';
                resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            // â”€â”€ Compare Units â”€â”€
            function compareUnits() {
                const type1 = document.getElementById('comp1Type').value;
                const atk1 = parseValue(document.getElementById('comp1Attack').value);
                const stars1 = parseInt(document.getElementById('comp1Stars').value);

                const type2 = document.getElementById('comp2Type').value;
                const atk2 = parseValue(document.getElementById('comp2Attack').value);
                const stars2 = parseInt(document.getElementById('comp2Stars').value);

                const power1 = atk1 * (1 + STAR_BONUS[stars1]);
                const power2 = atk2 * (1 + STAR_BONUS[stars2]);

                const typeMult1vs2 = getTypeMultiplier(type1, type2);
                const typeMult2vs1 = getTypeMultiplier(type2, type1);

                const effective1 = power1 * typeMult1vs2;
                const effective2 = power2 * typeMult2vs1;

                const winner = effective1 > effective2 ? 1 : effective2 > effective1 ? 2 : 0;
                const diff = Math.abs(effective1 - effective2);
                const pct = winner === 1 ? ((effective1 / effective2 - 1) * 100).toFixed(1) :
                    winner === 2 ? ((effective2 / effective1 - 1) * 100).toFixed(1) : '0';

                let typeInfo1 = '';
                if (typeMult1vs2 > 1) typeInfo1 = '<span style="color:var(--success);">+20%</span>';
                else if (typeMult1vs2 < 1) typeInfo1 = '<span style="color:var(--danger);">-20%</span>';
                else typeInfo1 = '<span style="color:var(--warning);">0%</span>';

                let typeInfo2 = '';
                if (typeMult2vs1 > 1) typeInfo2 = '<span style="color:var(--success);">+20%</span>';
                else if (typeMult2vs1 < 1) typeInfo2 = '<span style="color:var(--danger);">-20%</span>';
                else typeInfo2 = '<span style="color:var(--warning);">0%</span>';

                const winnerText = winner === 0 ? 'âš–ï¸ ØªØ¹Ø§Ø¯Ù„ ØªØ§Ù…!' :
                    winner === 1 ? `ğŸ† Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø£Ù‚ÙˆÙ‰ Ø¨Ù†Ø³Ø¨Ø© ${pct}%` :
                        `ğŸ† Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø£Ù‚ÙˆÙ‰ Ø¨Ù†Ø³Ø¨Ø© ${pct}%`;

                const winnerColor = winner === 1 ? 'var(--success)' : winner === 2 ? 'var(--info)' : 'var(--warning)';

                document.getElementById('compareResults').innerHTML = `
                <div class="card" style="margin-top:20px;">
                    <h2>ğŸ“Š Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</h2>
                    <div style="text-align:center;padding:15px 0;">
                        <div style="font-size:1.15rem;font-weight:800;color:${winnerColor};margin-bottom:15px;">${winnerText}</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-box" style="border:2px solid ${winner === 1 ? 'var(--success)' : 'var(--border)'};">
                            <div style="margin-bottom:8px;">${TYPE_NAMES[type1]}</div>
                            <div class="stat-val">${formatNumber(power1)}</div>
                            <div class="stat-lbl">Ù‚ÙˆØ© Ø£Ø³Ø§Ø³ÙŠØ©</div>
                            <div style="margin-top:8px;font-size:.82rem;">Ø£ÙØ¶Ù„ÙŠØ© Ù†ÙˆØ¹: ${typeInfo1}</div>
                            <div class="stat-val" style="font-size:1.1rem;margin-top:5px;color:var(--primary);">${formatNumber(effective1)}</div>
                            <div class="stat-lbl">Ù‚ÙˆØ© ÙØ¹Ù„ÙŠØ©</div>
                        </div>
                        <div class="stat-box" style="border:2px solid ${winner === 2 ? 'var(--success)' : 'var(--border)'};">
                            <div style="margin-bottom:8px;">${TYPE_NAMES[type2]}</div>
                            <div class="stat-val">${formatNumber(power2)}</div>
                            <div class="stat-lbl">Ù‚ÙˆØ© Ø£Ø³Ø§Ø³ÙŠØ©</div>
                            <div style="margin-top:8px;font-size:.82rem;">Ø£ÙØ¶Ù„ÙŠØ© Ù†ÙˆØ¹: ${typeInfo2}</div>
                            <div class="stat-val" style="font-size:1.1rem;margin-top:5px;color:var(--primary);">${formatNumber(effective2)}</div>
                            <div class="stat-lbl">Ù‚ÙˆØ© ÙØ¹Ù„ÙŠØ©</div>
                        </div>
                    </div>
                    <div style="margin-top:15px;padding:12px;background:var(--bg-body);border-radius:12px;font-size:.82rem;text-align:center;">
                        <span>Ø§Ù„ÙØ±Ù‚ ÙÙŠ Ø§Ù„Ù‚ÙˆØ© Ø§Ù„ÙØ¹Ù„ÙŠØ©:</span>
                        <strong style="color:var(--primary);margin-right:8px;">${formatNumber(diff)}</strong>
                    </div>
                </div>
            `;
            }

            // â”€â”€ Save Calculation â”€â”€
            function saveCalculation() {
                const name = document.getElementById('calcName').value || 'Ø­Ø³Ø§Ø¨ ' + new Date().toLocaleString('ar-SA');
                const data = {
                    name,
                    date: new Date().toISOString(),
                    attackerType: document.getElementById('attackerType').value,
                    attack: document.getElementById('attack').value,
                    stars: selectedStars,
                    skill: selectedSkill,
                    critChance: document.getElementById('critChance').value,
                    critDamage: document.getElementById('critDamage').value,
                    defenderType: document.getElementById('defenderType').value,
                    health: document.getElementById('health').value,
                    defense: document.getElementById('defense').value,
                    resistance: document.getElementById('resistance').value
                };

                let saves = JSON.parse(localStorage.getItem('lastwar_saves') || '[]');
                saves.unshift(data);
                if (saves.length > 50) saves = saves.slice(0, 50);
                localStorage.setItem('lastwar_saves', JSON.stringify(saves));

                // Visual feedback
                const btn = event.target.closest('button');
                const orig = btn.innerHTML;
                btn.innerHTML = 'âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸!';
                btn.style.background = 'linear-gradient(135deg, #48bb78, #38a169)';
                btn.style.color = '#fff';
                setTimeout(() => {
                    btn.innerHTML = orig;
                    btn.style.background = '';
                    btn.style.color = '';
                }, 1500);
            }

            // â”€â”€ Load Saved List â”€â”€
            function loadSavedList() {
                const saves = JSON.parse(localStorage.getItem('lastwar_saves') || '[]');
                const container = document.getElementById('savedList');

                if (saves.length === 0) {
                    container.innerHTML = '<p style="text-align:center;color:var(--text-sub);padding:30px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯</p>';
                    return;
                }

                container.innerHTML = saves.map((s, i) => `
                <div class="saved-item" onclick="loadSave(${i})">
                    <div>
                        <div style="font-weight:700;margin-bottom:4px;">${s.name}</div>
                        <div style="font-size:.78rem;color:var(--text-sub);">
                            ${TYPE_NAMES[s.attackerType] || '?'} vs ${TYPE_NAMES[s.defenderType] || '?'} | â­${'â­'.repeat(s.stars)} | ATK: ${s.attack}
                        </div>
                    </div>
                    <button class="delete-btn" onclick="event.stopPropagation();deleteSave(${i})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                </div>
            `).join('');
            }

            // â”€â”€ Load a Saved Calculation â”€â”€
            function loadSave(index) {
                const saves = JSON.parse(localStorage.getItem('lastwar_saves') || '[]');
                const s = saves[index];
                if (!s) return;

                document.getElementById('attackerType').value = s.attackerType;
                document.getElementById('attack').value = s.attack;
                document.getElementById('critChance').value = s.critChance;
                document.getElementById('critDamage').value = s.critDamage;
                document.getElementById('defenderType').value = s.defenderType;
                document.getElementById('health').value = s.health;
                document.getElementById('defense').value = s.defense;
                document.getElementById('resistance').value = s.resistance;
                document.getElementById('calcName').value = s.name;

                // Select stars
                selectedStars = s.stars || 0;
                const starItems = document.querySelectorAll('#calculator .card:first-child .grid-select')[0]?.querySelectorAll('.select-item');
                if (starItems) {
                    starItems.forEach((el, i) => {
                        el.classList.toggle('selected', i === selectedStars);
                    });
                }

                // Select skill
                selectedSkill = s.skill || 0;
                const skillItems = document.querySelectorAll('#calculator .card:first-child .grid-select')[1]?.querySelectorAll('.select-item');
                if (skillItems) {
                    skillItems.forEach((el, i) => {
                        el.classList.toggle('selected', i === selectedSkill);
                    });
                }

                updatePreview();
                switchTab('calculator');
            }

            // â”€â”€ Delete Saved Calculation â”€â”€
            function deleteSave(index) {
                const saves = JSON.parse(localStorage.getItem('lastwar_saves') || '[]');
                saves.splice(index, 1);
                localStorage.setItem('lastwar_saves', JSON.stringify(saves));
                loadSavedList();
            }

            // â”€â”€ Share as Image â”€â”€
            function shareAsImage() {
                const resultCard = document.getElementById('resultCard');
                if (!resultCard) {
                    simulateBattle();
                    setTimeout(shareAsImage, 500);
                    return;
                }

                html2canvas(resultCard, {
                    backgroundColor: document.body.getAttribute('data-theme') === 'dark' ? '#1e293b' : '#ffffff',
                    scale: 2,
                    useCORS: true,
                    logging: false
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'lastwar-battle-' + Date.now() + '.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                }).catch(err => {
                    console.error('Screenshot error:', err);
                    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµÙˆÙŠØ±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                });
            }

            // â”€â”€ Charts â”€â”€
            function initCharts() {
                initSkillChart();
                initUpgradeChart();
            }

            function initSkillChart() {
                const ctx = document.getElementById('skillChart').getContext('2d');
                const attack = parseValue(document.getElementById('attack').value);
                const defense = parseValue(document.getElementById('defense').value);
                const baseDmg = attack * DEF_CONSTANT / (defense + DEF_CONSTANT);
                const starBonus = 1 + STAR_BONUS[selectedStars];

                const damages = SKILL_MULTIPLIER.map(m => Math.round(baseDmg * starBonus * m));

                if (skillChartInstance) skillChartInstance.destroy();

                skillChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: SKILL_NAMES,
                        datasets: [{
                            label: 'Ø§Ù„Ø¶Ø±Ø±',
                            data: damages,
                            backgroundColor: [
                                'rgba(102, 126, 234, 0.7)',
                                'rgba(237, 137, 54, 0.7)',
                                'rgba(245, 101, 101, 0.7)'
                            ],
                            borderColor: [
                                'rgba(102, 126, 234, 1)',
                                'rgba(237, 137, 54, 1)',
                                'rgba(245, 101, 101, 1)'
                            ],
                            borderWidth: 2,
                            borderRadius: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function (ctx) {
                                        return 'Ø§Ù„Ø¶Ø±Ø±: ' + formatNumber(ctx.parsed.y);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: v => formatNumber(v),
                                    color: 'var(--text-sub)',
                                    font: { family: 'Tajawal' }
                                },
                                grid: { color: 'rgba(128,128,128,0.1)' }
                            },
                            x: {
                                ticks: {
                                    color: 'var(--text-sub)',
                                    font: { family: 'Tajawal', weight: 'bold' }
                                },
                                grid: { display: false }
                            }
                        }
                    }
                });
            }

            function initUpgradeChart() {
                const ctx = document.getElementById('upgradeChart').getContext('2d');
                const attack = parseValue(document.getElementById('attack').value);

                const labels = ['â­', 'â­â­', 'â­â­â­', 'â­â­â­â­', 'â­â­â­â­â­'];
                const powers = STAR_BONUS.map(b => Math.round(attack * (1 + b)));

                if (upgradeChartInstance) upgradeChartInstance.destroy();

                upgradeChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [{
                            label: 'Ø§Ù„Ù‚ÙˆØ© Ø§Ù„ÙØ¹Ù„ÙŠØ©',
                            data: powers,
                            borderColor: 'rgba(118, 75, 162, 1)',
                            backgroundColor: 'rgba(118, 75, 162, 0.15)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: '#fff',
                            pointBorderColor: 'rgba(118, 75, 162, 1)',
                            pointBorderWidth: 3,
                            pointHoverRadius: 9
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function (ctx) {
                                        return 'Ø§Ù„Ù‚ÙˆØ©: ' + formatNumber(ctx.parsed.y);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: {
                                    callback: v => formatNumber(v),
                                    color: 'var(--text-sub)',
                                    font: { family: 'Tajawal' }
                                },
                                grid: { color: 'rgba(128,128,128,0.1)' }
                            },
                            x: {
                                ticks: {
                                    color: 'var(--text-sub)',
                                    font: { family: 'Tajawal', weight: 'bold' }
                                },
                                grid: { display: false }
                            }
                        }
                    }
                });
            }

            // â”€â”€ Hero Database Rendering â”€â”€
            // â”€â”€ Hero Avatar Helper â”€â”€
            function heroAvatar(hero, size = 48) {
                if (hero.img) {
                    return `<img src="${hero.img}" alt="${hero.name}" style="width:${size}px;height:${size}px;border-radius:10px;object-fit:cover;border:2px solid ${RARITY_COLORS[hero.rarity]};box-shadow:0 2px 8px rgba(0,0,0,.3);" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';">
                            <div style="display:none;width:${size}px;height:${size}px;border-radius:10px;border:2px solid ${RARITY_COLORS[hero.rarity]};background:linear-gradient(135deg,${RARITY_COLORS[hero.rarity]}33,${RARITY_COLORS[hero.rarity]}11);align-items:center;justify-content:center;font-weight:900;font-size:${Math.round(size * .45)}px;color:${RARITY_COLORS[hero.rarity]};">${hero.name[0]}</div>`;
                } else {
                    const gradients = { UR: 'linear-gradient(135deg,#f6ad55,#ed8936)', SSR: 'linear-gradient(135deg,#b794f4,#9f7aea)', SR: 'linear-gradient(135deg,#63b3ed,#4299e1)' };
                    return `<div style="width:${size}px;height:${size}px;border-radius:10px;border:2px solid ${RARITY_COLORS[hero.rarity]};background:${gradients[hero.rarity]};display:flex;align-items:center;justify-content:center;font-weight:900;font-size:${Math.round(size * .45)}px;color:#fff;text-shadow:0 1px 3px rgba(0,0,0,.4);flex-shrink:0;">${hero.name[0]}</div>`;
                }
            }

            function renderHeroes() {
                filterHeroes();
            }

            function filterHeroes() {
                const search = (document.getElementById('heroSearch')?.value || '').toLowerCase();
                const typeFilter = document.getElementById('heroFilterType')?.value || 'all';
                const rarityFilter = document.getElementById('heroFilterRarity')?.value || 'all';

                let filtered = HEROES.filter(h => {
                    if (typeFilter !== 'all' && h.type !== typeFilter) return false;
                    if (rarityFilter !== 'all' && h.rarity !== rarityFilter) return false;
                    if (search && !h.name.toLowerCase().includes(search) && !h.nameAr.includes(search)) return false;
                    return true;
                });

                const container = document.getElementById('heroList');
                if (!container) return;

                if (filtered.length === 0) {
                    container.innerHTML = '<p style="text-align:center;color:var(--text-sub);padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>';
                    return;
                }

                container.innerHTML = filtered.map(h => `
                    <div style="padding:12px;margin-bottom:10px;background:var(--bg-body);border-radius:14px;border-right:4px solid ${RARITY_COLORS[h.rarity]};display:flex;align-items:center;gap:12px;transition:transform .15s;cursor:default;" onmouseover="this.style.transform='scale(1.01)'" onmouseout="this.style.transform='scale(1)'">
                        <div style="flex-shrink:0;">${heroAvatar(h, 56)}</div>
                        <div style="flex:1;min-width:0;">
                            <div style="font-weight:800;font-size:1rem;margin-bottom:2px;display:flex;align-items:center;gap:6px;flex-wrap:wrap;">
                                ${TYPE_NAMES[h.type]} ${h.nameAr}
                                <span style="font-size:.72rem;color:${RARITY_COLORS[h.rarity]};font-weight:700;background:${RARITY_COLORS[h.rarity]}22;padding:1px 8px;border-radius:6px;">${h.rarity}</span>
                                ${h.dmg ? `<span style="font-size:.68rem;opacity:.7;">${DMG_ICONS[h.dmg]} ${h.dmg === 'physical' ? 'ÙÙŠØ²ÙŠØ§Ø¦ÙŠ' : 'Ø·Ø§Ù‚Ø©'}</span>` : ''}
                            </div>
                            ${h.title ? `<div style="font-size:.72rem;color:${RARITY_COLORS[h.rarity]};opacity:.8;margin-bottom:2px;">Â«${h.title}Â»</div>` : ''}
                            <div style="font-size:.78rem;color:var(--text-sub);">
                                ${ROLE_NAMES[h.role]} Â· ${h.desc}
                            </div>
                            <div style="font-size:.68rem;color:var(--text-sub);margin-top:3px;opacity:.6;">${h.name}</div>
                        </div>
                    </div>
                `).join('');
            }

            // â”€â”€ EXP Calculator â”€â”€
            function calculateEXP() {
                const from = parseInt(document.getElementById('expFrom').value) || 1;
                const to = parseInt(document.getElementById('expTo').value) || 60;

                if (from >= to || from < 1 || to > 175) {
                    document.getElementById('expResults').innerHTML = '<p style="color:var(--danger);text-align:center;padding:12px;">âŒ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ… ØµØ­ÙŠØ­Ø© (Ù…Ù† 1 Ø¥Ù„Ù‰ 175)</p>';
                    return;
                }

                let totalExp = 0;
                for (let i = from; i < to; i++) {
                    totalExp += HERO_EXP[i] || 0;
                }

                // Find required HQ level
                let reqHQ = 1;
                for (const [lvl, hq] of Object.entries(HQ_CAPS)) {
                    if (to <= parseInt(lvl)) { reqHQ = hq; break; }
                }

                document.getElementById('expResults').innerHTML = `
                    <div style="margin-top:15px;padding:16px;background:var(--bg-body);border-radius:14px;">
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-val" style="color:var(--primary);">${formatNumber(totalExp)}</div>
                                <div class="stat-lbl">EXP Ù…Ø·Ù„ÙˆØ¨</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-val" style="color:var(--warning);">HQ ${reqHQ}</div>
                                <div class="stat-lbl">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</div>
                            </div>
                        </div>
                        <div style="margin-top:12px;font-size:.78rem;color:var(--text-sub);text-align:center;">
                            Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${from} â†’ ${to} | Ø§Ù„ÙØ±Ù‚: ${to - from} Ù…Ø³ØªÙˆÙ‰
                        </div>
                    </div>
                `;
            }

            // â”€â”€ Shard Calculator â”€â”€
            function calculateShards() {
                const from = parseInt(document.getElementById('shardFrom').value);
                const to = parseInt(document.getElementById('shardTo').value);

                if (from >= to) {
                    document.getElementById('shardResults').innerHTML = '<p style="color:var(--danger);text-align:center;padding:12px;">âŒ Ù†Ø¬Ù…Ø© Ø§Ù„Ù‡Ø¯Ù ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£Ø¹Ù„Ù‰</p>';
                    return;
                }

                let totalShards = 0;
                const breakdown = [];
                for (let i = from; i < to; i++) {
                    totalShards += SHARD_COSTS[i];
                    breakdown.push({ star: i + 1, cost: SHARD_COSTS[i] });
                }

                document.getElementById('shardResults').innerHTML = `
                    <div style="margin-top:15px;padding:16px;background:var(--bg-body);border-radius:14px;">
                        <div class="stat-box" style="margin-bottom:12px;">
                            <div class="stat-val" style="color:var(--primary);font-size:1.8rem;">${totalShards}</div>
                            <div class="stat-lbl">Ø´Ø¸ÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø©</div>
                        </div>
                        <div style="font-size:.82rem;">
                            ${breakdown.map(b => `
                                <div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);">
                                    <span>${'â­'.repeat(b.star)} Ù†Ø¬Ù…Ø© ${b.star}</span>
                                    <strong>${b.cost} Ø´Ø¸ÙŠØ©</strong>
                                </div>
                            `).join('')}
                        </div>
                        <div style="margin-top:10px;padding:10px;background:rgba(102,126,234,0.08);border-radius:10px;font-size:.78rem;text-align:center;">
                            ğŸ’¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ Ù…Ù† 0 Ø¥Ù„Ù‰ 5â­ = <strong>975 Ø´Ø¸ÙŠØ©</strong>
                        </div>
                    </div>
                `;
            }

            // â”€â”€ Skill Medal Rarity Selection â”€â”€
            function selectMedalRarity(rarity, el) {
                selectedMedalRarity = rarity;
                el.parentElement.querySelectorAll('.select-item').forEach(i => i.classList.remove('selected'));
                el.classList.add('selected');
                // Update max level based on rarity
                const maxLvl = rarity === 'UR' ? 40 : 30;
                document.getElementById('medalTo').max = maxLvl;
                if (parseInt(document.getElementById('medalTo').value) > maxLvl) {
                    document.getElementById('medalTo').value = maxLvl;
                }
            }

            // â”€â”€ Skill Medal Calculator â”€â”€
            function calculateMedals() {
                const from = parseInt(document.getElementById('medalFrom').value) || 1;
                const to = parseInt(document.getElementById('medalTo').value) || 30;
                const skillCount = parseInt(document.getElementById('medalSkillCount').value) || 1;
                const rarity = selectedMedalRarity;
                const ratio = MEDAL_RATIO[rarity];
                const maxLvl = rarity === 'UR' ? 40 : 30;

                if (from >= to || from < 1 || to > maxLvl) {
                    document.getElementById('medalResults').innerHTML = '<p style="color:var(--danger);text-align:center;padding:12px;">âŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©</p>';
                    return;
                }

                if (rarity !== 'UR' && to > 30) {
                    document.getElementById('medalResults').innerHTML = '<p style="color:var(--danger);text-align:center;padding:12px;">âŒ SSR/SR ÙŠÙ…ÙƒÙ†Ù‡Ù… Ø§Ù„ÙˆØµÙˆÙ„ Ø­ØªÙ‰ Ù…Ø³ØªÙˆÙ‰ 30 ÙÙ‚Ø·</p>';
                    return;
                }

                let totalPerSkill = 0;
                const breakdown = [];
                for (let i = from - 1; i < to - 1 && i < MEDAL_COSTS_UR.length; i++) {
                    const cost = Math.round(MEDAL_COSTS_UR[i] * ratio);
                    totalPerSkill += cost;
                    if (i < from + 4 || i >= to - 3) {
                        breakdown.push({ level: i + 1, nextLevel: i + 2, cost });
                    }
                }
                const totalAll = totalPerSkill * skillCount;

                const rarityEmoji = { UR: 'ğŸŸ ', SSR: 'ğŸŸ£', SR: 'ğŸ”µ' };
                const noteUR = rarity === 'UR' && to > 30 ? '<div style="margin-top:8px;padding:8px;background:rgba(246,173,85,0.1);border-radius:8px;font-size:.75rem;text-align:center;">âš ï¸ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª 31-40 ØªØ­ØªØ§Ø¬ Exclusive Weapon</div>' : '';

                document.getElementById('medalResults').innerHTML = `
                    <div style="margin-top:15px;padding:16px;background:var(--bg-body);border-radius:14px;">
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-val" style="color:var(--primary);">${formatNumber(totalPerSkill)}</div>
                                <div class="stat-lbl">Ù…ÙŠØ¯Ø§Ù„ÙŠØ© / Ù…Ù‡Ø§Ø±Ø©</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-val" style="color:var(--warning);">${formatNumber(totalAll)}</div>
                                <div class="stat-lbl">${skillCount > 1 ? `Ø¥Ø¬Ù…Ø§Ù„ÙŠ (${skillCount} Ù…Ù‡Ø§Ø±Ø§Øª)` : 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ'}</div>
                            </div>
                        </div>
                        <div style="margin-top:12px;font-size:.78rem;text-align:center;color:var(--text-sub);">
                            ${rarityEmoji[rarity]} ${rarity} | Ù…Ù‡Ø§Ø±Ø© ${from} â†’ ${to} | ${skillCount} Ù…Ù‡Ø§Ø±Ø©
                        </div>
                        ${noteUR}
                        <div style="margin-top:10px;padding:10px;background:rgba(102,126,234,0.08);border-radius:10px;font-size:.75rem;">
                            <div style="font-weight:700;margin-bottom:6px;">ğŸ“Š Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†Ø¯Ø±Ø§Øª (1â†’30 Ù„Ù…Ù‡Ø§Ø±Ø© ÙˆØ§Ø­Ø¯Ø©):</div>
                            <div style="display:flex;justify-content:space-between;">
                                <span>ğŸŸ  UR: ~${formatNumber(MEDAL_COSTS_UR.slice(0, 29).reduce((a, b) => a + b, 0))}</span>
                                <span>ğŸŸ£ SSR: ~${formatNumber(Math.round(MEDAL_COSTS_UR.slice(0, 29).reduce((a, b) => a + b, 0) * 0.9))}</span>
                                <span>ğŸ”µ SR: ~${formatNumber(Math.round(MEDAL_COSTS_UR.slice(0, 29).reduce((a, b) => a + b, 0) * 0.74))}</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            // â”€â”€ Healing Calculator â”€â”€
            function calculateHealing() {
                const wounded = parseValue(document.getElementById('healWounded').value);
                const capacity = parseValue(document.getElementById('healCapacity').value);
                const timePerUnit = parseFloat(document.getElementById('healTime').value) || 5;
                const allianceHelp = parseFloat(document.getElementById('healAllianceHelp').value) || 0;

                if (wounded <= 0 || capacity <= 0) {
                    document.getElementById('healResults').innerHTML = '<p style="color:var(--danger);text-align:center;padding:12px;">âŒ Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ… ØµØ­ÙŠØ­Ø©</p>';
                    return;
                }

                const batches = Math.ceil(wounded / capacity);
                const adjustedTime = timePerUnit * (1 - allianceHelp / 100);
                const totalTimeSec = wounded * adjustedTime;
                const totalTimeMin = Math.round(totalTimeSec / 60);
                const hours = Math.floor(totalTimeMin / 60);
                const mins = totalTimeMin % 60;
                const timeStr = hours > 0 ? `${hours} Ø³Ø§Ø¹Ø© Ùˆ ${mins} Ø¯Ù‚ÙŠÙ‚Ø©` : `${mins} Ø¯Ù‚ÙŠÙ‚Ø©`;
                const overflow = wounded > capacity ? wounded - capacity : 0;

                document.getElementById('healResults').innerHTML = `
                    <div style="margin-top:15px;padding:16px;background:var(--bg-body);border-radius:14px;">
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-val" style="color:var(--primary);">${batches}</div>
                                <div class="stat-lbl">Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙØ¹Ø§Øª</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-val" style="color:var(--warning);">${timeStr}</div>
                                <div class="stat-lbl">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                            </div>
                        </div>
                        ${overflow > 0 ? `
                        <div style="margin-top:10px;padding:10px;background:rgba(255,68,68,0.1);border-radius:10px;font-size:.78rem;text-align:center;color:var(--danger);">
                            âš ï¸ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø³Ø¹Ø© Ø¨Ù€ ${formatNumber(overflow)} Ø¬Ù†Ø¯ÙŠ â€” ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ø¯ÙØ¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
                        </div>` : ''}
                        <div style="margin-top:10px;font-size:.78rem;color:var(--text-sub);text-align:center;">
                            ${formatNumber(wounded)} Ù…ØµØ§Ø¨ | Ø³Ø¹Ø© ${formatNumber(capacity)} | ${allianceHelp}% Ù…Ø³Ø§Ø¹Ø¯Ø© Ø­Ù„Ù
                        </div>
                    </div>
                `;
            }

            // â”€â”€ Tier List Render â”€â”€
            function renderTierList() {
                const container = document.getElementById('tierListContent');
                let html = '';
                for (const [tier, heroes] of Object.entries(TIER_LIST)) {
                    if (heroes.length === 0 && tier === 'D') continue;
                    const color = TIER_COLORS[tier];
                    html += `
                        <div style="display:flex;align-items:stretch;margin-bottom:10px;border-radius:14px;overflow:hidden;border:1px solid var(--border);">
                            <div style="width:55px;min-height:50px;background:${color};display:flex;align-items:center;justify-content:center;font-weight:900;font-size:1.3rem;color:#fff;">
                                ${tier}
                            </div>
                            <div style="flex:1;padding:10px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;background:var(--bg-card);">
                                ${heroes.length === 0 ? '<span style="color:var(--text-sub);font-size:.8rem;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¨Ø·Ø§Ù„</span>' :
                            heroes.map(name => {
                                const hero = HEROES.find(h => h.name === name);
                                if (!hero) return `<span style="padding:6px 12px;background:var(--bg-body);border-radius:8px;font-size:.82rem;">${name}</span>`;
                                return `<div style="padding:6px 10px;background:var(--bg-body);border-radius:10px;font-size:.8rem;display:flex;align-items:center;gap:6px;border-bottom:2px solid ${color};">
                                        ${heroAvatar(hero, 32)}
                                        <div>
                                            <div style="font-weight:700;font-size:.8rem;">${hero.nameAr}</div>
                                            <div style="font-size:.65rem;color:var(--text-sub);">${hero.name}${hero.title ? ' Â· ' + hero.title : ''}</div>
                                        </div>
                                    </div>`;
                            }).join('')}
                            </div>
                        </div>
                    `;
                }
                container.innerHTML = html;
            }

            // â”€â”€ Team Builder Functions â”€â”€
            function renderTeamSlots() {
                const container = document.getElementById('teamSlots');
                let html = '';
                for (let i = 0; i < 5; i++) {
                    if (teamSlots[i]) {
                        const hero = teamSlots[i];
                        html += `
                            <div style="padding:6px;background:var(--bg-body);border-radius:12px;text-align:center;border:2px solid ${RARITY_COLORS[hero.rarity]};cursor:pointer;position:relative;display:flex;flex-direction:column;align-items:center;gap:4px;" onclick="removeFromTeam(${i})">
                                ${heroAvatar(hero, 44)}
                                <div style="font-size:.68rem;font-weight:700;">${hero.nameAr}</div>
                                <div style="font-size:.58rem;color:${RARITY_COLORS[hero.rarity]};">${hero.rarity}</div>
                                <div style="position:absolute;top:-5px;right:-5px;width:18px;height:18px;background:var(--danger);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.6rem;color:#fff;box-shadow:0 1px 4px rgba(0,0,0,.3);">âœ•</div>
                            </div>
                        `;
                    } else {
                        html += `
                            <div style="padding:8px;background:var(--bg-body);border-radius:12px;text-align:center;border:2px dashed var(--border);opacity:.5;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:80px;">
                                <div style="font-size:1.2rem;">â•</div>
                                <div style="font-size:.65rem;margin-top:2px;">ÙØ§Ø±Øº</div>
                            </div>
                        `;
                    }
                }
                container.innerHTML = html;
                document.getElementById('teamCount').textContent = teamSlots.filter(Boolean).length;
                analyzeTeam();
            }

            function renderTeamBuilderList() {
                const filter = document.getElementById('tbFilter').value;
                const filtered = HEROES.filter(h => filter === 'all' || h.type === filter);
                const container = document.getElementById('tbHeroList');
                const inTeam = teamSlots.filter(Boolean).map(h => h.name);

                container.innerHTML = filtered.map(h => {
                    const isInTeam = inTeam.includes(h.name);
                    return `
                        <div style="display:flex;align-items:center;gap:8px;padding:7px 10px;margin-bottom:5px;background:${isInTeam ? 'rgba(102,126,234,0.15)' : 'var(--bg-body)'};border-radius:10px;border-left:3px solid ${RARITY_COLORS[h.rarity]};${isInTeam ? 'opacity:.5;' : 'cursor:pointer;'}" ${isInTeam ? '' : `onclick="addToTeam('${h.name}')"`}>
                            <div style="flex-shrink:0;">${heroAvatar(h, 36)}</div>
                            <div style="flex:1;min-width:0;">
                                <div style="display:flex;align-items:center;gap:4px;">
                                    <strong style="font-size:.82rem;">${h.nameAr}</strong>
                                    <span style="font-size:.65rem;color:${RARITY_COLORS[h.rarity]};">${h.rarity}</span>
                                </div>
                                <div style="font-size:.68rem;color:var(--text-sub);">${h.name}${h.title ? ' Â· ' + h.title : ''}</div>
                            </div>
                            <div style="font-size:.7rem;color:var(--text-sub);flex-shrink:0;">${isInTeam ? 'âœ… ÙÙŠ Ø§Ù„ÙØ±ÙŠÙ‚' : ROLE_NAMES[h.role]}</div>
                        </div>
                    `;
                }).join('');
            }

            function addToTeam(heroName) {
                if (teamSlots.filter(Boolean).length >= 5) return;
                const hero = HEROES.find(h => h.name === heroName);
                if (!hero || teamSlots.some(s => s && s.name === heroName)) return;
                const emptyIdx = teamSlots.indexOf(undefined);
                if (emptyIdx === -1) teamSlots.push(hero);
                else teamSlots[emptyIdx] = hero;
                if (teamSlots.length > 5) teamSlots.length = 5;
                renderTeamSlots();
                renderTeamBuilderList();
            }

            function removeFromTeam(idx) {
                teamSlots[idx] = undefined;
                // Compact
                teamSlots = teamSlots.filter(Boolean);
                while (teamSlots.length < 5) teamSlots.push(undefined);
                renderTeamSlots();
                renderTeamBuilderList();
            }

            function clearTeam() {
                teamSlots = [undefined, undefined, undefined, undefined, undefined];
                renderTeamSlots();
                renderTeamBuilderList();
            }

            function analyzeTeam() {
                const team = teamSlots.filter(Boolean);
                const container = document.getElementById('teamAnalysis');
                if (team.length === 0) { container.innerHTML = ''; return; }

                // Count types
                const typeCounts = { tank: 0, plane: 0, missile: 0 };
                team.forEach(h => typeCounts[h.type]++);
                const maxType = Object.entries(typeCounts).sort((a, b) => b[1] - a[1])[0];

                // Calculate lineup bonus
                let bonus = 0;
                if (maxType[1] >= 5) bonus = 20;
                else if (maxType[1] >= 4) bonus = 15;
                else if (maxType[1] >= 3) bonus = 10;
                else bonus = 0;

                // Role distribution
                const roleCounts = { attack: 0, defense: 0, support: 0 };
                team.forEach(h => roleCounts[h.role]++);

                // Rarity summary
                const rarityCounts = { UR: 0, SSR: 0, SR: 0 };
                team.forEach(h => rarityCounts[h.rarity]++);

                container.innerHTML = `
                    <div style="padding:14px;background:var(--bg-body);border-radius:12px;">
                        <div style="font-weight:700;margin-bottom:10px;">ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ±ÙŠÙ‚</div>
                        <div class="stats-grid" style="margin-bottom:10px;">
                            <div class="stat-box">
                                <div class="stat-val" style="color:${bonus > 0 ? 'var(--success)' : 'var(--text-sub)'};">+${bonus}%</div>
                                <div class="stat-lbl">Ø¨ÙˆÙ†Øµ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-val">${team.length}/5</div>
                                <div class="stat-lbl">Ø£Ø¨Ø·Ø§Ù„</div>
                            </div>
                        </div>
                        <div style="display:flex;gap:10px;flex-wrap:wrap;font-size:.78rem;">
                            <span>ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©: ${typeCounts.tank}</span>
                            <span>âœˆï¸ Ø·Ø§Ø¦Ø±Ø©: ${typeCounts.plane}</span>
                            <span>ğŸš€ ØµØ§Ø±ÙˆØ®: ${typeCounts.missile}</span>
                        </div>
                        <div style="display:flex;gap:10px;flex-wrap:wrap;font-size:.78rem;margin-top:6px;">
                            <span>âš”ï¸ Ù…Ù‡Ø§Ø¬Ù…: ${roleCounts.attack}</span>
                            <span>ğŸ›¡ï¸ Ù…Ø¯Ø§ÙØ¹: ${roleCounts.defense}</span>
                            <span>ğŸ’Š Ø¯Ø¹Ù…: ${roleCounts.support}</span>
                        </div>
                        <div style="display:flex;gap:10px;flex-wrap:wrap;font-size:.78rem;margin-top:6px;">
                            <span style="color:${RARITY_COLORS.UR};">UR: ${rarityCounts.UR}</span>
                            <span style="color:${RARITY_COLORS.SSR};">SSR: ${rarityCounts.SSR}</span>
                            <span style="color:${RARITY_COLORS.SR};">SR: ${rarityCounts.SR}</span>
                        </div>
                        ${bonus === 0 && team.length >= 3 ? '<div style="margin-top:8px;padding:6px;background:rgba(255,136,0,0.1);border-radius:8px;font-size:.72rem;color:var(--warning);text-align:center;">ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø§Ø³ØªØ®Ø¯Ù… 3+ Ø£Ø¨Ø·Ø§Ù„ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù†ÙˆØ¹ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙˆÙ†Øµ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©</div>' : ''}
                    </div>
                `;
            }

            function renderMetaTeams() {
                const container = document.getElementById('metaTeams');
                container.innerHTML = META_TEAMS.map(team => {
                    return `
                        <div style="padding:14px;background:var(--bg-body);border-radius:12px;margin-bottom:10px;">
                            <div style="font-weight:700;margin-bottom:6px;">${team.name}</div>
                            <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px;">
                                ${team.heroes.map(name => {
                        const hero = HEROES.find(h => h.name === name);
                        if (!hero) return `<span style="padding:4px 10px;background:var(--bg-card);border-radius:6px;font-size:.78rem;">${name}</span>`;
                        return `<span style="padding:4px 10px;background:var(--bg-card);border-radius:6px;font-size:.78rem;border-left:2px solid ${RARITY_COLORS[hero.rarity]};">${hero.nameAr}</span>`;
                    }).join('')}
                            </div>
                            <div style="font-size:.75rem;color:var(--text-sub);">${team.desc}</div>
                            <button class="btn-lg" onclick="loadMetaTeam(${META_TEAMS.indexOf(team)})" style="margin-top:8px;padding:6px 12px;font-size:.75rem;background:var(--primary);color:#fff;border:none;border-radius:8px;cursor:pointer;">ğŸ“‹ Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„ÙØ±ÙŠÙ‚</button>
                        </div>
                    `;
                }).join('');
            }

            function loadMetaTeam(idx) {
                const team = META_TEAMS[idx];
                teamSlots = [];
                team.heroes.forEach(name => {
                    const hero = HEROES.find(h => h.name === name);
                    if (hero) teamSlots.push(hero);
                });
                while (teamSlots.length < 5) teamSlots.push(undefined);
                renderTeamSlots();
                renderTeamBuilderList();
            }

            // â”€â”€ Initialize â”€â”€
            updatePreview();
        </script>
</body>

</html>
