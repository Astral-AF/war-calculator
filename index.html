<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Pro Mobile</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary: #667eea;
            --accent: #764ba2;
            --bg-body: #f0f2f5;
            --bg-card: #ffffff;
            --text-main: #2d3748;
            --text-sub: #718096;
            --border: #e2e8f0;
            --success: #48bb78;
            --danger: #f56565;
            --radius: 16px;
        }

        [data-theme="dark"] {
            --primary: #7f9cf5;
            --accent: #5a67d8;
            --bg-body: #1a202c;
            --bg-card: #2d3748;
            --text-main: #f7fafc;
            --text-sub: #a0aec0;
            --border: #4a5568;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--bg-body);
            color: var(--text-main);
            padding-bottom: 50px;
            transition: background 0.3s;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            padding: 20px 15px;
            padding-top: max(20px, env(safe-area-inset-top));
            text-align: center;
            border-bottom-left-radius: 25px;
            border-bottom-right-radius: 25px;
            position: relative;
            margin-bottom: 20px;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            left: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            width: 40px; height: 40px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; cursor: pointer;
        }

        /* Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .tabs-wrapper {
            position: sticky; top: 0; z-index: 100;
            background: var(--bg-body); padding: 10px 0; margin: 0 10px;
        }

        .tabs {
            display: flex; overflow-x: auto; gap: 10px; padding: 5px;
            background: var(--bg-card); border-radius: 15px;
            scrollbar-width: none;
        }
        .tabs::-webkit-scrollbar { display: none; }

        .tab {
            flex: 0 0 auto; padding: 10px 20px; border: none;
            background: transparent; color: var(--text-sub);
            font-weight: 600; border-radius: 10px; font-size: 0.9rem;
        }

        .tab.active { background: var(--primary); color: white; }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ */
        .container { max-width: 800px; margin: 0 auto; padding: 0 15px; }
        .tab-content { display: none; animation: slideUp 0.3s ease-out; }
        .tab-content.active { display: block; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--bg-card); border-radius: var(--radius);
            padding: 20px; margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid var(--border);
        }

        .card h2 { font-size: 1.1rem; color: var(--primary); margin-bottom: 15px; }

        /* Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: var(--text-sub); font-size: 0.85rem; font-weight: 600; }
        input, select {
            width: 100%; padding: 12px; border: 2px solid var(--border);
            border-radius: 12px; background: var(--bg-body);
            color: var(--text-main); font-size: 16px;
        }

        .preview-box { font-size: 0.8rem; color: var(--primary); margin-top: 5px; text-align: left; }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª */
        .grid-select { display: grid; grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); gap: 8px; }
        .select-item {
            background: var(--bg-body); border: 2px solid var(--border);
            border-radius: 10px; padding: 8px; text-align: center; cursor: pointer;
        }
        .select-item.selected { border-color: var(--primary); background: rgba(102, 126, 234, 0.1); color: var(--primary); }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn-lg {
            width: 100%; padding: 16px; border: none; border-radius: 14px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; }

        /* Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø±ÙƒØ© */
        .battle-log-container {
            max-height: 350px; overflow-y: auto; background: var(--bg-body);
            border-radius: 12px; padding: 10px; margin-top: 15px;
        }
        .log-entry {
            padding: 10px; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem;
        }
        .hit-crit { background: rgba(245, 101, 101, 0.1); border-right: 4px solid var(--danger); color: var(--danger); font-weight: bold; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .stat-box { background: var(--bg-body); padding: 10px; border-radius: 10px; text-align: center; }
        .stat-val { display: block; font-size: 1.2rem; font-weight: bold; }
        .stat-lbl { font-size: 0.75rem; color: var(--text-sub); }
    </style>
</head>
<body>

    <div class="header">
        <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
        <h1>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Pro</h1>
        <p style="font-size: 0.8rem; opacity: 0.8;">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¶Ø±Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬Ø© | Ø¶Ø±Ø¨Ø© Ø¨Ø¶Ø±Ø¨Ø©</p>
    </div>

    <div class="tabs-wrapper">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('calculator')">ğŸ¯ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</button>
            <button class="tab" onclick="switchTab('compare')">âš”ï¸ Ù…Ù‚Ø§Ø±Ù†Ø©</button>
            <button class="tab" onclick="switchTab('saved')">ğŸ’¾ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</button>
            <button class="tab" onclick="switchTab('charts')">ğŸ“Š Ø§Ù„Ø±Ø³ÙˆÙ…</button>
        </div>
    </div>

    <div class="container">
        <div id="calculator" class="tab-content active">
            <div class="card">
                <h2>ğŸ—¡ï¸ Ø§Ù„Ù…Ù‡Ø§Ø¬Ù…</h2>
                <div class="input-group">
                    <label>Ù‚ÙˆØ© Ø§Ù„Ù‡Ø¬ÙˆÙ…</label>
                    <input type="text" id="attack" value="65.2K" inputmode="decimal" oninput="updatePreview()">
                    <div class="preview-box">Ø§Ù„Ù‚ÙŠÙ…Ø©: <span id="attackVal">65,200</span></div>
                </div>

                <div class="input-group">
                    <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø¬ÙˆÙ…</label>
                    <div class="grid-select" id="starSelect">
                        <div class="select-item selected" onclick="setStars(0, this)">â­<br><small>+30%</small></div>
                        <div class="select-item" onclick="setStars(1, this)">2â­<br><small>+70%</small></div>
                        <div class="select-item" onclick="setStars(2, this)">3â­<br><small>+120%</small></div>
                        <div class="select-item" onclick="setStars(3, this)">4â­<br><small>+185%</small></div>
                        <div class="select-item" onclick="setStars(4, this)">5â­<br><small>+270%</small></div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</label>
                    <div class="grid-select" style="grid-template-columns: 1fr 1fr 1fr;">
                        <div class="select-item selected" onclick="setSkill(0, this)">Ø¹Ø§Ø¯ÙŠØ©</div>
                        <div class="select-item" onclick="setSkill(1, this)">Ø®Ø§ØµØ©</div>
                        <div class="select-item" onclick="setSkill(2, this)">Ù†Ù‡Ø§Ø¦ÙŠØ©</div>
                    </div>
                </div>

                <div class="stat-grid">
                    <div class="input-group">
                        <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬Ø© %</label>
                        <input type="number" id="critChance" value="20" oninput="updateCritInfo()">
                        <div id="critInfo" class="preview-box" style="font-weight:bold; color:var(--accent);"></div>
                    </div>
                    <div class="input-group">
                        <label>Ø¶Ø±Ø± Ø§Ù„Ø­Ø±Ø¬Ø© %</label>
                        <input type="number" id="critDamage" value="150">
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ›¡ï¸ Ø§Ù„Ù…Ø¯Ø§ÙØ¹</h2>
                <div class="input-group">
                    <label>Ù†Ù‚Ø§Ø· Ø§Ù„ØµØ­Ø© (HP)</label>
                    <input type="text" id="health" value="1.4M" inputmode="decimal" oninput="updatePreview()">
                    <div class="preview-box">Ø§Ù„Ù‚ÙŠÙ…Ø©: <span id="healthVal">1,400,000</span></div>
                </div>
                <div class="stat-grid">
                    <div class="input-group">
                        <label>Ø§Ù„Ø¯ÙØ§Ø¹</label>
                        <input type="text" id="defense" value="8.4K">
                    </div>
                    <div class="input-group">
                        <label>Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© %</label>
                        <input type="number" id="resistance" value="10">
                    </div>
                </div>
            </div>

            <button class="btn-lg btn-primary" onclick="simulateBattle()">âš”ï¸ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©</button>

            <div id="results" style="display: none; margin-top: 20px;"></div>
        </div>

        <div id="compare" class="tab-content"><div class="card"><h2>Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ÙˆØ­Ø¯Ø§Øª</h2><p>Ù‚Ø±ÙŠØ¨Ø§Ù‹ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¯Ù…...</p></div></div>
        <div id="saved" class="tab-content"><div class="card"><h2>Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</h2><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©.</p></div></div>
        <div id="charts" class="tab-content"><div class="card"><h2>ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†ÙŠ</h2><p>Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ø¶Ø±Ø±.</p></div></div>
    </div>

    <script>
        let selectedStars = 0;
        let selectedSkill = 0;
        const starBonuses = [0.30, 0.70, 1.20, 1.85, 2.70];
        const skillMults = [1.0, 3.45, 6.05];

        function parseVal(s) {
            s = String(s).toUpperCase().replace(/,/g, '');
            if (s.endsWith('K')) return parseFloat(s) * 1000;
            if (s.endsWith('M')) return parseFloat(s) * 1000000;
            return parseFloat(s) || 0;
        }

        function formatNumber(n) { return Math.round(n).toLocaleString(); }
        
        function formatCompact(n) {
            if (n >= 1000000) return (n / 1000000).toFixed(2) + 'M';
            if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
            return Math.round(n).toString();
        }

        function updatePreview() {
            document.getElementById('attackVal').textContent = formatNumber(parseVal(document.getElementById('attack').value));
            document.getElementById('healthVal').textContent = formatNumber(parseVal(document.getElementById('health').value));
        }

        function updateCritInfo() {
            const chance = parseFloat(document.getElementById('critChance').value) || 0;
            const info = document.getElementById('critInfo');
            if (chance <= 0) info.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¶Ø±Ø¨Ø§Øª Ø­Ø±Ø¬Ø©";
            else if (chance >= 100) info.textContent = "ÙƒÙ„ Ø§Ù„Ø¶Ø±Ø¨Ø§Øª Ø­Ø±Ø¬Ø©!";
            else info.innerHTML = `Ø¶Ø±Ø¨Ø© Ø­Ø±Ø¬Ø© ÙƒÙ„ ${Math.round(100/chance)} Ø¶Ø±Ø¨Ø§Øª ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹`;
        }

        function setStars(val, el) {
            selectedStars = val;
            el.parentElement.querySelectorAll('.select-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
        }

        function setSkill(val, el) {
            selectedSkill = val;
            el.parentElement.querySelectorAll('.select-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
        }

        function switchTab(id) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(id).classList.add('active');
        }

        function toggleTheme() {
            const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', theme);
        }

        function simulateBattle() {
            const atk = parseVal(document.getElementById('attack').value);
            const def = parseVal(document.getElementById('defense').value);
            let hp = parseVal(document.getElementById('health').value);
            const critC = parseFloat(document.getElementById('critChance').value) / 100;
            const critD = parseFloat(document.getElementById('critDamage').value) / 100;
            const res = parseFloat(document.getElementById('resistance').value) / 100;

            const baseDmg = (atk - def) * (1 + starBonuses[selectedStars]) * skillMults[selectedSkill] * (1 - res);
            
            let turns = 0, totalDmg = 0, crits = 0, logHTML = '';

            while (hp > 0 && turns < 500) {
                turns++;
                const isCrit = Math.random() < critC;
                let dmg = Math.max(1, isCrit ? baseDmg * critD : baseDmg);
                dmg = Math.round(dmg);
                hp = Math.max(0, hp - dmg);
                totalDmg += dmg;
                if (isCrit) crits++;

                logHTML += `
                    <div class="log-entry ${isCrit ? 'hit-crit' : ''}">
                        <div>
                            <b>${isCrit ? 'ğŸ’¥' : 'ğŸ—¡ï¸'} Ø¯ÙˆØ± ${turns}</b> ${isCrit ? '(Ø­Ø±Ø¬Ø©)' : ''}<br>
                            <span>Ø¶Ø±Ø±: ${formatNumber(dmg)}</span>
                        </div>
                        <div style="text-align:left;">
                            <span class="stat-lbl">ØµØ­Ø© Ø§Ù„Ø®ØµÙ…</span><br>
                            <b>${formatCompact(hp)}</b>
                        </div>
                    </div>
                `;
            }

            const resDiv = document.getElementById('results');
            resDiv.innerHTML = `
                <div class="card" style="border-top: 5px solid var(--success);">
                    <h3 style="text-align:center;">ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©</h3>
                    <div class="stat-grid">
                        <div class="stat-box"><span class="stat-val">${turns}</span><span class="stat-lbl">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</span></div>
                        <div class="stat-box"><span class="stat-val" style="color:var(--danger)">${crits}</span><span class="stat-lbl">Ø¶Ø±Ø¨Ø§Øª Ø­Ø±Ø¬Ø©</span></div>
                    </div>
                    <h4 style="margin:15px 0 5px;">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ø¶Ø±Ø¨Ø§Øª (Ø¶Ø±Ø¨Ø© Ø¨Ø¶Ø±Ø¨Ø©)</h4>
                    <div class="battle-log-container">${logHTML}</div>
                </div>
            `;
            resDiv.style.display = 'block';
            resDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
        updatePreview();
        updateCritInfo();
    </script>
</body>
</html>
