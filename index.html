<!DOCTYPE html>

<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Pro">
    <meta name="theme-color" content="#667eea">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„Ø£Ø®ÙŠØ±Ø© Pro Max</title>

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
    :root {
        --primary: #667eea;
        --primary-dark: #5a6fd6;
        --accent: #764ba2;
        --bg-body: #f0f2f5;
        --bg-card: #ffffff;
        --text-main: #2d3748;
        --text-sub: #718096;
        --border: #e2e8f0;
        --success: #48bb78;
        --danger: #f56565;
        --warning: #ed8936;
        --info: #4299e1;
        --radius: 16px;
    }

    [data-theme="dark"] {
        --primary: #7f9cf5;
        --primary-dark: #667eea;
        --accent: #5a67d8;
        --bg-body: #1a202c;
        --bg-card: #2d3748;
        --text-main: #f7fafc;
        --text-sub: #a0aec0;
        --border: #4a5568;
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: transparent;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
        background: var(--bg-body);
        color: var(--text-main);
        padding-bottom: 80px;
        transition: background 0.3s;
    }

    /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± --- */
    .header {
        background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        color: white;
        padding: 20px 15px;
        padding-top: max(20px, env(safe-area-inset-top));
        text-align: center;
        border-bottom-left-radius: 25px;
        border-bottom-right-radius: 25px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        position: relative;
        margin-bottom: 20px;
    }

    .header h1 {
        font-size: 1.4rem;
        margin-bottom: 5px;
    }

    .theme-toggle {
        position: absolute;
        top: 20px;
        left: 15px;
        background: rgba(255,255,255,0.2);
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        cursor: pointer;
        backdrop-filter: blur(5px);
    }

    /* --- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª --- */
    .tabs-wrapper {
        position: sticky;
        top: 0;
        z-index: 100;
        background: var(--bg-body);
        padding: 10px 0;
        margin: 0 10px;
    }

    .tabs {
        display: flex;
        overflow-x: auto;
        gap: 10px;
        padding: 5px;
        background: var(--bg-card);
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        scrollbar-width: none;
    }
    
    .tabs::-webkit-scrollbar { display: none; }

    .tab {
        flex: 0 0 auto;
        padding: 10px 20px;
        border: none;
        background: transparent;
        color: var(--text-sub);
        font-weight: 600;
        border-radius: 10px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s;
    }

    .tab.active {
        background: var(--primary);
        color: white;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    /* --- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ --- */
    .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 15px;
    }

    .tab-content {
        display: none;
        animation: slideUp 0.3s ease-out;
    }

    .tab-content.active { display: block; }

    @keyframes slideUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .card {
        background: var(--bg-card);
        border-radius: var(--radius);
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        border: 1px solid var(--border);
    }

    .card h2 {
        font-size: 1.1rem;
        color: var(--primary);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* --- Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª --- */
    .input-group { margin-bottom: 20px; }

    label {
        display: block;
        margin-bottom: 8px;
        color: var(--text-sub);
        font-size: 0.9rem;
        font-weight: 600;
    }

    input[type="text"], input[type="number"], select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid var(--border);
        border-radius: 12px;
        background: var(--bg-body);
        color: var(--text-main);
        font-size: 16px;
        transition: border-color 0.3s;
        appearance: none;
    }

    input:focus, select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
    }

    .preview-box {
        font-size: 0.8rem;
        color: var(--primary);
        margin-top: 6px;
        padding: 8px 12px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    /* --- Ø§Ù„Ù†Ø¬ÙˆÙ… ÙˆØ§Ù„Ù…Ù‡Ø§Ø±Ø§Øª --- */
    .grid-select {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
        gap: 8px;
    }

    .select-item {
        background: var(--bg-body);
        border: 2px solid var(--border);
        border-radius: 10px;
        padding: 10px 5px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 65px;
    }

    .select-item.selected {
        border-color: var(--primary);
        background: rgba(102, 126, 234, 0.15);
        color: var(--primary);
        transform: scale(1.05);
    }

    .select-item span { font-size: 1.2rem; display: block; margin-bottom: 4px; }
    .select-item small { font-size: 0.7rem; font-weight: bold; }

    /* --- Ø§Ù„Ø£Ø²Ø±Ø§Ø± --- */
    .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 25px;
    }

    button.btn-lg {
        width: 100%;
        padding: 16px;
        border: none;
        border-radius: 14px;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transition: transform 0.2s;
    }

    button.btn-lg:active { transform: scale(0.98); }

    .btn-primary { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; }
    .btn-secondary { background: var(--bg-card); color: var(--text-main); border: 2px solid var(--border); }
    .btn-success { background: var(--success); color: white; }

    /* --- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ --- */
    .type-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: bold;
        margin-bottom: 15px;
    }

    .type-badge.advantage {
        background: rgba(72, 187, 120, 0.2);
        color: var(--success);
        border: 2px solid var(--success);
    }

    .type-badge.disadvantage {
        background: rgba(245, 101, 101, 0.2);
        color: var(--danger);
        border: 2px solid var(--danger);
    }

    .type-badge.neutral {
        background: rgba(237, 137, 54, 0.2);
        color: var(--warning);
        border: 2px solid var(--warning);
    }

    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 15px;
    }

    .stat-box {
        background: var(--bg-body);
        padding: 15px;
        border-radius: 12px;
        text-align: center;
        border: 1px solid var(--border);
    }

    .stat-val { font-size: 1.3rem; font-weight: bold; color: var(--text-main); }
    .stat-lbl { font-size: 0.8rem; color: var(--text-sub); margin-top: 5px; }

    .battle-log {
        max-height: 300px;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        margin-top: 20px;
        padding: 10px;
        background: var(--bg-body);
        border-radius: 12px;
    }

    .log-entry {
        padding: 10px;
        margin-bottom: 8px;
        border-radius: 8px;
        border-right: 4px solid var(--primary);
        background: var(--bg-card);
        font-size: 0.85rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .log-entry.critical {
        border-right-color: var(--warning);
        background: rgba(237, 137, 54, 0.1);
    }

    .vs-badge {
        background: var(--text-sub);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin: -10px auto 10px;
        border: 4px solid var(--bg-card);
        position: relative;
        z-index: 2;
    }

    .chart-wrapper {
        height: 250px;
        position: relative;
        margin: 15px 0;
    }

    .saved-item {
        padding: 12px;
        margin-bottom: 10px;
        background: var(--bg-card);
        border: 2px solid var(--border);
        border-radius: 12px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.2s;
    }

    .saved-item:active {
        transform: scale(0.98);
        border-color: var(--primary);
    }

    .delete-btn {
        background: var(--danger);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 0.8rem;
        cursor: pointer;
    }

    .info-tooltip {
        display: inline-block;
        width: 18px;
        height: 18px;
        background: var(--primary);
        color: white;
        border-radius: 50%;
        text-align: center;
        line-height: 18px;
        font-size: 11px;
        margin-right: 5px;
        cursor: help;
    }

    .footer {
        background: linear-gradient(135deg, #2d3436 0%, #000000 100%);
        color: white;
        padding: 25px 15px;
        text-align: center;
        margin-top: 40px;
        border-top: 4px solid #ffd700;
    }

    .footer-avatar {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        border: 3px solid #ffd700;
        margin-bottom: 15px;
    }

    .footer h3 {
        color: #ffd700;
        font-size: 1.3rem;
        margin-bottom: 8px;
    }

    .footer p {
        color: #bbb;
        font-size: 0.85rem;
        margin: 4px 0;
    }
</style>
```

</head>
<body>

```
<div class="header">
    <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
    <h1>âš”ï¸ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„Ø£Ø®ÙŠØ±Ø© Pro Max</h1>
    <p style="opacity: 0.9; font-size: 0.85rem;">Ù…Ø­Ø§ÙƒÙŠ Ù‚ØªØ§Ù„ Ù…ØªÙ‚Ø¯Ù… v3.0 | Built by DistopÇa</p>
</div>

<div class="tabs-wrapper">
    <div class="tabs">
        <button class="tab active" onclick="switchTab('calculator')">ğŸ¯ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</button>
        <button class="tab" onclick="switchTab('compare')">âš”ï¸ Ù…Ù‚Ø§Ø±Ù†Ø©</button>
        <button class="tab" onclick="switchTab('saved')">ğŸ’¾ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</button>
        <button class="tab" onclick="switchTab('charts')">ğŸ“Š Ø§Ù„Ø±Ø³ÙˆÙ…</button>
    </div>
</div>

<div class="container">
    
    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø­Ø§Ø³Ø¨Ø© -->
    <div id="calculator" class="tab-content active">
        
        <div class="card">
            <h2>ğŸ—¡ï¸ Ø§Ù„Ù…Ù‡Ø§Ø¬Ù…</h2>
            
            <div class="input-group">
                <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                <select id="attackerType" onchange="updatePreview()">
                    <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø© (Tank)</option>
                    <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø© (Aircraft)</option>
                    <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ® (Missile)</option>
                </select>
            </div>

            <div class="input-group">
                <label>Ù‚ÙˆØ© Ø§Ù„Ù‡Ø¬ÙˆÙ…</label>
                <input type="text" id="attack" value="65.2K" inputmode="decimal" oninput="updatePreview()">
                <div class="preview-box">
                    <span>Ø§Ù„Ù‚ÙŠÙ…Ø©:</span>
                    <strong id="attackValue">65,200</strong>
                </div>
            </div>

            <div class="input-group">
                <label>
                    <span class="info-tooltip">â„¹</span>
                    Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø¬ÙˆÙ…
                </label>
                <div class="grid-select">
                    <div class="select-item selected" onclick="selectStars(0, this)">
                        <span>â­</span><small>+30%</small>
                    </div>
                    <div class="select-item" onclick="selectStars(1, this)">
                        <span>â­â­</span><small>+70%</small>
                    </div>
                    <div class="select-item" onclick="selectStars(2, this)">
                        <span>â­â­â­</span><small>+120%</small>
                    </div>
                    <div class="select-item" onclick="selectStars(3, this)">
                        <span>â­â­â­â­</span><small>+185%</small>
                    </div>
                    <div class="select-item" onclick="selectStars(4, this)">
                        <span>â­â­â­â­â­</span><small>+270%</small>
                    </div>
                </div>
            </div>

            <div class="input-group">
                <label>
                    <span class="info-tooltip">â„¹</span>
                    Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ø§Ø±Ø©
                </label>
                <div class="grid-select" style="grid-template-columns: repeat(3, 1fr);">
                    <div class="select-item selected" onclick="selectSkill(0, this)">
                        <span>âš”ï¸</span><small>Ø¹Ø§Ø¯ÙŠØ©<br>100%</small>
                    </div>
                    <div class="select-item" onclick="selectSkill(1, this)">
                        <span>ğŸ”¥</span><small>Ø®Ø§ØµØ©<br>345%</small>
                    </div>
                    <div class="select-item" onclick="selectSkill(2, this)">
                        <span>ğŸ’¥</span><small>Ù†Ù‡Ø§Ø¦ÙŠØ©<br>405%</small>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="input-group" style="margin:0;">
                    <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬ %</label>
                    <input type="number" id="critChance" value="20" inputmode="numeric" oninput="updatePreview()">
                    <div class="preview-box" style="margin-top: 8px;">
                        <span>1 Ù…Ù† ÙƒÙ„</span>
                        <strong id="critFreq">5</strong>
                    </div>
                </div>
                <div class="input-group" style="margin:0;">
                    <label>Ø¶Ø±Ø± Ø§Ù„Ø­Ø±Ø¬ %</label>
                    <input type="number" id="critDamage" value="150" inputmode="numeric" oninput="updatePreview()">
                    <div class="preview-box" style="margin-top: 8px;">
                        <span>Ù…Ø¶Ø§Ø¹Ù</span>
                        <strong id="critMulti">Ã—1.5</strong>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ›¡ï¸ Ø§Ù„Ù…Ø¯Ø§ÙØ¹</h2>
            
            <div class="input-group">
                <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                <select id="defenderType" onchange="updatePreview()">
                    <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø© (Tank)</option>
                    <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø© (Aircraft)</option>
                    <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ® (Missile)</option>
                </select>
            </div>
            
            <div class="input-group">
                <label>Ù†Ù‚Ø§Ø· Ø§Ù„ØµØ­Ø© (HP)</label>
                <input type="text" id="health" value="1.4M" inputmode="decimal" oninput="updatePreview()">
                <div class="preview-box">
                    <span>Ø§Ù„Ù‚ÙŠÙ…Ø©:</span>
                    <strong id="healthValue">1,400,000</strong>
                </div>
            </div>

            <div class="stats-grid">
                <div class="input-group" style="margin:0;">
                    <label>Ø§Ù„Ø¯ÙØ§Ø¹</label>
                    <input type="text" id="defense" value="8.4K" inputmode="decimal" oninput="updatePreview()">
                </div>
                <div class="input-group" style="margin:0;">
                    <label>Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© %</label>
                    <input type="number" id="resistance" value="10" inputmode="numeric">
                </div>
            </div>

            <div class="input-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <input type="text" id="calcName" placeholder="Ù…Ø«Ø§Ù„: Ø¯Ø¨Ø§Ø¨ØªÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
            </div>
        </div>

        <div id="typeAdvantagePreview" style="text-align: center; margin: 15px 0;"></div>

        <div class="action-buttons">
            <button class="btn-lg btn-primary" onclick="simulateBattle()">
                <span>ğŸ¯</span> Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©
            </button>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button class="btn-lg btn-secondary" onclick="saveCalculation()">ğŸ’¾ Ø­ÙØ¸</button>
                <button class="btn-lg btn-success" onclick="shareAsImage()">ğŸ“¸ ØµÙˆØ±Ø©</button>
            </div>
        </div>

        <div id="results" style="display: none; margin-top: 25px;"></div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© -->
    <div id="compare" class="tab-content">
        <div class="card">
            <h2>Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</h2>
            <div class="input-group">
                <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                <select id="comp1Type">
                    <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©</option>
                    <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø©</option>
                    <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ®</option>
                </select>
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ù‡Ø¬ÙˆÙ…</label>
                <input type="text" id="comp1Attack" value="65.2K">
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ù†Ø¬ÙˆÙ…</label>
                <select id="comp1Stars">
                    <option value="0">â­ +30%</option>
                    <option value="1">â­â­ +70%</option>
                    <option value="2">â­â­â­ +120%</option>
                    <option value="3">â­â­â­â­ +185%</option>
                    <option value="4">â­â­â­â­â­ +270%</option>
                </select>
            </div>
        </div>

        <div class="vs-badge">VS</div>

        <div class="card">
            <h2>Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</h2>
            <div class="input-group">
                <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                <select id="comp2Type">
                    <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©</option>
                    <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø©</option>
                    <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ®</option>
                </select>
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ù‡Ø¬ÙˆÙ…</label>
                <input type="text" id="comp2Attack" value="70K">
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ù†Ø¬ÙˆÙ…</label>
                <select id="comp2Stars">
                    <option value="0">â­ +30%</option>
                    <option value="1">â­â­ +70%</option>
                    <option value="2">â­â­â­ +120%</option>
                    <option value="3">â­â­â­â­ +185%</option>
                    <option value="4">â­â­â­â­â­ +270%</option>
                </select>
            </div>
        </div>

        <button class="btn-lg btn-primary" onclick="compareUnits()">ğŸ” Ù‚Ø§Ø±Ù† Ø§Ù„Ø¢Ù†</button>
        <div id="compareResults"></div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª -->
    <div id="saved" class="tab-content">
        <div class="card">
            <h2>ğŸ’¾ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h2>
            <div id="savedList"></div>
        </div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø±Ø³ÙˆÙ… -->
    <div id="charts" class="tab-content">
        <div class="card">
            <h2>ğŸ“Š Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h2>
            <div class="chart-wrapper">
                <canvas id="skillChart"></canvas>
            </div>
        </div>
        <div class="card">
            <h2>ğŸ“ˆ Ù…Ù†Ø­Ù†Ù‰ Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª</h2>
            <div class="chart-wrapper">
                <canvas id="upgradeChart"></canvas>
            </div>
        </div>
    </div>

</div>

<div class="footer">
    <img src="https://i.pinimg.com/736x/d0/f6/36/d0f636b1d0308c95b4ffcc75c3df88bc.jpg" alt="Jiraiya" class="footer-avatar">
    <h3>DistopÇa - 1930</h3>
    <p>ğŸ® Master Tactician</p>
    <p>âš”ï¸ Last War: Survival Game</p>
    <p style="margin-top: 10px; opacity: 0.7;">
        "Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ØªØ£ØªÙŠ Ù…Ù† Ø§Ù„ØªØ®Ø·ÙŠØ· ÙˆØ§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©"
    </p>
</div>
```

<script>
    // === Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ===
    let selectedStarLevel = 0;
    let selectedSkillType = 0;
    const starBonuses = [0.30, 0.70, 1.20, 1.85, 2.70];
    const skillMultipliers = [1.0, 3.45, 4.05]; // ØªÙ… ØªØµØ­ÙŠØ­ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù…Ù† 6.05 Ø¥Ù„Ù‰ 4.05
    const skillNames = ['Ø¹Ø§Ø¯ÙŠØ©', 'Ø®Ø§ØµØ©', 'Ù†Ù‡Ø§Ø¦ÙŠØ©'];
    let currentTheme = 'light';
    let skillChart, upgradeChart;

    // === Ù†Ø¸Ø§Ù… Type Advantage (ØµØ­ÙŠØ­ Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©) ===
    function getTypeAdvantage(attacker, defender) {
        const advantages = {
            'tank': 'missile',
            'plane': 'tank', 
            'missile': 'plane'
        };
        
        if (advantages[attacker] === defender) {
            return { modifier: 1.2, text: 'ØªÙÙˆÙ‚ Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©! +20% Ø¶Ø±Ø±', type: 'advantage' };
        } else if (advantages[defender] === attacker) {
            return { modifier: 0.8, text: 'Ø¶Ø¹Ù Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©! -20% Ø¶Ø±Ø±', type: 'disadvantage' };
        }
        return { modifier: 1.0, text: 'Ù„Ø§ Ù…ÙŠØ²Ø© Ø£Ùˆ Ø¶Ø¹Ù', type: 'neutral' };
    }

    // === Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ ===
    function parseValue(str) {
        if (!str) return 0;
        str = String(str).toUpperCase().trim();
        if (str.includes('M')) return parseFloat(str.replace('M', '')) * 1000000;
        if (str.includes('K')) return parseFloat(str.replace('K', '')) * 1000;
        return parseFloat(str.replace(/,/g, '')) || 0;
    }

    function formatNumber(num) { 
        return Math.round(num).toLocaleString('en-US'); 
    }
    
    function formatCompact(num) {
        num = Math.round(num);
        if (num >= 1000000) return (num / 1000000).toFixed(2) + 'M';
        if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
        return num.toString();
    }

    function getUnitIcon(type) {
        return { tank: 'ğŸŸ«', plane: 'âœˆï¸', missile: 'ğŸš€' }[type] || 'âš”ï¸';
    }

    // === Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙˆØ±ÙŠ ===
    function updatePreview() {
        const attack = parseValue(document.getElementById('attack').value);
        const health = parseValue(document.getElementById('health').value);
        const critChance = parseFloat(document.getElementById('critChance').value) || 0;
        const critDamage = parseFloat(document.getElementById('critDamage').value) || 100;
        
        document.getElementById('attackValue').textContent = formatNumber(attack);
        document.getElementById('healthValue').textContent = formatNumber(health);
        
        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¶Ø±Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬Ø©
        const critFreq = critChance > 0 ? Math.round(100 / critChance) : 'âˆ';
        document.getElementById('critFreq').textContent = critFreq;
        
        const critMulti = (critDamage / 100).toFixed(1);
        document.getElementById('critMulti').textContent = 'Ã—' + critMulti;
        
        // Ù…Ø¹Ø§ÙŠÙ†Ø© Type Advantage
        const attType = document.getElementById('attackerType').value;
        const defType = document.getElementById('defenderType').value;
        const typeInfo = getTypeAdvantage(attType, defType);
        
        const preview = document.getElementById('typeAdvantagePreview');
        preview.innerHTML = `
            <div class="type-badge ${typeInfo.type}">
                ${getUnitIcon(attType)} vs ${getUnitIcon(defType)} | ${typeInfo.text}
            </div>
        `;
    }

    // === Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª ===
    function selectStars(level, el) {
        selectedStarLevel = level;
        el.parentElement.querySelectorAll('.select-item').forEach(e => e.classList.remove('selected'));
        el.classList.add('selected');
    }

    function selectSkill(type, el) {
        selectedSkillType = type;
        el.parentElement.querySelectorAll('.select-item').forEach(e => e.classList.remove('selected'));
        el.classList.add('selected');
    }

    // === Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ===
    function switchTab(tabId) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        event.target.classList.add('active');
        document.getElementById(tabId).classList.add('active');
        event.target.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });

        if (tabId === 'saved') loadSaved();
        if (tabId === 'charts') updateCharts();
    }

    // === Dark Mode ===
    function toggleTheme() {
        currentTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', currentTheme);
        document.querySelector('.theme-toggle').textContent = currentTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        localStorage.setItem('theme', currentTheme);
        if(skillChart || upgradeChart) setTimeout(updateCharts, 100);
    }

    // === Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© ===
    function simulateBattle() {
        const attType = document.getElementById('attackerType').value;
        const defType = document.getElementById('defenderType').value;
        const attack = parseValue(document.getElementById('attack').value);
        const defense = parseValue(document.getElementById('defense').value);
        let health = parseValue(document.getElementById('health').value);
        const critChance = parseFloat(document.getElementById('critChance').value) / 100;
        const critDamage = parseFloat(document.getElementById('critDamage').value) / 100;
        const resistance = parseFloat(document.getElementById('resistance').value) / 100;

        if (attack <= 0 || health <= 0) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ… ØµØ­ÙŠØ­Ø©!');
            return;
        }

        // Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
        const typeInfo = getTypeAdvantage(attType, defType);
        const upgradeBonus = starBonuses[selectedStarLevel];
        const skillMultiplier = skillMultipliers[selectedSkillType];
        
        // Ø§Ù„Ø¶Ø±Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¨Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
        const baseDamage = (attack - defense) * (1 + upgradeBonus) * skillMultiplier * typeInfo.modifier * (1 - resistance);
        
        let turns = 0, totalDmg = 0, crits = 0;
        let logs = [];

        while (health > 0 && turns < 10000) {
            turns++;
            const isCrit = Math.random() < critChance;
            let dmg = Math.max(1, Math.round(isCrit ? baseDamage * critDamage : baseDamage));
            
            health -= dmg;
            totalDmg += dmg;
            if (isCrit) crits++;
            
            // Ø­ÙØ¸ ÙƒÙ„ Ø§Ù„Ø¶Ø±Ø¨Ø§Øª (Ø¢Ø®Ø± 100 ÙÙ‚Ø· Ù„Ù„Ø¹Ø±Ø¶)
            logs.push({ 
                turn: turns, 
                damage: dmg, 
                isCrit: isCrit, 
                health: Math.max(0, health) 
            });
        }

        displayResults(turns, crits, totalDmg, logs, typeInfo);
    }

    // === Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ===
    function displayResults(turns, crits, totalDmg, logs, typeInfo) {
        const avg = totalDmg / turns;
        const displayLogs = logs.length > 100 ? logs.slice(-100) : logs;
        
        const logHTML = displayLogs.map(log => `
            <div class="log-entry ${log.isCrit ? 'critical' : ''}">
                <span>
                    <strong>${log.isCrit ? 'ğŸ’¥' : 'âš”ï¸'} Ø§Ù„Ø¯ÙˆØ± ${log.turn}:</strong>
                    ${formatCompact(log.damage)} Ø¶Ø±Ø±
                </span>
                <span style="color: ${log.health === 0 ? 'var(--danger)' : 'var(--success)'};">
                    HP: ${formatCompact(log.health)}
                </span>
            </div>
        `).join('');

        const resultsHTML = `
            <div class="card" style="border-top: 4px solid var(--success);">
                <div style="text-align: center; margin-bottom: 15px;">
                    <div class="type-badge ${typeInfo.type}">
                        ${typeInfo.text}
                    </div>
                </div>
                
                <h3 style="text-align: center; margin-bottom: 15px;">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ø±ÙƒØ©</h3>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-val">${turns}</div>
                        <div class="stat-lbl">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-val">${formatCompact(totalDmg)}</div>
                        <div class="stat-lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¶Ø±Ø±</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-val">${crits}</div>
                        <div class="stat-lbl">Ø¶Ø±Ø¨Ø§Øª Ø­Ø±Ø¬Ø©</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-val">${formatCompact(avg)}</div>
                        <div class="stat-lbl">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¶Ø±Ø±</div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h4 style="margin-bottom: 10px; color: var(--text-sub);">
                        ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø±ÙƒØ© ${logs.length > 100 ? `(Ø¢Ø®Ø± 100 Ù…Ù† ${logs.length})` : ''}
                    </h4>
                    <div class="battle-log">${logHTML}</div>
                </div>
            </div>
        `;
        
        const resDiv = document.getElementById('results');
        resDiv.innerHTML = resultsHTML;
        resDiv.style.display = 'block';
        resDiv.scrollIntoView({ behavior: 'smooth' });
    }

    // === Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© ===
    function compareUnits() {
        const type1 = document.getElementById('comp1Type').value;
        const type2 = document.getElementById('comp2Type').value;
        const atk1 = parseValue(document.getElementById('comp1Attack').value);
        const atk2 = parseValue(document.getElementById('comp2Attack').value);
        const stars1 = parseInt(document.getElementById('comp1Stars').value);
        const stars2 = parseInt(document.getElementById('comp2Stars').value);

        const typeInfo = getTypeAdvantage(type1, type2);
        
        const power1 = atk1 * (1 + starBonuses[stars1]) * typeInfo.modifier;
        const power2 = atk2 * (1 + starBonuses[stars2]);
        
        const winner = power1 > power2 ? 'Ø§Ù„Ø£ÙˆÙ„Ù‰' : 'Ø§Ù„Ø«Ø§Ù†ÙŠØ©';
        const diff = Math.abs(power1 - power2);

        document.getElementById('compareResults').innerHTML = `
            <div class="card" style="margin-top: 20px; text-align: center;">
                <div class="type-badge ${typeInfo.type}">
                    ${getUnitIcon(type1)} vs ${getUnitIcon(type2)} | ${typeInfo.text}
                </div>
                
                <h3 style="margin: 15px 0;">ğŸ† Ø§Ù„ÙˆØ­Ø¯Ø© ${winner} Ø£Ù‚ÙˆÙ‰</h3>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-lbl">Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</div>
                        <div class="stat-val">${formatCompact(power1)}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-lbl">Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</div>
                        <div class="stat-val">${formatCompact(power2)}</div>
                    </div>
                </div>
                
                <p style="margin-top: 15px; color: var(--text-sub);">
                    Ø§Ù„ÙØ§Ø±Ù‚: <strong style="color: var(--primary);">${formatCompact(diff)}</strong> Ù†Ù‚Ø·Ø©
                </p>
            </div>
        `;
    }

    // === Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© ===
    function updateCharts() {
        const attack = parseValue(document.getElementById('attack').value) || 100;
        const defense = parseValue(document.getElementById('defense').value) || 0;
        const textColor = currentTheme === 'dark' ? '#cbd5e0' : '#4a5568';

        // Ø±Ø³Ù… Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª
        const ctx1 = document.getElementById('skillChart');
        if (skillChart) skillChart.destroy();
        
        const skillData = skillMultipliers.map(m => {
            const base = attack - defense;
            return Math.round(base * (1 + starBonuses[selectedStarLevel]) * m * 0.9);
        });

        skillChart = new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: ['âš”ï¸ Ø¹Ø§Ø¯ÙŠØ©', 'ğŸ”¥ Ø®Ø§ØµØ©', 'ğŸ’¥ Ù†Ù‡Ø§Ø¦ÙŠØ©'],
                datasets: [{
                    label: 'Ø§Ù„Ø¶Ø±Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹',
                    data: skillData,
                    backgroundColor: ['#667eea', '#ed64a6', '#ecc94b'],
                    borderRadius: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => formatCompact(context.parsed.y) + ' Ø¶Ø±Ø±'
                        }
                    }
                },
                scales: {
                    x: { ticks: { color: textColor, font: { size: 12 } } },
                    y: { ticks: { color: textColor, callback: (val) => formatCompact(val) } }
                }
            }
        });

        // Ø±Ø³Ù… Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª
        const ctx2 = document.getElementById('upgradeChart');
        if (upgradeChart) upgradeChart.destroy();
        
        const upgradeData = starBonuses.map(b => {
            const base = attack - defense;
            return Math.round(base * (1 + b) * skillMultipliers[1] * 0.9);
        });

        upgradeChart = new Chart(ctx2, {
            type: 'line',
            data: {
                labels: ['â­', 'â­â­', 'â­â­â­', 'â­â­â­â­', 'â­â­â­â­â­'],
                datasets: [{
                    label: 'Ù‚ÙˆØ© Ø§Ù„Ù‡Ø¬ÙˆÙ…',
                    data: upgradeData,
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 5,
                    pointHoverRadius: 7
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => formatCompact(context.parsed.y) + ' Ø¶Ø±Ø±'
                        }
                    }
                },
                scales: {
                    x: { ticks: { color: textColor, font: { size: 12 } } },
                    y: { ticks: { color: textColor, callback: (val) => formatCompact(val) } }
                }
            }
        });
    }

    // === Ø§Ù„Ø­ÙØ¸ ===
    function saveCalculation() {
        const name = document.getElementById('calcName').value || `Ø­Ø³Ø§Ø¨ ${new Date().toLocaleDateString('ar')}`;
        const data = {
            name,
            attType: document.getElementById('attackerType').value,
            defType: document.getElementById('defenderType').value,
            attack: document.getElementById('attack').value,
            defense: document.getElementById('defense').value,
            health: document.getElementById('health').value,
            stars: selectedStarLevel,
            skill: selectedSkillType,
            date: new Date().toLocaleDateString('ar')
        };

        let saved = JSON.parse(localStorage.getItem('warCalc_v3') || '[]');
        saved.unshift(data);
        saved = saved.slice(0, 20);
        localStorage.setItem('warCalc_v3', JSON.stringify(saved));
        alert('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!');
    }

    function loadSaved() {
        const saved = JSON.parse(localStorage.getItem('warCalc_v3') || '[]');
        const list = document.getElementById('savedList');
        
        if (saved.length === 0) {
            list.innerHTML = '<p style="text-align:center; padding: 30px; color: var(--text-sub);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</p>';
            return;
        }

        list.innerHTML = saved.map((item, idx) => `
            <div class="saved-item" onclick="loadCalc(${idx})">
                <div>
                    <div style="font-weight: bold; margin-bottom: 5px;">${item.name}</div>
                    <div style="font-size: 0.8rem; color: var(--text-sub);">
                        ${getUnitIcon(item.attType)} vs ${getUnitIcon(item.defType)} | 
                        ${item.attack} Ù‡Ø¬ÙˆÙ… | ${item.date}
                    </div>
                </div>
                <button class="delete-btn" onclick="event.stopPropagation(); deleteCalc(${idx})">ğŸ—‘ï¸</button>
            </div>
        `).join('');
    }

    function loadCalc(idx) {
        const saved = JSON.parse(localStorage.getItem('warCalc_v3') || '[]')[idx];
        if (!saved) return;
        
        document.getElementById('attackerType').value = saved.attType;
        document.getElementById('defenderType').value = saved.defType;
        document.getElementById('attack').value = saved.attack;
        document.getElementById('defense').value = saved.defense;
        document.getElementById('health').value = saved.health;
        
        selectStars(saved.stars, document.querySelectorAll('.select-item')[saved.stars]);
        selectSkill(saved.skill, document.querySelectorAll('.select-item')[5 + saved.skill]);
        
        switchTab('calculator');
        updatePreview();
    }

    function deleteCalc(idx) {
        if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ')) return;
        let saved = JSON.parse(localStorage.getItem('warCalc_v3') || '[]');
        saved.splice(idx, 1);
        localStorage.setItem('warCalc_v3', JSON.stringify(saved));
        loadSaved();
    }

    // === Ù…Ø´Ø§Ø±ÙƒØ© ÙƒØµÙˆØ±Ø© ===
    function shareAsImage() {
        const results = document.getElementById('results');
        if (!results || results.style.display === 'none') {
            alert('âš ï¸ ÙŠØ¬Ø¨ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø£ÙˆÙ„Ø§Ù‹!');
            return;
        }

        html2canvas(results, {
            backgroundColor: currentTheme === 'dark' ? '#2d3748' : '#ffffff',
            scale: 2
        }).then(canvas => {
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `war-calc-${Date.now()}.png`;
                a.click();
                URL.revokeObjectURL(url);
                alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©!');
            });
        });
    }

    // === Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ===
    document.addEventListener('DOMContentLoaded', () => {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ù…Ø­ÙÙˆØ¸
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            currentTheme = savedTheme;
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.querySelector('.theme-toggle').textContent = savedTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }
        
        updatePreview();
    });
</script>

</body>
</html>