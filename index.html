<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0b1e">
    <title>ØºØ±ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --bg-dark: #0a0b1e;
            --glass-bg: rgba(20, 30, 50, 0.75);
            --glass-border: rgba(255, 215, 0, 0.15);
            --primary-gold: #FFD700;
            --accent-red: #ff3333;
            --accent-blue: #3388ff;
            --text-main: #e0e0e0;
            --text-sec: #8899ab;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }

        body {
            background-color: var(--bg-dark);
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)),
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255, 215, 0, 0.03) 2px, rgba(255, 215, 0, 0.03) 4px),
                repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255, 215, 0, 0.03) 2px, rgba(255, 215, 0, 0.03) 4px);
            min-height: 100vh;
            color: var(--text-main);
            padding: 15px;
            overflow-x: hidden;
        }

        .container { max-width: 800px; margin: 0 auto; }

        /* Navigation */
        .tabs-nav {
            display: flex; gap: 5px; background: rgba(0,0,0,0.4);
            padding: 5px; border-radius: 12px; margin-bottom: 20px;
            border: 1px solid var(--glass-border);
        }
        .tab-btn {
            flex: 1; background: transparent; border: none; color: var(--text-sec);
            padding: 10px 5px; font-size: 0.85rem; font-weight: 700; cursor: pointer;
            border-radius: 8px; transition: 0.3s;
        }
        .tab-btn.active {
            background: rgba(255, 215, 0, 0.15); color: var(--primary-gold);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Cards */
        .glass-card {
            background: var(--glass-bg); backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px); border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 20px; margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .card-title {
            font-size: 1.2rem; font-weight: 800; margin-bottom: 15px;
            padding-bottom: 8px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--primary-gold); display: flex; align-items: center; gap: 10px;
        }

        /* Inputs & Groups */
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-size: 0.85rem; color: var(--text-sec); }
        input, select {
            width: 100%; background: rgba(0, 0, 0, 0.4); border: 1px solid var(--glass-border);
            color: #fff; padding: 12px; border-radius: 10px; font-size: 1rem;
        }
        .helper-text { font-size: 0.75rem; color: var(--primary-gold); margin-top: 5px; font-weight: 600; }

        /* Selectors */
        .grid-selector { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .selector-btn {
            background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
            border-radius: 8px; padding: 10px 2px; text-align: center; cursor: pointer;
        }
        .selector-btn.active {
            background: rgba(255, 215, 0, 0.2); border-color: var(--primary-gold); color: var(--primary-gold);
        }

        /* Actions */
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .action-btn {
            flex: 2; background: linear-gradient(90deg, #FFD700, #FFA500); color: #000;
            border: none; padding: 15px; border-radius: 12px; font-weight: 900; cursor: pointer;
        }
        .secondary-btn {
            flex: 1; background: rgba(255,255,255,0.1); color: #fff;
            border: 1px solid var(--glass-border); border-radius: 12px; cursor: pointer;
        }

        /* Battle Results */
        .log-container {
            max-height: 200px; overflow-y: auto; background: rgba(0,0,0,0.3);
            border-radius: 10px; padding: 10px; font-size: 0.8rem; border: 1px solid var(--glass-border);
        }
        .log-entry { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }

        .profile-footer { margin-top: 30px; text-align: center; opacity: 0.8; }
        .profile-img { width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--primary-gold); margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align:center; margin-bottom:20px;">
        <h1 style="color:var(--primary-gold); font-weight:900; letter-spacing:1px;">ØºØ±ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h1>
    </header>

    <nav class="tabs-nav">
        <button class="tab-btn active" onclick="switchTab('tab-calc')">ğŸ¯ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</button>
        <button class="tab-btn" onclick="switchTab('tab-compare')">âš–ï¸ Ù…Ù‚Ø§Ø±Ù†Ø©</button>
        <button class="tab-btn" onclick="switchTab('tab-saved')">ğŸ’¾ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</button>
        <button class="tab-btn" onclick="switchTab('tab-charts')">ğŸ“Š Ø§Ù„Ø±Ø³ÙˆÙ…</button>
    </nav>

    <div id="tab-calc" class="tab-content active">
        <div class="glass-card">
            <div class="card-title" style="color:var(--accent-red)">âš”ï¸ Ø§Ù„Ù‡Ø¬ÙˆÙ…</div>
            
            <div class="input-group">
                <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                <select id="attackerType">
                    <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©</option>
                    <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø©</option>
                    <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ®</option>
                </select>
            </div>

            <div class="input-group">
                <label>Ù‚ÙˆØ© Ø§Ù„Ù‡Ø¬ÙˆÙ… (ATK)</label>
                <input type="text" id="attack" value="65.2K">
            </div>

            <div class="input-group">
                <label>Ø§Ù„Ù†Ø¬ÙˆÙ…</label>
                <div class="grid-selector">
                    <div class="selector-btn active" onclick="setStar(0, this)">1â­</div>
                    <div class="selector-btn" onclick="setStar(1, this)">2â­</div>
                    <div class="selector-btn" onclick="setStar(2, this)">3â­</div>
                    <div class="selector-btn" onclick="setStar(3, this)">4â­</div>
                    <div class="selector-btn" onclick="setStar(4, this)">5â­</div>
                </div>
            </div>

            <div class="input-group">
                <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬Ø© (%)</label>
                <input type="number" id="critChance" value="20">
                <div class="helper-text" id="critChancePreview">Ø­ÙˆØ§Ù„ÙŠ 2 Ø¶Ø±Ø¨Ø§Øª Ù…Ù† ÙƒÙ„ 10 Ù‡ÙŠ Ø¶Ø±Ø¨Ø§Øª Ø­Ø±Ø¬Ø©</div>
            </div>

            <div class="input-group">
                <label>Ø¶Ø±Ø± Ø§Ù„Ø¶Ø±Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬Ø© (%)</label>
                <input type="number" id="critDamage" value="150">
                <div class="helper-text" id="critDmgPreview">Ø§Ù„Ø¶Ø±Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬Ø© ØªØ¹Ø§Ø¯Ù„ 1.50 Ù…Ø±Ø© Ù…Ù† Ø§Ù„Ø¶Ø±Ø¨Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©</div>
            </div>
        </div>

        <div class="glass-card">
            <div class="card-title" style="color:var(--accent-blue)">ğŸ›¡ï¸ Ø§Ù„Ø¯ÙØ§Ø¹</div>
            <div class="input-group">
                <label>ØµØ­Ø© Ø§Ù„Ø¹Ø¯Ùˆ (HP)</label>
                <input type="text" id="health" value="1.4M">
            </div>
            <div class="input-group">
                <label>Ø¯ÙØ§Ø¹ Ø§Ù„Ø¹Ø¯Ùˆ</label>
                <input type="text" id="defense" value="8.4K">
            </div>
            <div class="input-group">
                <label>Ø­ÙØ¸ Ø¨Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <input type="text" id="buildName" placeholder="Ø¯Ø¨Ø§Ø¨ØªÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
            </div>
        </div>

        <div class="btn-group">
            <button class="action-btn" onclick="simulate()">âš”ï¸ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©</button>
            <button class="secondary-btn" onclick="saveBuild()">ğŸ’¾ Ø­ÙØ¸</button>
        </div>

        <div id="resultsArea" class="glass-card" style="display:none; margin-top:20px; border-color:var(--primary-gold)">
            <h3 style="text-align:center; margin-bottom:15px;">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø´ØªØ¨Ø§Ùƒ</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; text-align:center; margin-bottom:15px;">
                <div style="background:rgba(0,0,0,0.3); padding:10px; border-radius:10px;">
                    <div style="font-size:0.7rem; color:var(--text-sec)">Ø§Ù„Ø¶Ø±Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                    <div id="resTotalDmg" style="font-weight:bold; color:var(--accent-red)">0</div>
                </div>
                <div style="background:rgba(0,0,0,0.3); padding:10px; border-radius:10px;">
                    <div style="font-size:0.7rem; color:var(--text-sec)">Ø§Ù„Ø¶Ø±Ø¨Ø§Øª</div>
                    <div id="resHits" style="font-weight:bold;">0</div>
                </div>
            </div>
            <div class="log-container" id="battleLog"></div>
            <button class="secondary-btn" style="width:100%; margin-top:15px;" onclick="exportImage()">ğŸ“¸ Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø©</button>
        </div>
    </div>

    <div id="tab-compare" class="tab-content">
        <div class="glass-card">
            <div class="card-title">âš–ï¸ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ÙˆØ­Ø¯Ø§Øª</div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div>
                    <label>Ù‡Ø¬ÙˆÙ… A</label>
                    <input type="text" id="comp1Attack" value="60K">
                </div>
                <div>
                    <label>Ù‡Ø¬ÙˆÙ… B</label>
                    <input type="text" id="comp2Attack" value="65K">
                </div>
            </div>
            <button class="action-btn" style="width:100%; margin-top:15px;" onclick="compareUnits()">Ù‚Ø§Ø±Ù† Ø§Ù„Ø¢Ù†</button>
            <div id="compareResults" style="margin-top:20px; text-align:center;"></div>
        </div>
    </div>

    <div id="tab-saved" class="tab-content">
        <div class="glass-card">
            <div class="card-title">ğŸ’¾ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</div>
            <div id="savedList" style="text-align:center; color:var(--text-sec)">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</div>
        </div>
    </div>

    <div id="tab-charts" class="tab-content">
        <div class="glass-card">
            <div class="card-title">ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†ÙŠ</div>
            <canvas id="skillChart"></canvas>
            <canvas id="upgradeChart" style="margin-top:20px;"></canvas>
        </div>
    </div>

    <footer class="profile-footer">
        <img src="https://i.pinimg.com/originals/d0/f6/36/d0f636b1d0308c95b4ffcc75c3df88bc.jpg" class="profile-img">
        <div style="font-weight:800; color:var(--primary-gold)">DistopÇa - 1930</div>
    </footer>
</div>

<script>
    const starBonuses = [0.30, 0.70, 1.20, 1.85, 2.70];
    let curStar = 0;
    let skillChartInstance = null;
    let upgradeChartInstance = null;

    // --- Logic for Critical Previews (Ø§Ù„Ù…Ø·Ù„ÙˆØ¨) ---
    document.getElementById('critChance').addEventListener('input', function() {
        let val = parseFloat(this.value) || 0;
        let hits = (val / 10).toFixed(1);
        document.getElementById('critChancePreview').innerText = `Ø­ÙˆØ§Ù„ÙŠ ${hits} Ø¶Ø±Ø¨Ø§Øª Ù…Ù† ÙƒÙ„ 10 Ù‡ÙŠ Ø¶Ø±Ø¨Ø§Øª Ø­Ø±Ø¬Ø©`;
    });

    document.getElementById('critDamage').addEventListener('input', function() {
        let val = parseFloat(this.value) || 0;
        let times = (val / 100).toFixed(2);
        document.getElementById('critDmgPreview').innerText = `Ø§Ù„Ø¶Ø±Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬Ø© ØªØ¹Ø§Ø¯Ù„ ${times} Ù…Ø±Ø© Ù…Ù† Ø§Ù„Ø¶Ø±Ø¨Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©`;
    });

    // --- Tab System ---
    function switchTab(id) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
        if(id === 'tab-charts') renderCharts();
        if(id === 'tab-saved') loadSavedBuilds();
    }

    function setStar(idx, el) {
        curStar = idx;
        document.querySelectorAll('.selector-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
    }

    // --- Helpers ---
    function parseK(val) {
        val = val.toString().toUpperCase().replace(/,/g, '');
        if(val.includes('M')) return parseFloat(val) * 1000000;
        if(val.includes('K')) return parseFloat(val) * 1000;
        return parseFloat(val) || 0;
    }
    function formatNum(n) { return new Intl.NumberFormat('en-US').format(Math.round(n)); }

    // --- Core Functions ---
    function simulate() {
        const atk = parseK(document.getElementById('attack').value);
        const hp = parseK(document.getElementById('health').value);
        const def = parseK(document.getElementById('defense').value);
        const critRate = parseFloat(document.getElementById('critChance').value) || 0;
        const critDmg = parseFloat(document.getElementById('critDamage').value) || 100;

        let baseDmg = (atk - def) * (1 + starBonuses[curStar]);
        if(baseDmg < 1) baseDmg = 1;

        let curHp = hp;
        let hits = 0;
        let totalDmg = 0;
        let log = '';

        while(curHp > 0 && hits < 500) {
            hits++;
            let isCrit = (Math.random() * 100) < critRate;
            let dmg = isCrit ? baseDmg * (critDmg/100) : baseDmg;
            dmg = Math.round(dmg);
            curHp -= dmg;
            totalDmg += dmg;
            log += `<div class="log-entry"><span>#${hits} ${isCrit?'ğŸ’¥':'âš”ï¸'}</span><span>-${formatNum(dmg)}</span><span style="color:#888">${curHp > 0 ? formatNum(curHp) : '0'}</span></div>`;
        }

        document.getElementById('resTotalDmg').innerText = formatNum(totalDmg);
        document.getElementById('resHits').innerText = hits;
        document.getElementById('battleLog').innerHTML = log;
        document.getElementById('resultsArea').style.display = 'block';
    }

    function saveBuild() {
        const name = document.getElementById('buildName').value || 'Ø³Ø¬Ù„ ØºÙŠØ± Ù…Ø³Ù…Ù‰';
        const build = { name, atk: document.getElementById('attack').value, date: new Date().toLocaleTimeString() };
        let saves = JSON.parse(localStorage.getItem('warSaves') || '[]');
        saves.unshift(build);
        localStorage.setItem('warSaves', JSON.stringify(saves.slice(0,10)));
        alert('ØªÙ… Ø§Ù„Ø­ÙØ¸!');
    }

    function loadSavedBuilds() {
        const list = document.getElementById('savedList');
        const saves = JSON.parse(localStorage.getItem('warSaves') || '[]');
        if(!saves.length) return;
        list.innerHTML = saves.map(s => `<div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:10px; margin-bottom:5px; text-align:right;">
            <b>${s.name}</b> <br> <small>${s.atk} - ${s.date}</small>
        </div>`).join('');
    }

    function compareUnits() {
        const d1 = parseK(document.getElementById('comp1Attack').value);
        const d2 = parseK(document.getElementById('comp2Attack').value);
        const diff = Math.abs(d1 - d2);
        document.getElementById('compareResults').innerHTML = `Ø§Ù„ÙØ§Ø±Ù‚: <b style="color:var(--primary-gold)">${formatNum(diff)}</b> <br> ${d1 > d2 ? 'Ø§Ù„ÙˆØ­Ø¯Ø© A Ø£Ù‚ÙˆÙ‰' : 'Ø§Ù„ÙˆØ­Ø¯Ø© B Ø£Ù‚ÙˆÙ‰'}`;
    }

    function renderCharts() {
        const atk = parseK(document.getElementById('attack').value);
        const ctx1 = document.getElementById('skillChart').getContext('2d');
        if(skillChartInstance) skillChartInstance.destroy();
        skillChartInstance = new Chart(ctx1, {
            type: 'bar',
            data: { labels: ['Ø¹Ø§Ø¯ÙŠØ©', 'Ø­Ø±Ø¬Ø©'], datasets: [{ label: 'Ù‚ÙˆØ© Ø§Ù„Ø¶Ø±Ø¨Ø©', data: [atk, atk*1.5], backgroundColor: ['#3388ff', '#FFD700'] }] },
            options: { plugins: { legend: { display: false } }, scales: { y: { grid: { color: '#222' } } } }
        });
    }

    function exportImage() {
        html2canvas(document.getElementById('resultsArea')).then(canvas => {
            const link = document.createElement('a');
            link.download = 'Battle_Report.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }
</script>
</body>
</html>
