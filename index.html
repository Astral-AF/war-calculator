<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0b1e">
    <title>ØºØ±ÙØ© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø±Ø¨ - Pro</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --bg-dark: #0a0b1e;
            --glass-bg: rgba(20, 30, 50, 0.75);
            --glass-border: rgba(255, 215, 0, 0.15);
            --primary-gold: #FFD700;
            --primary-glow: rgba(255, 215, 0, 0.4);
            --accent-red: #ff3333;
            --accent-blue: #3388ff;
            --text-main: #e0e0e0;
            --neon-glow: 0 0 10px rgba(255, 215, 0, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Cairo', sans-serif; }

        body {
            background-color: var(--bg-dark);
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)),
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255, 215, 0, 0.03) 2px, rgba(255, 215, 0, 0.03) 4px),
                repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255, 215, 0, 0.03) 2px, rgba(255, 215, 0, 0.03) 4px);
            background-size: 100% 100%, 100px 100px, 100px 100px;
            min-height: 100vh;
            color: var(--text-main);
            padding-bottom: 40px;
            overflow-x: hidden;
        }

        .container { max-width: 800px; margin: 0 auto; padding: 15px; padding-top: 20px; }

        /* Header */
        .header { text-align: center; margin-bottom: 25px; position: relative; }
        .header h1 {
            font-size: 2rem;
            background: linear-gradient(to bottom, #FFD700, #ca9a00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        /* Tabs System - Neon Style */
        .tabs-nav {
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 25px;
            border: 1px solid var(--glass-border);
        }
        
        .tab-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: #8899ab;
            padding: 12px 5px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            border-radius: 10px;
            transition: 0.3s;
        }

        .tab-btn.active {
            background: rgba(255, 215, 0, 0.15);
            color: var(--primary-gold);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.1) inset;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .tab-content { display: none; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Glass Cards */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-top: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .card-title {
            display: flex; align-items: center; gap: 10px;
            font-size: 1.3rem; font-weight: 800;
            margin-bottom: 15px; padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--primary-gold);
        }

        /* Form Elements */
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-size: 0.9rem; color: #b0c4de; }
        
        input, select {
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--glass-border);
            color: #fff;
            padding: 12px;
            border-radius: 10px;
            font-size: 1rem;
        }
        input:focus, select:focus { outline: none; border-color: var(--primary-gold); box-shadow: 0 0 10px var(--primary-glow); }

        /* Selectors (Stars/Skills) */
        .grid-selector { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .grid-selector-3 { grid-template-columns: repeat(3, 1fr); }
        
        .selector-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 10px 2px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
        }
        .selector-btn.active {
            background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2));
            border-color: var(--primary-gold);
            color: var(--primary-gold);
            box-shadow: 0 0 10px rgba(255,215,0,0.2);
        }

        /* Action Buttons */
        .btn-group { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        
        .action-btn {
            flex: 2;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            color: #000;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-weight: 900;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255,215,0,0.3);
            text-transform: uppercase;
        }
        
        .secondary-btn {
            flex: 1;
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Results Area */
        #resultsArea { display: none; margin-top: 20px; }
        .log-container {
            max-height: 250px; overflow-y: auto;
            background: rgba(0,0,0,0.3); padding: 10px;
            border-radius: 10px; border: 1px solid var(--glass-border);
            font-size: 0.85rem;
        }
        .log-entry { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .log-crit { color: #FFD700; }

        /* Saved Items */
        .saved-item {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.05); padding: 15px;
            margin-bottom: 10px; border-radius: 10px; border: 1px solid var(--glass-border);
            cursor: pointer; transition: 0.3s;
        }
        .saved-item:hover { border-color: var(--primary-gold); background: rgba(255,215,0,0.05); }

        /* Compare Grid */
        .vs-badge { text-align: center; font-size: 1.5rem; font-weight: 900; color: var(--accent-red); margin: 10px 0; }

        /* Profile */
        .profile-footer {
            margin-top: 40px; text-align: center; border-top: 1px solid var(--glass-border); padding-top: 20px;
        }
        .profile-img {
            width: 70px; height: 70px; border-radius: 50%; border: 3px solid var(--primary-gold);
            object-fit: cover; box-shadow: 0 0 15px rgba(255,215,0,0.3); margin-bottom: 10px;
        }

        /* Chart Canvas */
        canvas { max-height: 250px; }
    </style>
</head>
<body>

<svg style="display:none;">
    <symbol id="icon-sword" viewBox="0 0 24 24"><path fill="currentColor" d="M20.7,4.6L19.3,3.3C19,2.9 18.3,2.9 17.9,3.3L9,12.2L11.7,15L20.7,6C21.1,5.6 21.1,5 20.7,4.6M7,14.2L9.7,17L5,21.7L2.2,19L7,14.2M13,9.4L14.6,11L6.6,19H5V17.4L13,9.4Z"/></symbol>
    <symbol id="icon-shield" viewBox="0 0 24 24"><path fill="currentColor" d="M12,1L3,5V11C3,16.5 6.8,21.7 12,23C17.2,21.7 21,16.5 21,11V5L12,1Z"/></symbol>
</svg>

<div class="container">
    <header class="header">
        <h1>ØºØ±ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª PRO</h1>
        <p style="color:#8899ab; font-size:0.9rem;">Advanced Tactical Simulator</p>
    </header>

    <nav class="tabs-nav">
        <button class="tab-btn active" onclick="switchTab('tab-calc')">ğŸ¯ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</button>
        <button class="tab-btn" onclick="switchTab('tab-compare')">âš–ï¸ Ù…Ù‚Ø§Ø±Ù†Ø©</button>
        <button class="tab-btn" onclick="switchTab('tab-saved')">ğŸ’¾ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</button>
        <button class="tab-btn" onclick="switchTab('tab-charts')">ğŸ“Š Ø§Ù„Ø±Ø³ÙˆÙ…</button>
    </nav>

    <div id="tab-calc" class="tab-content active">
        <div class="glass-card">
            <div class="card-title" style="color:var(--accent-red)">
                <svg width="24" height="24"><use xlink:href="#icon-sword"/></svg> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‡Ø¬ÙˆÙ…
            </div>
            
            <div class="input-group">
                <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                <select id="attackerType">
                    <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø© (Tank)</option>
                    <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø© (Aircraft)</option>
                    <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ® (Missile)</option>
                </select>
            </div>

            <div class="input-group">
                <label>Ø§Ù„Ù‡Ø¬ÙˆÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label>
                <input type="text" id="attack" value="65.2K" placeholder="Example: 120K">
            </div>

            <div class="input-group">
                <label>Ø§Ù„Ù†Ø¬ÙˆÙ… (Ø§Ù„ØªØ±Ù‚ÙŠØ©)</label>
                <div class="grid-selector">
                    <div class="selector-btn active" onclick="setStar(0, this)">1â­</div>
                    <div class="selector-btn" onclick="setStar(1, this)">2â­</div>
                    <div class="selector-btn" onclick="setStar(2, this)">3â­</div>
                    <div class="selector-btn" onclick="setStar(3, this)">4â­</div>
                    <div class="selector-btn" onclick="setStar(4, this)">5â­</div>
                </div>
            </div>

            <div class="input-group">
                <label>Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</label>
                <div class="grid-selector grid-selector-3">
                    <div class="selector-btn active" onclick="setSkill(0, this)">Ø¹Ø§Ø¯ÙŠØ©</div>
                    <div class="selector-btn" onclick="setSkill(1, this)">Ø®Ø§ØµØ©</div>
                    <div class="selector-btn" onclick="setSkill(2, this)">Ù†Ù‡Ø§Ø¦ÙŠØ©</div>
                </div>
            </div>

            <div class="input-group" style="display:flex; gap:10px;">
                <div style="flex:1;">
                    <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬Ø© %</label>
                    <input type="number" id="critChance" value="20">
                </div>
                <div style="flex:1;">
                    <label>Ø¶Ø±Ø± Ø§Ù„Ø­Ø±Ø¬Ø© %</label>
                    <input type="number" id="critDamage" value="150">
                </div>
            </div>
        </div>

        <div class="glass-card">
            <div class="card-title" style="color:var(--accent-blue)">
                <svg width="24" height="24"><use xlink:href="#icon-shield"/></svg> Ø§Ù„Ø¹Ø¯Ùˆ
            </div>
            
            <div class="input-group">
                <label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¯Ùˆ</label>
                <select id="defenderType">
                    <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©</option>
                    <option value="plane">âœˆï¸ Ø·Ø§Ø¦Ø±Ø©</option>
                    <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ®</option>
                </select>
            </div>

            <div class="input-group">
                <label>Ø§Ù„ØµØ­Ø© (HP)</label>
                <input type="text" id="health" value="1.4M">
            </div>

            <div class="input-group">
                <label>Ø§Ù„Ø¯ÙØ§Ø¹</label>
                <input type="text" id="defense" value="8.4K">
            </div>

            <div class="input-group">
                <label>Ø­ÙØ¸ Ø¨Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <input type="text" id="buildName" placeholder="Ù…Ø«Ø§Ù„: Ø¯Ø¨Ø§Ø¨ØªÙŠ Ø§Ù„Ù‚ÙˆÙŠØ©">
            </div>
        </div>

        <div class="btn-group">
            <button class="action-btn" onclick="simulate()">âš”ï¸ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù…Ø¹Ø±ÙƒØ©</button>
            <button class="secondary-btn" onclick="saveBuild()">ğŸ’¾ Ø­ÙØ¸</button>
        </div>

        <div id="resultsArea" class="glass-card" style="border-color:var(--primary-gold)">
            <div class="card-title" style="justify-content:center;">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø´ØªØ¨Ø§Ùƒ</div>
            
            <div style="text-align:center; margin-bottom:15px;" id="typeResult"></div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; text-align:center; margin-bottom:15px;">
                <div style="background:rgba(0,0,0,0.3); padding:10px; border-radius:10px;">
                    <div style="font-size:0.8rem; color:#888">Ø§Ù„Ø¶Ø±Ø± Ø§Ù„ÙƒÙ„ÙŠ</div>
                    <div style="font-weight:bold; color:var(--accent-red); font-size:1.2rem;" id="resTotalDmg">0</div>
                </div>
                <div style="background:rgba(0,0,0,0.3); padding:10px; border-radius:10px;">
                    <div style="font-size:0.8rem; color:#888">Ø¹Ø¯Ø¯ Ø§Ù„Ø¶Ø±Ø¨Ø§Øª</div>
                    <div style="font-weight:bold; color:#fff; font-size:1.2rem;" id="resHits">0</div>
                </div>
            </div>
            
            <h4 style="color:#8899ab; margin-bottom:10px;">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©:</h4>
            <div class="log-container" id="battleLog"></div>

            <button class="secondary-btn" style="width:100%; margin-top:15px;" onclick="exportImage()">ğŸ“¸ Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø©</button>
        </div>
    </div>

    <div id="tab-compare" class="tab-content">
        <div class="glass-card">
            <h3 style="text-align:center; color:var(--text-main); margin-bottom:15px;">Ù…Ù‚Ø§Ø±Ù†Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</h3>
            
            <div style="border:1px solid var(--accent-blue); padding:10px; border-radius:10px; margin-bottom:10px;">
                <h4 style="color:var(--accent-blue)">Ø§Ù„ÙˆØ­Ø¯Ø© A</h4>
                <div class="input-group">
                    <label>Ø§Ù„Ù‡Ø¬ÙˆÙ…</label>
                    <input type="text" id="comp1Attack" value="65.2K">
                </div>
                <div class="input-group">
                    <label>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
                    <select id="comp1Stars">
                        <option value="0">1 Star (+30%)</option>
                        <option value="1">2 Stars (+70%)</option>
                        <option value="2">3 Stars (+120%)</option>
                        <option value="3">4 Stars (+185%)</option>
                        <option value="4">5 Stars (+270%)</option>
                    </select>
                </div>
            </div>

            <div class="vs-badge">VS</div>

            <div style="border:1px solid var(--accent-red); padding:10px; border-radius:10px; margin-bottom:20px;">
                <h4 style="color:var(--accent-red)">Ø§Ù„ÙˆØ­Ø¯Ø© B</h4>
                <div class="input-group">
                    <label>Ø§Ù„Ù‡Ø¬ÙˆÙ…</label>
                    <input type="text" id="comp2Attack" value="70K">
                </div>
                <div class="input-group">
                    <label>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
                    <select id="comp2Stars">
                        <option value="0">1 Star (+30%)</option>
                        <option value="1">2 Stars (+70%)</option>
                        <option value="2">3 Stars (+120%)</option>
                        <option value="3">4 Stars (+185%)</option>
                        <option value="4">5 Stars (+270%)</option>
                    </select>
                </div>
            </div>

            <button class="action-btn" onclick="compareUnits()">ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</button>
            <div id="compareResults" style="margin-top:20px; text-align:center;"></div>
        </div>
    </div>

    <div id="tab-saved" class="tab-content">
        <div class="glass-card">
            <h3 style="margin-bottom:20px; color:var(--primary-gold)">ğŸ’¾ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h3>
            <div id="savedList" style="text-align:center; color:#888;">
                Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ´ÙƒÙŠÙ„Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©
            </div>
        </div>
    </div>

    <div id="tab-charts" class="tab-content">
        <div class="glass-card">
            <h3 style="margin-bottom:15px;">ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¶Ø±Ø± (Ø­Ø³Ø¨ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª)</h3>
            <canvas id="skillChart"></canvas>
        </div>
        <div class="glass-card">
            <h3 style="margin-bottom:15px;">ğŸ“ˆ Ù…Ù†Ø­Ù†Ù‰ Ø§Ù„ØªØ·ÙˆØ± (Ø­Ø³Ø¨ Ø§Ù„Ù†Ø¬ÙˆÙ…)</h3>
            <canvas id="upgradeChart"></canvas>
        </div>
    </div>

    <div class="profile-footer">
        <img src="https://i.pinimg.com/originals/d0/f6/36/d0f636b1d0308c95b4ffcc75c3df88bc.jpg" alt="Profile" class="profile-img">
        <h3 style="color:var(--primary-gold)">DistopÇa - 1930</h3>
        <p style="color:#8899ab; letter-spacing:2px; font-size:0.8rem;">WAR ROOM COMMANDER</p>
    </div>
</div>

<script>
    // Variables
    const starBonuses = [0.30, 0.70, 1.20, 1.85, 2.70];
    const skillMultipliers = [1.0, 3.45, 6.05];
    let curStar = 0;
    let curSkill = 0;
    let skillChartInstance = null;
    let upgradeChartInstance = null;

    // --- UI Logic ---
    function switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        
        document.getElementById(tabId).classList.add('active');
        // Find button that triggered (approximate)
        const btns = document.querySelectorAll('.tab-btn');
        if(tabId === 'tab-calc') btns[0].classList.add('active');
        if(tabId === 'tab-compare') btns[1].classList.add('active');
        if(tabId === 'tab-saved') { btns[2].classList.add('active'); loadSavedBuilds(); }
        if(tabId === 'tab-charts') { btns[3].classList.add('active'); renderCharts(); }
    }

    function setStar(idx, el) {
        curStar = idx;
        document.querySelectorAll('#tab-calc .grid-selector:first-of-type .selector-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
    }

    function setSkill(idx, el) {
        curSkill = idx;
        document.querySelectorAll('#tab-calc .grid-selector-3 .selector-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
    }

    // --- Helper Functions ---
    function parseK(val) {
        if(!val) return 0;
        val = val.toString().toUpperCase().replace(/,/g, '');
        if(val.includes('M')) return parseFloat(val) * 1000000;
        if(val.includes('K')) return parseFloat(val) * 1000;
        return parseFloat(val) || 0;
    }
    function formatNum(n) { return new Intl.NumberFormat('en-US').format(Math.round(n)); }

    // --- Core Simulation ---
    function simulate() {
        const atk = parseK(document.getElementById('attack').value);
        const hp = parseK(document.getElementById('health').value);
        const def = parseK(document.getElementById('defense').value);
        const critRate = parseFloat(document.getElementById('critChance').value) || 0;
        const critDmg = parseFloat(document.getElementById('critDamage').value) || 150;

        // Type Logic
        const attType = document.getElementById('attackerType').value;
        const defType = document.getElementById('defenderType').value;
        let typeMod = 1.0;
        let typeText = "<span style='color:#888'>âš–ï¸ ØªÙƒØ§ÙØ¤</span>";

        if((attType=='tank'&&defType=='missile') || (attType=='plane'&&defType=='tank') || (attType=='missile'&&defType=='plane')) {
            typeMod = 1.2; typeText = "<span style='color:#4caf50'>ğŸ”¥ ØªÙÙˆÙ‚ (+20%)</span>";
        } else if((attType=='tank'&&defType=='plane') || (attType=='plane'&&defType=='missile') || (attType=='missile'&&defType=='tank')) {
            typeMod = 0.8; typeText = "<span style='color:#ff4444'>ğŸ›¡ï¸ Ø¶Ø¹Ù (-20%)</span>";
        }

        // Calc
        let base = (atk - def);
        if(base < 1) base = 1;
        base = base * (1 + starBonuses[curStar]) * skillMultipliers[curSkill] * typeMod;

        let curHp = hp;
        let totalDmg = 0;
        let hits = 0;
        let log = '';

        while(curHp > 0 && hits < 500) {
            hits++;
            let isCrit = (Math.random() * 100) < critRate;
            let dmg = base;
            if(isCrit) dmg *= (critDmg/100);
            
            curHp -= dmg;
            totalDmg += dmg;
            
            log += `<div class="log-entry">
                <span>#${hits} ${isCrit?'<span class="log-crit">ğŸ’¥</span>':'âš”ï¸'}</span>
                <span>${formatNum(dmg)}</span>
                <span style="color:${curHp>0?'var(--accent-red)':'#666'}">${curHp>0?formatNum(curHp):'DEAD'}</span>
            </div>`;
        }

        document.getElementById('typeResult').innerHTML = typeText;
        document.getElementById('resTotalDmg').innerText = formatNum(totalDmg);
        document.getElementById('resHits').innerText = hits;
        document.getElementById('battleLog').innerHTML = log;
        document.getElementById('resultsArea').style.display = 'block';
        document.getElementById('resultsArea').scrollIntoView({behavior:'smooth'});
    }

    // --- Save/Load System ---
    function saveBuild() {
        const name = document.getElementById('buildName').value || 'Unamed Build';
        const build = {
            name,
            atk: document.getElementById('attack').value,
            hp: document.getElementById('health').value,
            def: document.getElementById('defense').value,
            star: curStar,
            skill: curSkill,
            date: new Date().toLocaleTimeString()
        };
        
        let saves = JSON.parse(localStorage.getItem('warRoomSaves') || '[]');
        saves.unshift(build);
        localStorage.setItem('warRoomSaves', JSON.stringify(saves));
        alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        loadSavedBuilds();
    }

    function loadSavedBuilds() {
        const list = document.getElementById('savedList');
        const saves = JSON.parse(localStorage.getItem('warRoomSaves') || '[]');
        
        if(saves.length === 0) { list.innerHTML = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­ÙÙˆØ¸Ø§Øª'; return; }
        
        list.innerHTML = saves.map((s, i) => `
            <div class="saved-item" onclick="loadBuild(${i})">
                <div style="text-align:right">
                    <div style="color:var(--primary-gold); font-weight:bold">${s.name}</div>
                    <div style="font-size:0.8rem; color:#888">${s.date} | ATK: ${s.atk}</div>
                </div>
                <button onclick="event.stopPropagation(); deleteBuild(${i})" style="background:red; border:none; color:white; padding:5px; border-radius:5px;">ğŸ—‘ï¸</button>
            </div>
        `).join('');
    }

    function loadBuild(i) {
        const saves = JSON.parse(localStorage.getItem('warRoomSaves'));
        const s = saves[i];
        
        document.getElementById('attack').value = s.atk;
        document.getElementById('health').value = s.hp;
        document.getElementById('defense').value = s.def;
        
        // Trigger stars/skills UI
        const starBtns = document.querySelectorAll('#tab-calc .grid-selector:first-of-type .selector-btn');
        const skillBtns = document.querySelectorAll('#tab-calc .grid-selector-3 .selector-btn');
        setStar(s.star, starBtns[s.star]);
        setSkill(s.skill, skillBtns[s.skill]);
        
        switchTab('tab-calc');
    }

    function deleteBuild(i) {
        if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ')) return;
        let saves = JSON.parse(localStorage.getItem('warRoomSaves'));
        saves.splice(i, 1);
        localStorage.setItem('warRoomSaves', JSON.stringify(saves));
        loadSavedBuilds();
    }

    // --- Comparison Logic ---
    function compareUnits() {
        const a1 = parseK(document.getElementById('comp1Attack').value);
        const s1 = parseInt(document.getElementById('comp1Stars').value);
        const a2 = parseK(document.getElementById('comp2Attack').value);
        const s2 = parseInt(document.getElementById('comp2Stars').value);
        
        const dmg1 = a1 * (1 + starBonuses[s1]);
        const dmg2 = a2 * (1 + starBonuses[s2]);
        
        let winner = dmg1 > dmg2 ? "Ø§Ù„ÙˆØ­Ø¯Ø© A Ø£Ù‚ÙˆÙ‰" : "Ø§Ù„ÙˆØ­Ø¯Ø© B Ø£Ù‚ÙˆÙ‰";
        let color = dmg1 > dmg2 ? "var(--accent-blue)" : "var(--accent-red)";
        
        document.getElementById('compareResults').innerHTML = `
            <div style="font-size:1.2rem; font-weight:bold; color:${color}">${winner}</div>
            <div style="font-size:0.9rem; color:#888; margin-top:5px;">
                Ù‚ÙˆØ© A Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${formatNum(dmg1)}<br>
                Ù‚ÙˆØ© B Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${formatNum(dmg2)}
            </div>
        `;
    }

    // --- Charts Logic ---
    function renderCharts() {
        const atk = parseK(document.getElementById('attack').value) || 10000;
        
        // Skill Chart
        const ctx1 = document.getElementById('skillChart').getContext('2d');
        if(skillChartInstance) skillChartInstance.destroy();
        
        skillChartInstance = new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: ['Ø¹Ø§Ø¯ÙŠØ©', 'Ø®Ø§ØµØ©', 'Ù†Ù‡Ø§Ø¦ÙŠØ©'],
                datasets: [{
                    label: 'Ø§Ù„Ø¶Ø±Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹',
                    data: skillMultipliers.map(m => atk * m),
                    backgroundColor: ['#8899ab', '#3388ff', '#FFD700'],
                    borderColor: 'rgba(255,255,255,0.1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                    x: { ticks: { color: '#fff' } }
                }
            }
        });

        // Upgrade Chart
        const ctx2 = document.getElementById('upgradeChart').getContext('2d');
        if(upgradeChartInstance) upgradeChartInstance.destroy();
        
        upgradeChartInstance = new Chart(ctx2, {
            type: 'line',
            data: {
                labels: ['1â­', '2â­', '3â­', '4â­', '5â­'],
                datasets: [{
                    label: 'ØªØ·ÙˆØ± Ø§Ù„Ø¶Ø±Ø±',
                    data: starBonuses.map(b => atk * (1+b)),
                    borderColor: '#FFD700',
                    backgroundColor: 'rgba(255, 215, 0, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                    x: { ticks: { color: '#fff' } }
                }
            }
        });
    }

    // --- Export Image ---
    function exportImage() {
        const el = document.getElementById('resultsArea');
        html2canvas(el, {
            backgroundColor: '#0a0b1e',
            scale: 2
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'Battle_Report.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }
</script>

</body>
</html>
