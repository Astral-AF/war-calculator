<!DOCTYPE html>

<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Pro">
    <meta name="theme-color" content="#667eea">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„Ø£Ø®ÙŠØ±Ø© Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --bg-primary: #667eea;
            --bg-secondary: #764ba2;
            --bg-card: #f8f9fa;
            --text-primary: #333;
            --text-secondary: #555;
            --border-color: #ddd;
            --shadow: rgba(0,0,0,0.1);
        }

```
    [data-theme="dark"] {
        --bg-primary: #1a1a2e;
        --bg-secondary: #16213e;
        --bg-card: #0f3460;
        --text-primary: #eee;
        --text-secondary: #bbb;
        --border-color: #2a3f5f;
        --shadow: rgba(0,0,0,0.3);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
        min-height: 100vh;
        padding: 15px;
        overflow-x: hidden;
        scroll-behavior: smooth;
        transition: all 0.3s ease;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        background: var(--bg-card);
        border-radius: 20px;
        box-shadow: 0 20px 60px var(--shadow);
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .header {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 25px;
        text-align: center;
        position: relative;
    }

    .header h1 {
        font-size: 2em;
        margin-bottom: 8px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .header .version {
        font-size: 0.9em;
        opacity: 0.9;
    }

    .theme-toggle {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(255,255,255,0.2);
        border: 2px solid white;
        border-radius: 50px;
        padding: 8px 15px;
        cursor: pointer;
        font-size: 1.2em;
        transition: all 0.3s;
    }

    .theme-toggle:hover {
        background: rgba(255,255,255,0.3);
        transform: scale(1.1);
    }

    .tabs {
        display: flex;
        background: var(--bg-card);
        border-bottom: 2px solid var(--border-color);
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    .tab {
        flex: 1;
        min-width: 120px;
        padding: 15px 20px;
        text-align: center;
        background: transparent;
        border: none;
        color: var(--text-secondary);
        font-size: 0.95em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        border-bottom: 3px solid transparent;
    }

    .tab:hover {
        background: rgba(102, 126, 234, 0.1);
    }

    .tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
        background: rgba(102, 126, 234, 0.1);
    }

    .tab-content {
        display: none;
        padding: 25px;
        animation: fadeIn 0.3s;
    }

    .tab-content.active {
        display: block;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
    }

    .card {
        background: var(--bg-card);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 6px var(--shadow);
        border: 1px solid var(--border-color);
        transition: all 0.3s;
    }

    .card h2 {
        color: var(--text-primary);
        margin-bottom: 18px;
        padding-bottom: 10px;
        border-bottom: 3px solid #667eea;
        font-size: 1.3em;
    }

    .input-group {
        margin-bottom: 18px;
    }

    label {
        display: block;
        margin-bottom: 8px;
        color: var(--text-secondary);
        font-weight: 600;
        font-size: 0.9em;
    }

    input[type="text"], input[type="number"], select {
        width: 100%;
        padding: 12px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        font-size: 16px;
        background: var(--bg-card);
        color: var(--text-primary);
        transition: all 0.3s;
    }

    input:focus, select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .star-selector {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .star-option {
        flex: 1;
        min-width: calc(20% - 8px);
        padding: 10px 5px;
        background: var(--bg-card);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s;
        min-height: 65px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .star-option:hover {
        border-color: #667eea;
        transform: translateY(-2px);
    }

    .star-option.selected {
        background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
        border-color: #ffd700;
        color: #333;
        font-weight: bold;
    }

    .skill-type-selector {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }

    .skill-type-btn {
        padding: 12px;
        background: var(--bg-card);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s;
        min-height: 70px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        color: var(--text-primary);
    }

    .skill-type-btn:hover {
        border-color: #667eea;
    }

    .skill-type-btn.selected {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
        font-weight: bold;
    }

    .preview-box {
        background: rgba(102, 126, 234, 0.1);
        padding: 10px;
        border-radius: 8px;
        margin-top: 8px;
        border: 2px dashed #667eea;
        font-size: 0.85em;
        color: var(--text-primary);
    }

    .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    button {
        flex: 1;
        min-width: 150px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 25px;
        font-size: 1.1em;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        font-weight: bold;
        touch-action: manipulation;
    }

    button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    button.secondary {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    button.success {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }

    .saved-calculations {
        max-height: 300px;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    .saved-item {
        padding: 12px;
        margin-bottom: 10px;
        background: var(--bg-card);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .saved-item:hover {
        border-color: #667eea;
        transform: translateX(-5px);
    }

    .saved-item-name {
        font-weight: bold;
        color: var(--text-primary);
    }

    .saved-item-details {
        font-size: 0.85em;
        color: var(--text-secondary);
    }

    .delete-btn {
        background: #dc3545;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.85em;
    }

    .chart-container {
        position: relative;
        height: 300px;
        margin: 20px 0;
        padding: 15px;
        background: var(--bg-card);
        border-radius: 10px;
        border: 1px solid var(--border-color);
    }

    .comparison-grid {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 20px;
        align-items: center;
    }

    .vs-divider {
        font-size: 2em;
        font-weight: bold;
        color: #667eea;
        text-align: center;
    }

    .result-card {
        background: var(--bg-card);
        border-radius: 15px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 4px 6px var(--shadow);
        border: 1px solid var(--border-color);
    }

    .result-card h3, .result-card h4 {
        color: var(--text-primary);
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 12px;
        margin: 15px 0;
    }

    .stat-item {
        background: rgba(255, 255, 255, 0.9);
        padding: 12px;
        border-radius: 8px;
        text-align: center;
        border: 1px solid var(--border-color);
    }

    [data-theme="dark"] .stat-item {
        background: rgba(15, 52, 96, 0.6);
        color: var(--text-primary);
    }

    .stat-label {
        color: #666;
        font-size: 0.85em;
        margin-bottom: 5px;
    }

    [data-theme="dark"] .stat-label {
        color: #bbb;
    }

    .stat-value {
        color: #333;
        font-size: 1.3em;
        font-weight: bold;
    }

    [data-theme="dark"] .stat-value {
        color: #fff;
    }

    .footer {
        background: linear-gradient(135deg, #2d3436 0%, #000000 100%);
        color: white;
        padding: 25px;
        text-align: center;
        border-top: 4px solid #ffd700;
    }

    .footer-content {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
    }

    .footer-avatar {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        border: 3px solid #ffd700;
        box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        object-fit: cover;
    }

    .footer-text h3 {
        font-size: 1.3em;
        margin-bottom: 5px;
        color: #ffd700;
    }

    .footer-text p {
        font-size: 0.85em;
        color: #bbb;
        margin: 3px 0;
    }

    @media (max-width: 768px) {
        .main-content {
            grid-template-columns: 1fr;
        }
        
        .comparison-grid {
            grid-template-columns: 1fr;
        }
        
        .vs-divider {
            transform: rotate(90deg);
            margin: 10px 0;
        }

        .tabs {
            font-size: 0.85em;
        }

        .tab {
            min-width: 90px;
            padding: 12px 10px;
        }

        .star-option {
            min-width: calc(33.333% - 6px);
        }

        .skill-type-selector {
            grid-template-columns: 1fr;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
            <h1>âš”ï¸ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„Ø£Ø®ÙŠØ±Ø© Pro âš”ï¸</h1>
            <p class="version">Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø·ÙˆØ±Ø© 2.0 | Advanced Combat Simulator</p>
        </div>

```
    <div class="tabs">
        <button class="tab active" onclick="switchTab('calculator')">ğŸ¯ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</button>
        <button class="tab" onclick="switchTab('compare')">âš”ï¸ Ù…Ù‚Ø§Ø±Ù†Ø©</button>
        <button class="tab" onclick="switchTab('saved')">ğŸ’¾ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª</button>
        <button class="tab" onclick="switchTab('charts')">ğŸ“Š Ø§Ù„Ø±Ø³ÙˆÙ…</button>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø­Ø§Ø³Ø¨Ø© -->
    <div id="calculator" class="tab-content active">
        <div class="main-content">
            <div class="card">
                <h2>ğŸ—¡ï¸ Ø§Ù„Ù…Ù‡Ø§Ø¬Ù…</h2>
                
                <div class="input-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©:</label>
                    <select id="attackerType" onchange="updatePreview()">
                        <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©</option>
                        <option value="plane">âœˆï¸ Ø·ÙŠØ§Ø±Ø©</option>
                        <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ®</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Ù‚ÙˆØ© Ø§Ù„Ù‡Ø¬ÙˆÙ…:</label>
                    <input type="text" id="attack" value="65.2K" oninput="updatePreview()">
                    <div class="preview-box">Ø§Ù„Ù‚ÙŠÙ…Ø©: <strong id="attackValue">65,200</strong></div>
                </div>

                <div class="input-group">
                    <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ±Ù‚ÙŠØ©:</label>
                    <div class="star-selector">
                        <div class="star-option selected" onclick="selectStars(0, this)">
                            <div>â­</div>
                            <small>+30%</small>
                        </div>
                        <div class="star-option" onclick="selectStars(1, this)">
                            <div>â­â­</div>
                            <small>+70%</small>
                        </div>
                        <div class="star-option" onclick="selectStars(2, this)">
                            <div>â­â­â­</div>
                            <small>+120%</small>
                        </div>
                        <div class="star-option" onclick="selectStars(3, this)">
                            <div>â­â­â­â­</div>
                            <small>+185%</small>
                        </div>
                        <div class="star-option" onclick="selectStars(4, this)">
                            <div>â­â­â­â­â­</div>
                            <small>+270%</small>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ø§Ø±Ø©:</label>
                    <div class="skill-type-selector">
                        <div class="skill-type-btn selected" onclick="selectSkill(0, this)">
                            âš”ï¸ Ø¹Ø§Ø¯ÙŠØ©<br><strong>100%</strong>
                        </div>
                        <div class="skill-type-btn" onclick="selectSkill(1, this)">
                            ğŸ”¥ Ø®Ø§ØµØ©<br><strong>345%</strong>
                        </div>
                        <div class="skill-type-btn" onclick="selectSkill(2, this)">
                            ğŸ’¥ Ù†Ù‡Ø§Ø¦ÙŠØ©<br><strong>605%</strong>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬Ø© (%):</label>
                    <input type="number" id="critChance" value="20" min="0" max="100" oninput="updatePreview()">
                    <div class="preview-box">ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ <strong>1</strong> Ù…Ù† ÙƒÙ„ <strong id="critFreq">5</strong> Ø¶Ø±Ø¨Ø§Øª</div>
                </div>

                <div class="input-group">
                    <label>Ø¶Ø±Ø± Ø§Ù„Ø¶Ø±Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬Ø© (%):</label>
                    <input type="number" id="critDamage" value="150" min="100" max="500" oninput="updatePreview()">
                    <div class="preview-box">Ù…Ø¶Ø§Ø¹Ù: <strong id="critMulti">Ã—1.5</strong></div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ›¡ï¸ Ø§Ù„Ù…Ø¯Ø§ÙØ¹</h2>
                
                <div class="input-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ­Ø¯Ø©:</label>
                    <select id="defenderType" onchange="updatePreview()">
                        <option value="tank">ğŸŸ« Ø¯Ø¨Ø§Ø¨Ø©</option>
                        <option value="plane">âœˆï¸ Ø·ÙŠØ§Ø±Ø©</option>
                        <option value="missile">ğŸš€ ØµØ§Ø±ÙˆØ®</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Ù†Ù‚Ø§Ø· Ø§Ù„ØµØ­Ø©:</label>
                    <input type="text" id="health" value="1.4M" oninput="updatePreview()">
                    <div class="preview-box">Ø§Ù„Ù‚ÙŠÙ…Ø©: <strong id="healthValue">1,400,000</strong></div>
                </div>

                <div class="input-group">
                    <label>Ù‚ÙˆØ© Ø§Ù„Ø¯ÙØ§Ø¹:</label>
                    <input type="text" id="defense" value="8.4K" oninput="updatePreview()">
                    <div class="preview-box">Ø§Ù„Ù‚ÙŠÙ…Ø©: <strong id="defenseValue">8,400</strong></div>
                </div>

                <div class="input-group">
                    <label>Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© (%):</label>
                    <input type="number" id="resistance" value="10" min="0" max="100">
                </div>

                <div class="input-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                    <input type="text" id="calcName" placeholder="Ù…Ø«Ø§Ù„: Ø¯Ø¨Ø§Ø¨ØªÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button onclick="simulateBattle()">ğŸ¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©</button>
            <button class="secondary" onclick="saveCalculation()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
            <button class="success" onclick="shareAsImage()">ğŸ“¸ Ø­ÙØ¸ ÙƒØµÙˆØ±Ø©</button>
        </div>

        <div id="results" style="display: none;"></div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© -->
    <div id="compare" class="tab-content">
        <h2 style="text-align: center; color: var(--text-primary); margin-bottom: 20px;">âš”ï¸ Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ† ÙˆØ­Ø¯ØªÙŠÙ† âš”ï¸</h2>
        <div class="comparison-grid">
            <div class="card">
                <h3 style="color: var(--text-primary);">Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</h3>
                <div class="input-group">
                    <label>Ø§Ù„Ù‡Ø¬ÙˆÙ…:</label>
                    <input type="text" id="comp1Attack" value="65.2K">
                </div>
                <div class="input-group">
                    <label>Ø§Ù„ØªØ±Ù‚ÙŠØ©:</label>
                    <select id="comp1Stars">
                        <option value="0">â­ (+30%)</option>
                        <option value="1">â­â­ (+70%)</option>
                        <option value="2">â­â­â­ (+120%)</option>
                        <option value="3">â­â­â­â­ (+185%)</option>
                        <option value="4">â­â­â­â­â­ (+270%)</option>
                    </select>
                </div>
            </div>

            <div class="vs-divider">VS</div>

            <div class="card">
                <h3 style="color: var(--text-primary);">Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</h3>
                <div class="input-group">
                    <label>Ø§Ù„Ù‡Ø¬ÙˆÙ…:</label>
                    <input type="text" id="comp2Attack" value="70K">
                </div>
                <div class="input-group">
                    <label>Ø§Ù„ØªØ±Ù‚ÙŠØ©:</label>
                    <select id="comp2Stars">
                        <option value="0">â­ (+30%)</option>
                        <option value="1">â­â­ (+70%)</option>
                        <option value="2">â­â­â­ (+120%)</option>
                        <option value="3">â­â­â­â­ (+185%)</option>
                        <option value="4">â­â­â­â­â­ (+270%)</option>
                    </select>
                </div>
            </div>
        </div>
        <div style="text-align: center; margin-top: 20px;">
            <button onclick="compareUnits()">ğŸ” Ù‚Ø§Ø±Ù† Ø§Ù„Ø¢Ù†</button>
        </div>
        <div id="compareResults"></div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª -->
    <div id="saved" class="tab-content">
        <h2 style="color: var(--text-primary);">ğŸ’¾ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h2>
        <div class="saved-calculations" id="savedList">
            <p style="text-align: center; color: var(--text-secondary); padding: 40px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯</p>
        </div>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø±Ø³ÙˆÙ… -->
    <div id="charts" class="tab-content">
        <h2 style="color: var(--text-primary);">ğŸ“Š Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©</h2>
        <div class="card">
            <h3 style="color: var(--text-primary);">Ù…Ù‚Ø§Ø±Ù†Ø© Ø¶Ø±Ø± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h3>
            <div class="chart-container">
                <canvas id="skillChart"></canvas>
            </div>
        </div>
        <div class="card" style="margin-top: 20px;">
            <h3 style="color: var(--text-primary);">ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¶Ø±Ø±</h3>
            <div class="chart-container">
                <canvas id="upgradeChart"></canvas>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="footer-content">
            <img src="https://i.pinimg.com/736x/d0/f6/36/d0f636b1d0308c95b4ffcc75c3df88bc.jpg" alt="Jiraiya" class="footer-avatar">
            <div class="footer-text">
                <h3>DistopÇa - 1930</h3>
                <p>ğŸ® Master Tactician</p>
                <p>âš”ï¸ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„Ø£Ø®ÙŠØ±Ø©</p>
            </div>
        </div>
    </div>
</div>

<script>
    let selectedStarLevel = 0;
    let selectedSkillType = 0;
    const starBonuses = [0.30, 0.70, 1.20, 1.85, 2.70];
    const skillMultipliers = [1.0, 3.45, 6.05];
    const skillNames = ['Ø¹Ø§Ø¯ÙŠØ©', 'Ø®Ø§ØµØ©', 'Ù†Ù‡Ø§Ø¦ÙŠØ©'];
    let currentTheme = 'light';
    let skillChart, upgradeChart;

    function parseValue(str) {
        if (!str) return 0;
        str = String(str).toUpperCase().trim();
        if (str.includes('M')) return parseFloat(str.replace('M', '')) * 1000000;
        if (str.includes('K')) return parseFloat(str.replace('K', '')) * 1000;
        return parseFloat(str.replace(/,/g, '')) || 0;
    }

    function formatNumber(num) {
        return num.toLocaleString('en-US');
    }

    function formatValue(num) {
        if (num >= 1000000) return (num / 1000000).toFixed(2) + 'M';
        if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
        return num.toString();
    }

    function selectStars(level, element) {
        selectedStarLevel = level;
        document.querySelectorAll('.star-option').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
        updatePreview();
    }

    function selectSkill(type, element) {
        selectedSkillType = type;
        document.querySelectorAll('.skill-type-btn').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
        updatePreview();
    }

    function updatePreview() {
        const attack = parseValue(document.getElementById('attack').value);
        const defense = parseValue(document.getElementById('defense').value);
        const health = parseValue(document.getElementById('health').value);
        const critChance = parseFloat(document.getElementById('critChance').value) || 0;
        const critDamage = parseFloat(document.getElementById('critDamage').value) || 100;

        document.getElementById('attackValue').textContent = formatNumber(attack);
        document.getElementById('defenseValue').textContent = formatNumber(defense);
        document.getElementById('healthValue').textContent = formatNumber(health);
        
        // ØªØ­Ø¯ÙŠØ« ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¶Ø±Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬Ø©
        const critFreq = critChance > 0 ? Math.round(100 / critChance) : 'âˆ';
        document.getElementById('critFreq').textContent = critFreq;
        
        // ØªØ­Ø¯ÙŠØ« Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ø¶Ø±Ø¨Ø© Ø§Ù„Ø­Ø±Ø¬Ø©
        const critMulti = (critDamage / 100).toFixed(1);
        document.getElementById('critMulti').textContent = 'Ã—' + critMulti;
    }

    function switchTab(tabName) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        event.target.classList.add('active');
        document.getElementById(tabName).classList.add('active');

        if (tabName === 'saved') loadSavedCalculations();
        if (tabName === 'charts') updateCharts();
    }

    function toggleTheme() {
        currentTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', currentTheme);
        const themeBtn = document.querySelector('.theme-toggle');
        themeBtn.textContent = currentTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
        if (skillChart || upgradeChart) {
            setTimeout(() => updateCharts(), 100);
        }
    }

    function simulateBattle() {
        const attack = parseValue(document.getElementById('attack').value);
        const defense = parseValue(document.getElementById('defense').value);
        let health = parseValue(document.getElementById('health').value);
        const critChance = parseFloat(document.getElementById('critChance').value) / 100;
        const critDamage = parseFloat(document.getElementById('critDamage').value) / 100;
        const resistance = parseFloat(document.getElementById('resistance').value) / 100;

        const upgradeBonus = starBonuses[selectedStarLevel];
        const skillMultiplier = skillMultipliers[selectedSkillType];

        let baseDamage = (attack - defense) * (1 + upgradeBonus) * skillMultiplier * (1 - resistance);
        let turn = 0, totalDamage = 0, critHits = 0;
        let battleLog = [];

        while (health > 0 && turn < 10000) {
            turn++;
            const isCrit = Math.random() < critChance;
            let damage = isCrit ? baseDamage * critDamage : baseDamage;
            damage = Math.max(1, Math.round(damage));
            
            if (isCrit) critHits++;
            health -= damage;
            totalDamage += damage;
            
            battleLog.push({
                turn,
                damage,
                isCrit,
                remainingHealth: Math.max(0, health)
            });
        }

        displayResults(turn, critHits, totalDamage, battleLog);
    }

    function displayResults(hits, crits, damage, battleLog) {
        const avg = (damage / hits).toFixed(2);
        const resultsDiv = document.getElementById('results');
        const isDark = currentTheme === 'dark';
        
        // Ø¹Ø±Ø¶ Ø¢Ø®Ø± 100 Ø¶Ø±Ø¨Ø©
        const displayLog = battleLog.length > 100 ? battleLog.slice(-100) : battleLog;
        const logWarning = battleLog.length > 100 ? 
            `<div style="background: ${isDark ? 'rgba(255, 243, 205, 0.2)' : '#fff3cd'}; padding: 10px; border-radius: 8px; margin-bottom: 15px; color: ${isDark ? '#ffc107' : '#856404'}; text-align: center;">
                ğŸ“œ Ø¹Ø±Ø¶ Ø¢Ø®Ø± 100 Ø¶Ø±Ø¨Ø© Ù…Ù† Ø£ØµÙ„ ${battleLog.length} Ø¶Ø±Ø¨Ø©
            </div>` : '';
        
        const logEntries = displayLog.map(entry => `
            <div style="padding: 10px; margin-bottom: 8px; border-radius: 8px; 
                 background: ${entry.isCrit ? (isDark ? 'rgba(255, 243, 205, 0.2)' : '#fff3cd') : (isDark ? 'rgba(102, 126, 234, 0.2)' : '#f8f9fa')}; 
                 border-right: 4px solid ${entry.isCrit ? '#ffc107' : '#667eea'};
                 color: ${isDark ? '#eee' : '#333'};">
                <strong style="color: #667eea;">Ø§Ù„Ø¯ÙˆØ± ${entry.turn}:</strong>
                ${entry.isCrit ? 'ğŸ’¥ Ø¶Ø±Ø¨Ø© Ø­Ø±Ø¬Ø©!' : 'âš”ï¸'} 
                Ø¶Ø±Ø±: <strong>${formatNumber(entry.damage)}</strong> | 
                Ø§Ù„ØµØ­Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <strong style="color: ${entry.remainingHealth === 0 ? '#dc3545' : '#28a745'};">
                    ${formatValue(entry.remainingHealth)}
                </strong>
            </div>
        `).join('');
        
        resultsDiv.innerHTML = `
            <div class="result-card">
                <h3 style="text-align: center; margin-bottom: 15px;">ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¶Ø±Ø¨Ø§Øª</div>
                        <div class="stat-value">${formatNumber(hits)}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Ø¶Ø±Ø¨Ø§Øª Ø­Ø±Ø¬Ø©</div>
                        <div class="stat-value">${formatNumber(crits)}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¶Ø±Ø±</div>
                        <div class="stat-value">${formatValue(damage)}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¶Ø±Ø±</div>
                        <div class="stat-value">${formatValue(parseFloat(avg))}</div>
                    </div>
                </div>
                
                <div style="margin-top: 25px;">
                    <h4 style="margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid var(--border-color);">
                        ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
                    </h4>
                    ${logWarning}
                    <div style="max-height: 400px; overflow-y: auto; -webkit-overflow-scrolling: touch; padding-right: 5px;">
                        ${logEntries}
                    </div>
                </div>
            </div>
        `;
        resultsDiv.style.display = 'block';
        resultsDiv.scrollIntoView({ behavior: 'smooth' });
    }

    function saveCalculation() {
        const name = document.getElementById('calcName').value || `Ø­Ø³Ø§Ø¨ ${new Date().toLocaleString('ar')}`;
        const data = {
            name,
            attack: document.getElementById('attack').value,
            defense: document.getElementById('defense').value,
            health: document.getElementById('health').value,
            stars: selectedStarLevel,
            skill: selectedSkillType,
            timestamp: Date.now()
        };

        let saved = JSON.parse(localStorage.getItem('warCalculations') || '[]');
        saved.unshift(data);
        if (saved.length > 20) saved = saved.slice(0, 20);
        localStorage.setItem('warCalculations', JSON.stringify(saved));
        
        alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
    }

    function loadSavedCalculations() {
        const saved = JSON.parse(localStorage.getItem('warCalculations') || '[]');
        const listDiv = document.getElementById('savedList');
        
        if (saved.length === 0) {
            listDiv.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯</p>';
            return;
        }

        listDiv.innerHTML = saved.map((item, index) => `
            <div class="saved-item" onclick="loadCalculation(${index})">
                <div>
                    <div class="saved-item-name">${item.name}</div>
                    <div class="saved-item-details">
                        Ù‡Ø¬ÙˆÙ…: ${item.attack} | Ø¯ÙØ§Ø¹: ${item.defense} | â­${item.stars + 1}
                    </div>
                </div>
                <button class="delete-btn" onclick="event.stopPropagation(); deleteCalculation(${index})">ğŸ—‘ï¸</button>
            </div>
        `).join('');
    }

    function loadCalculation(index) {
        const saved = JSON.parse(localStorage.getItem('warCalculations') || '[]');
        const data = saved[index];
        
        document.getElementById('attack').value = data.attack;
        document.getElementById('defense').value = data.defense;
        document.getElementById('health').value = data.health;
        
        selectStars(data.stars, document.querySelectorAll('.star-option')[data.stars]);
        selectSkill(data.skill, document.querySelectorAll('.skill-type-btn')[data.skill]);
        
        switchTab('calculator');
        updatePreview();
        alert('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨!');
    }

    function deleteCalculation(index) {
        if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ØŸ')) return;
        
        let saved = JSON.parse(localStorage.getItem('warCalculations') || '[]');
        saved.splice(index, 1);
        localStorage.setItem('warCalculations', JSON.stringify(saved));
        loadSavedCalculations();
    }

    function compareUnits() {
        const attack1 = parseValue(document.getElementById('comp1Attack').value);
        const stars1 = parseInt(document.getElementById('comp1Stars').value);
        const attack2 = parseValue(document.getElementById('comp2Attack').value);
        const stars2 = parseInt(document.getElementById('comp2Stars').value);

        const damage1 = attack1 * (1 + starBonuses[stars1]);
        const damage2 = attack2 * (1 + starBonuses[stars2]);
        
        const winner = damage1 > damage2 ? 'Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰' : 'Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©';
        const diff = Math.abs(damage1 - damage2);

        document.getElementById('compareResults').innerHTML = `
            <div class="result-card" style="margin-top: 20px;">
                <h3 style="text-align: center;">ğŸ† Ø§Ù„Ù†ØªÙŠØ¬Ø©</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</div>
                        <div class="stat-value">${formatValue(Math.round(damage1))}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</div>
                        <div class="stat-value">${formatValue(Math.round(damage2))}</div>
                    </div>
                    <div class="stat-item" style="grid-column: 1 / -1;">
                        <div class="stat-label">Ø§Ù„ÙØ§Ø¦Ø²</div>
                        <div class="stat-value" style="color: #28a745;">${winner}</div>
                        <div class="stat-label" style="margin-top: 8px;">Ø¨ÙØ§Ø±Ù‚ ${formatValue(Math.round(diff))}</div>
                    </div>
                </div>
            </div>
        `;
    }

    function updateCharts() {
        const attack = parseValue(document.getElementById('attack').value);
        const defense = parseValue(document.getElementById('defense').value);
        
        // Ø±Ø³Ù… Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª
        const skillData = skillMultipliers.map((mult, i) => {
            const base = attack - defense;
            return Math.round(base * (1 + starBonuses[selectedStarLevel]) * mult * 0.9);
        });

        const ctx1 = document.getElementById('skillChart');
        if (skillChart) skillChart.destroy();
        
        skillChart = new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: ['âš”ï¸ Ø¹Ø§Ø¯ÙŠØ©', 'ğŸ”¥ Ø®Ø§ØµØ©', 'ğŸ’¥ Ù†Ù‡Ø§Ø¦ÙŠØ©'],
                datasets: [{
                    label: 'Ø§Ù„Ø¶Ø±Ø±',
                    data: skillData,
                    backgroundColor: ['#667eea', '#f5576c', '#ffd700']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                }
            }
        });

        // Ø±Ø³Ù… Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª
        const upgradeData = starBonuses.map((bonus, i) => {
            const base = attack - defense;
            return Math.round(base * (1 + bonus) * skillMultipliers[1] * 0.9);
        });

        const ctx2 = document.getElementById('upgradeChart');
        if (upgradeChart) upgradeChart.destroy();
        
        upgradeChart = new Chart(ctx2, {
            type: 'line',
            data: {
                labels: ['â­', 'â­â­', 'â­â­â­', 'â­â­â­â­', 'â­â­â­â­â­'],
                datasets: [{
                    label: 'Ø§Ù„Ø¶Ø±Ø±',
                    data: upgradeData,
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                }
            }
        });
    }

    function shareAsImage() {
        const resultsDiv = document.getElementById('results');
        if (!resultsDiv || resultsDiv.style.display === 'none') {
            alert('âš ï¸ ÙŠØ¬Ø¨ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø£ÙˆÙ„Ø§Ù‹!');
            return;
        }

        html2canvas(resultsDiv).then(canvas => {
            const link = document.createElement('a');
            link.download = 'war-calculator-result.png';
            link.href = canvas.toDataURL();
            link.click();
            alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©!');
        });
    }

    updatePreview();
</script>
```

</body>
</html>